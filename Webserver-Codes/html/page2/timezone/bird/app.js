function ErrorReporter(a){function b(a){try{a.stack||(a.stack=new Error("make stack").stack,a.stack&&(a.stack=a.stack.toString()))}catch(b){}return"string"!=typeof a&&(a=JSON.stringify(a)),a}function c(b){var c=new XMLHttpRequest;c.open("POST",a,!0),c.setRequestHeader("Content-Type","application/json"),c.onerror=function(){defer(b)},c.send(b)}function d(a){a=b(a);var d="string"==typeof a?a:JSON.stringify(a);c(d)}return{report:d}}function bound(a,b,c){return null!==b&&(a=Math.max(a,b)),null!==c&&(a=Math.min(a,c)),a}function degreesToRadians(a){return a*(Math.PI/180)}function radiansToDegrees(a){return a/(Math.PI/180)}function MercatorProjection(){this.pixelOrigin_=new google.maps.Point(MERCATOR_RANGE/2,MERCATOR_RANGE/2),this.pixelsPerLonDegree_=MERCATOR_RANGE/360,this.pixelsPerLonRadian_=MERCATOR_RANGE/(2*Math.PI)}function r2d(a){return 360*a/(2*Math.PI)}function styleElement(a,b){for(var c=b.split(";"),d=0;d<c.length;d++){var e=c[d].split(":");2==e.length&&(a.style[e[0].replace(" ","")]=e[1].replace(" ",""))}}function disableButton(a){a.disabled=!0,a.style.cursor="default",a.style.background=a.style.backgroundColor="#aaa"}function enableButton(a){a.disabled=!1,a.style.cursor="pointer",a.style.background=a.style.backgroundColor="#000"}function unique(a){var b=[];a:for(var c=0,d=a.length;d>c;c++){for(var e=c+1;d>e;e++)if(a[e]==a[c])continue a;b[b.length]=a[c]}return b}function sprite(){}function calculateDistance(a,b){var c=b.lat()-a.lat(),d=b.lng()-a.lng();return Math.sqrt(c*c+d*d)}function ProjMap(a,b){this.scale=1,this.deviation=0,this.poff=null,this.copyrights=[],this.invalidate_c=!1,this.copyright_str="",this.canvas=null,this.ctx=null,this.logo=new Image,this.vignette=new Image,this.cloud=new Image,this.logo.src="files/img/poweredby.png",this.vignette.src="files/img/vignette.png",this.cloud.src="files/img/PerlinNoise2d.png",this.birds1=!1,this.birds2=!1,this.birds3=!1,this.perspective=.35,this.debug=!1,this.map_version=GMAPS_VERSION,this.tweener=new MANUAL_TWEEN.Manager,this.tween_zoom=0,this.tween_zoom2=0,this.tween_angle1=0,this.tween_angle2=0,this.tween_angle3=0,this.tween_perspective=0,this.tween_alpha=0,this.tilemap=[],this.zoom=null,this.int_zoom=null,this.tile_zoom=null,this.real_zoom=null,this.zoom_factor=null,this.starting_zoom=19,this.start_time=0,this.projection=null,this.map_type=1,this.extent=3,this.tileorigin=null,this.bird=null,this.bird2=null,this.runner=null,this.standing=null,this.load_failed=!1,this.tint_alpha=.5,this.tint_colour="#704214",this.running=!1,this.rotating=!1,this.clouds=!1,this.zooming=!1,this.clouds_alpha=0,this.white_alpha=0,this.texture_angle=0,this.position=null,this.runner_position=null,this.pos_offset=null,this.current_position=null,this.final_coordinates=null,this.original_coordinates=null,this.position_offset={x:0,y:0},this.angle=0,this.runner_angle=0,this.trees=!1,this.tree=null,this.trees_array=[],this.birds_array=[],this.birds2_array=[],this.birds3_array=[],this.last_time=null,this.spans=null}function Memory(a){this.content=a,this.context=a.context,this.isRecording=!1,this.isPlaying=!1,this.actions=[];var b=0,c=0,d=0,e="";this.onCompleteFunction=null,this.play=function(b){this.isPlaying=!0,this.onCompleteFunction=b,a.isRedrawing=!0,a.loadMessage(e),a.randomizer.reset(),c=0,d=0},this.add=function(a,b,d){this.actions.length<1&&2==a||this.actions.push(new Action(c,a,b,d))},this.save=function(){for(var a,b="",c="",d=0;d<this.actions.length;d++)a=this.actions[d],b=null!==a?a.str():"",c+=b+"|";return this.content.messageContents+"$"+c},this.read=function(a){if(void 0===a||""===a)return void console.log(arguments.callee.caller.toString());this.forget();var c=a.split("$"),d=c[1];e=c[0];for(var f=d.split("|"),g=0,h=0;h<f.length-1;h++){var i=f[h],j=i.split(" ");0===h&&(g=parseInt(j[0])),h==f.length-2&&(b=parseInt(j[0])-g),this.actions[h]=ActionFromString(i,g)}},this.stop=function(){this.isPlaying=!1},this.forget=function(){this.actions=[],b=0},this.step=function(){if(this.isPlaying){if(c>=b)return this.stop(),"function"==typeof this.onCompleteFunction&&this.onCompleteFunction(),void(a.isRedrawing=!1);for(var e=this.actions[d];null!==e&&e.stepNumber==c;)0===e.type?this.content.brush.strokeStart(e.mouseX,e.mouseY):1==e.type?this.content.brush.stroke(e.mouseX,e.mouseY):this.content.brush.strokeEnd(),d++,e=this.actions[d];c++}else this.isRecording&&(b++,c++)},this.beginRecord=function(){this.isRecording=!0},this.endRecord=function(){this.isRecording=!1}}function ActionFromString(a,b){var c=a.split(" ");return new Action(parseInt(c[0])-b,parseInt(c[1]),parseInt(c[2]),parseInt(c[3]))}function Action(a,b,c,d){this.stepNumber=a,this.type=b,this.mouseX=c,this.mouseY=d,this.str=function(){return this.stepNumber+" "+this.type+" "+this.mouseX+" "+this.mouseY}}function Brush(a,b){this.clearPointsOnMouseUp=!1,this.drawShaded=!0,this.context=b,this.content=a,this.wasStroking=!1,this.stroking=!1,this.randomizer=a&&a.randomizer?a.randomizer:__seed,this.points=[],this.allPoints=[],this.angle=0,this.velocity=0,this.pvelocity=0,this.curCount=0,this.defaultLineWidth=1,this.defaultStrokeOpacity=.95,this.pointsEvery=50,this.getStrokeOpacity=function(){return this.defaultStrokeOpacity},this.getLineWidth=function(){return this.defaultLineWidth}}function BranchingBrush(a,b){Brush.call(this,a,b),this.branchChance=.08,this.firstChildChance=.41,this.speedToBranch=1.5,this.branchChanceDecay=.36,this.velocityDampening=.33,this.minAngleTurn=Math.PI/12,this.maxAngleTurn=Math.PI/9,this.throwVelocity=3,this.minBranchVelocity=2.25,this.maxBranchVelocity=7.5,this.minThrownBranchVelocity=2.25,this.maxBranchWidth=1,this.velocityToBranchWidth=.4,this.angleJitter=.059*Math.PI,this.growthDecay=.95,this.drawShading=!0,this.shadeConnectionLineWidth=.3,this.branchOpacity=.8,this.shadeConnectionDistanceSquared=3700,this.shadeConnectionOpacityDampening=.045,this.shadeSkip=1,this.minPointsToBranch=3,this.throwTimeoutDelay=10,this.shouldThrow=!1}function Branch(a){BranchingBrush.call(this,a.content,a.context),this.content.branches.push(this),this.growthVelocity=a.growthVelocity||this.constrain(a.pvelocity*a.velocityDampening,a.minBranchVelocity,a.maxBranchVelocity),this.angleJitter=a.angleJitter,this.maxBranchVelocity=a.maxBranchVelocity,this.minBranchVelocity=a.minBranchVelocity,this.maxBranchWidth=a.maxBranchWidth,this.branchChanceDecay=a.branchChanceDecay,this.velocityToBranchWidth=a.velocityToBranchWidth,this.growthDecay=a.growthDecay,this.minAngleTurn=a.minAngleTurn,this.maxAngleTurn=a.maxAngleTurn,this.branchOpacity=a.branchOpacity;var b=this.random(a.minAngleTurn,a.maxAngleTurn)*(this.randomizer.next()<.5?-1:1);this.angle=a.bornFrom?a.angle+b:a.angle;var c;c=a.bornFrom?a.branchChance:a.firstChildChance,this.bornFrom=a,this.ix=a.mouseX,this.iy=a.mouseY,this.branchChance=c*a.branchChanceDecay,this.drawShading=!1,this.strokeStart(this.ix,this.iy),this.getLineWidth=function(){return this.constrain(this.growthVelocity*this.velocityToBranchWidth,0,this.maxBranchWidth)},this.getStrokeOpacity=function(){return this.branchOpacity}}function CanvasSprite(a){var b=document.createElement("canvas");b.width=a.width,b.height=a.height,this.width=a.width;var c=b.getContext("2d");for(this.character=a.character,this.__defineGetter__("g",function(){return c}),this.__defineGetter__("canvas",function(){return b}),this.svgData=a.svgData,this.svg=createSVG(this.svgData),this.branches=[],this.brushes=[];this.brushes.length<this.svg.children.length;){var d=new BranchingBrush(this,this.g);this.brushes.push(d),d.velocityDampening=.29,d.throwVelocity=.3,d.firstChildChance=.5,d.branchChance=.8,d.angleJitter=.1*Math.PI,d.defaultLineWidth=1,d.minBranchVelocity=0,d.velocityToBranchWidth=.8,d.branchOpacity=.7,d.minPointsToBranch=1,d.growthDecay=.965}this.left=a.left||0,this.right=a.right||0,this.right-=2,this.left-=2,b.style.marginTop="-30px",b.style.marginBottom="-30px",b.style.marginLeft=this.left+"px",b.style.marginRight=this.right+"px",this.speed=a.speed;var e=0;this.update=function(){var a;this.g.save();for(a in this.branches)this.branches[a].update();for(a=0;a<this.svg.children.length;a++){var b=this.svg.children[a],c=this.brushes[a];if(!c.ended)try{var d=b.at(e,this.g);0===e?c.strokeStart(d.x,d.y):c.stroke(d.x,d.y),e+=this.speed}catch(f){c.ended||(c.ended=!0,c.strokeEnd())}}this.g.restore()}}function loadSVG(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4==d.readyState)if(200==d.status)if(null===d.responseXML)void 0!==c&&c.call(this,a);else{var e=d.responseXML.getElementsByTagName("svg").item(0),f=new SVG(e);f.filename=a,b.call(this,f,a)}else void 0!==c&&c.call(this,a)},d.open("GET",a,!0),d.send(null)}function createSVG(a){var b=document.createElement("svg");return b.innerHTML=a,new SVG(b)}function createWindowSequence(){sequencer.add(new PopupEffect(popup1,{x:-54,y:153,width:1126,height:406},!1),0,59.5),sequencer.add(new PopupEffect(popup1,{x:10,y:1024,width:100,height:60},!1),59.5,20.86699676513672),sequencer.add(new PopupEffect(popup1,{x:600,y:566,width:650,height:234},!1),80.36699676513672,26.333335876464844),sequencer.add(new PopupEffect(popup1,{x:19,y:390,width:1e3,height:360},!1),106.70033264160156,25.666671752929688),sequencer.add(new PopupEffect(popup1,{x:10,y:1024,width:100,height:60},!1),132.36700439453125,112.2239990234375),sequencer.add(new PopupEffect(popup1,{x:692,y:-40,width:600,height:350},!1),244.59100341796875,45.40899658203125),sequencer.add(new PopupEffect(popup1,{x:10,y:1024,width:100,height:60},!1),290,-.485321044921875),sequencer.add(new PopupEffect(popup2,{x:10,y:1024,width:100,height:60},!1),0,31.117000579833984),sequencer.add(new PopupEffect(popup2,{x:-220,y:-165,width:600,height:350},!1),31.117000579833984,27.549999237060547),sequencer.add(new PopupEffect(popup2,{x:-40,y:25,width:700,height:450},!1),58.66699981689453,.8330001831054688),sequencer.add(new PopupEffect(popup2,{x:131,y:139,width:800,height:400},!1),59.5,47.20033264160156),sequencer.add(new PopupEffect(popup2,{x:82,y:76,width:800,height:400},!1),106.70033264160156,1.7996673583984375),sequencer.add(new PopupEffect(popup2,{x:-55,y:1,width:800,height:400},!1),108.5,.9000015258789062),sequencer.add(new PopupEffect(popup2,{x:-228,y:-45,width:710,height:400},!1),109.4000015258789,22.967002868652344),sequencer.add(new PopupEffect(popup2,{x:73,y:89,width:900,height:500},!1),132.36700439453125,23.7659912109375),sequencer.add(new PopupEffect(popup2,{x:135,y:163,width:550,height:300},!1),156.13299560546875,.25),sequencer.add(new PopupEffect(popup2,{x:90,y:90,width:400,height:200},!1),156.38299560546875,.214019775390625),sequencer.add(new PopupEffect(popup2,{x:144,y:156,width:250,height:100},!1),156.59701538085938,.2029876708984375),sequencer.add(new PopupEffect(popup2,{x:10,y:1024,width:100,height:60},!1),156.8000030517578,3.9810028076171875),sequencer.add(new PopupEffect(popup2,{x:-171,y:484,width:320,height:240},!1),160.781005859375,95.41000366210938),sequencer.add(new PopupEffect(popup2,{x:10,y:1024,width:100,height:60},!1),256.1910095214844,.98199462890625),sequencer.add(new PopupEffect(popup2,{x:-270,y:276,width:900,height:510},!1),257.1730041503906,4.8800048828125),sequencer.add(new PopupEffect(popup2,{x:10,y:1024,width:100,height:60},!1),262.0530090332031,5.920013427734375),sequencer.add(new PopupEffect(popup2,{x:-276,y:271,width:900,height:510},!1),267.9730224609375,11.20001220703125),sequencer.add(new PopupEffect(popup2,{x:10,y:1024,width:100,height:60},!1),279.17303466796875,10.341644287109375),sequencer.add(new PopupEffect(popup3,{x:10,y:1024,width:100,height:60},!1),0,63),sequencer.add(new PopupEffect(popup3,{x:-68,y:44,width:234,height:650},!1),63,3.9583358764648438),sequencer.add(new PopupEffect(popup3,{x:657,y:553,width:650,height:234},!1),66.95833587646484,4.041664123535156),sequencer.add(new PopupEffect(popup3,{x:662,y:-48,width:650,height:234},!1),71,8.791664123535156),sequencer.add(new PopupEffect(popup3,{x:10,y:1024,width:100,height:60},!1),79.79166412353516,.5753326416015625),sequencer.add(new PopupEffect(popup3,{x:10,y:1024,width:100,height:60},!1),80.36699676513672,26.333335876464844),sequencer.add(new PopupEffect(popup3,{x:10,y:1024,width:100,height:60},!1),106.70033264160156,25.666671752929688),sequencer.add(new PopupEffect(popup3,{x:10,y:1024,width:100,height:60},!1),132.36700439453125,24.432998657226562),sequencer.add(new PopupEffect(popup3,{x:10,y:1024,width:100,height:60},!1),156.8000030517578,4.9810028076171875),sequencer.add(new PopupEffect(popup3,{x:463,y:459,width:320,height:240},!1),161.781005859375,94.89300537109375),sequencer.add(new PopupEffect(popup3,{x:10,y:1024,width:100,height:60},!1),256.67401123046875,3.41900634765625),sequencer.add(new PopupEffect(popup3,{x:178,y:323,width:799,height:449},!1),260.093017578125,4.959991455078125),sequencer.add(new PopupEffect(popup3,{x:10,y:1024,width:100,height:60},!1),265.0530090332031,2.920013427734375),sequencer.add(new PopupEffect(popup3,{x:10,y:1024,width:100,height:60},!1),267.9730224609375,11.20001220703125),sequencer.add(new PopupEffect(popup3,{x:10,y:1024,width:100,height:60},!1),279.17303466796875,10.341644287109375),sequencer.add(new PopupEffect(popup4,{x:10,y:1024,width:100,height:60},!1),0,83.76699829101562),sequencer.add(new PopupEffect(popup4,{x:-239,y:197,width:400,height:300},!1),83.76699829101562,3.9329986572265625),sequencer.add(new PopupEffect(popup4,{x:10,y:1024,width:100,height:60},!1),87.69999694824219,4.967002868652344),sequencer.add(new PopupEffect(popup4,{x:911,y:192,width:400,height:300},!1),92.66699981689453,3.0670013427734375),sequencer.add(new PopupEffect(popup4,{x:10,y:1024,width:100,height:60},!1),95.73400115966797,.5540008544921875),sequencer.add(new PopupEffect(popup4,{x:-99,y:25,width:234,height:650},!1),96.28800201416016,2.4583358764648438),sequencer.add(new PopupEffect(popup4,{x:10,y:1024,width:100,height:60},!1),98.746337890625,.8206634521484375),sequencer.add(new PopupEffect(popup4,{x:-235,y:196,width:400,height:300},!1),99.56700134277344,2.8759994506835938),sequencer.add(new PopupEffect(popup4,{x:10,y:1024,width:100,height:60},!1),102.44300079345703,13.457000732421875),sequencer.add(new PopupEffect(popup4,{x:650,y:-46,width:710,height:400},!1),115.9000015258789,16.467002868652344),sequencer.add(new PopupEffect(popup4,{x:10,y:1024,width:100,height:60},!1),132.36700439453125,24.432998657226562),sequencer.add(new PopupEffect(popup4,{x:10,y:1024,width:100,height:60},!1),156.8000030517578,5.9810028076171875),sequencer.add(new PopupEffect(popup4,{x:145,y:527,width:320,height:240},!1),162.781005859375,92.89799499511719),sequencer.add(new PopupEffect(popup4,{x:10,y:1024,width:100,height:60},!1),255.6790008544922,6.3740081787109375),sequencer.add(new PopupEffect(popup4,{x:-202,y:87,width:800,height:450},!1),262.0530090332031,5.920013427734375),sequencer.add(new PopupEffect(popup4,{x:10,y:1024,width:100,height:60},!1),267.9730224609375,21.541656494140625),sequencer.add(new PopupEffect(popup5,{x:10,y:1024,width:100,height:60},void 0),0,156.8000030517578),sequencer.add(new PopupEffect(popup5,{x:-102,y:-80,width:770,height:520},!1),156.8000030517578,100.37300109863281),sequencer.add(new PopupEffect(popup5,{x:10,y:1024,width:100,height:60},!1),257.1730041503906,32.3416748046875),sequencer.add(new PopupEffect(popup6,{x:10,y:1024,width:100,height:60},void 0),0,192.46400451660156),sequencer.add(new PopupEffect(popup6,{x:944,y:585,width:304,height:176},!1),216.1320037841797,13.867996215820312),sequencer.add(new PopupEffect(popup6,{x:10,y:1024,width:100,height:60},!1),230,6.9730072021484375),sequencer.add(new PopupEffect(popup6,{x:803,y:384,width:512,height:288},!1),236.97300720214844,7.6179962158203125),sequencer.add(new PopupEffect(popup6,{x:10,y:1024,width:100,height:60},!1),257.1730041503906,7.8800048828125),sequencer.add(new PopupEffect(popup6,{x:790,y:390,width:450,height:300},!1),265.0530090332031,2.0469970703125),sequencer.add(new PopupEffect(popup6,{x:10,y:1024,width:100,height:60},!1),267.1000061035156,.873016357421875),sequencer.add(new PopupEffect(popup6,{x:10,y:1024,width:100,height:60},!1),267.9730224609375,3.95196533203125),sequencer.add(new PopupEffect(popup6,{x:23,y:-181,width:450,height:299},!1),271.92498779296875,2.07501220703125),sequencer.add(new PopupEffect(popup6,{x:10,y:1024,width:100,height:60},!1),274,1.80999755859375),sequencer.add(new PopupEffect(popup6,{x:790,y:390,width:450,height:300},!1),275.80999755859375,2.397003173828125),sequencer.add(new PopupEffect(popup6,{x:10,y:1024,width:100,height:60},!1),278.2070007324219,11.30767822265625)}function addContents(){addContent(new VideoContent(1126,406,"/files/video/01.ogv","/files/video/01.mp4")),addContent(new BirdsSky(600,350)),addContent(new FlyingNeighborhood(800,400)),addContent(new VideoContent(234,650,"/files/video/02.ogv","/files/video/02.mp4")),addContent(new VideoContent(650,234,"/files/video/03.ogv","/files/video/03.mp4")),addContent(new VideoContent(650,234,"/files/video/04.ogv","/files/video/04.mp4")),addContent(new VideoContent(650,234,"/files/video/05.ogv","/files/video/05.mp4")),addContent(new StreetviewPan(400,300,.48,-1)),addContent(new VideoContent(650,234,"/files/video/07.ogv","/files/video/07.mp4")),addContent(new StreetviewPan(400,300,.66,1)),addContent(new VideoContent(234,650,"/files/video/06.ogv","/files/video/06.mp4")),addContent(new StreetviewPan(400,300,.8,-1)),addContent(new VideoContent(1e3,360,"/files/video/08.ogv","/files/video/08.mp4")),addContent(new AerialHouse360(710,400)),addContent(new Streetview360(710,400)),addContent(new ZoomOut(900,500)),addContent(main_drawingTool=new DrawingTool(750,500)),addContent(new VideoMachine(320,240,"/files/video/55.ogv","/files/video/55.mp4")),addContent(new VideoMachine(320,240,"/files/video/52.ogv","/files/video/52.mp4")),addContent(new VideoMachine(320,240,"/files/video/73.ogv","/files/video/73.mp4","/files/video/73idle.ogv","/files/video/73idle.mp4")),addContent(new VideoContent(304,176,"/files/video/Act3_01.ogv","/files/video/Act3_01.mp4")),addContent(new BirdsMap(770,520)),addContent(new VideoContent(512,288,"/files/video/Act3_02.ogv","/files/video/Act3_02.mp4")),addContent(new FlyingNeighborhood2(600,350)),addContent(new VideoContent(900,510,"/files/video/attack_01.ogv","/files/video/attack_01.mp4")),addContent(new VideoContent(800,450,"/files/video/attack_02.ogv","/files/video/attack_02.mp4")),addContent(new VideoContent(800,450,"/files/video/attack_03.ogv","/files/video/attack_03.mp4")),addContent(new StreetViewTrees(450,300,90,.1,.7)),addContent(new VideoContent(900,510,"/files/video/attack_04.ogv","/files/video/attack_04.mp4")),addContent(new StreetViewTrees(450,300,-90,.2,.8)),addContent(new VideoContent(900,510,"/files/video/attack_05.ogv","/files/video/attack_05.mp4")),addContent(new StreetViewTrees(450,300,0,.3,1))}function createContentSequence(){addContentToSequence(0,popup1,0,59.5),addContentToSequence(1,popup2,31.117,28.383),addContentToSequence(2,popup2,59.5,49.900001525879),addContentToSequence(3,popup3,63,3.9583330154419),addContentToSequence(4,popup3,66.95833587646484,4.0416669845581),addContentToSequence(5,popup3,71,8.7916669845581),addContentToSequence(6,popup1,80.36699676513672,8.5),addContentToSequence(7,popup4,83.76699829101562,3.9329986572266),addContentToSequence(8,popup1,88.86699676513672,17.833332061768),addContentToSequence(9,popup4,92.66699981689453,3.0670013427734),addContentToSequence(10,popup4,96.28800201416016,2.4583330154419),addContentToSequence(11,popup4,99.56700134277344,2.8759994506836),addContentToSequence(12,popup1,106.70033264160156,25.666667938232),addContentToSequence(13,popup2,109.4000015258789,22.967002868652),addContentToSequence(14,popup4,115.9000015258789,16.466998474121),addContentToSequence(15,popup2,132.36700439453125,24.230010986328),addContentToSequence(16,popup5,156.8000030517578,100.37299694824),addContentToSequence(17,popup2,160.781005859375,95.409994140625),addContentToSequence(18,popup3,161.781005859375,94.892994140625),addContentToSequence(19,popup4,162.781005859375,92.897994140625),addContentToSequence(20,popup6,216.1320037841797,14.39999961853),addContentToSequence(21,popup5,229.74400329589844,27.428996704102),addContentToSequence(22,popup6,236.97300720214844,20.199992797852),addContentToSequence(23,popup1,244.591,45.409),addContentToSequence(24,popup2,257.1730041503906,4.8800001144409),addContentToSequence(25,popup3,260.093017578125,4.960000038147),addContentToSequence(26,popup4,262.0530090332031,5.9200000762939),addContentToSequence(27,popup6,265.0530090332031,2.0469909667969),addContentToSequence(28,popup2,267.9730224609375,4.1999998092651),addContentToSequence(29,popup6,271.92498779296875,2.0750122070312),addContentToSequence(30,popup2,272.17303466796875,7),addContentToSequence(31,popup6,275.80999755859375,2.3970031738281)}function launchWindowManager(){windows=[],windowsReady=0;for(var a=1;nWindows+1>a;a++)addWindow("popup"+a);controller=window.open("controller.html","controller",DEFAULT_POPUP_PROPERTIES),windows.push(controller)}function addWindow(a){var b=window.open("container.html",a,DEFAULT_POPUP_PROPERTIES);b.settings={x:0,y:0,width:100,height:100},windows.push(b),this[a]=b}function popupWindowReady(){windowsReady++,windowsReady==nWindows+1&&launch()}function onWindowUnload(a){exitSequencer(a),pausedByClose()}function exitSequencer(a){closeWindows();try{void 0!==audio&&audio.pause(),sequencer.clear(),sequencer.reset(),sequencer=new Sequencer}catch(b){}}function closeWindows(){for(var a=0;a<windows.length;a++)if(void 0!==windows[a])try{windows[a].removeListeners(),windows[a].close()}catch(b){}try{controller.removeListeners()}catch(b){}try{final_drawing.close()}catch(b){}}function createWindowEffects(){sequencer.add(new PopupShaker(popup1),268,1),sequencer.add(new PopupShaker(popup3),269,.5),sequencer.add(new PopupShaker(popup3),270,.5),sequencer.add(new PopupShaker(popup1),271,1),sequencer.add(new PopupShaker(popup4),272,1),sequencer.add(new PopupShaker(popup3),272,.5),sequencer.add(new PopupShaker(popup3),273,1),sequencer.add(new PopupShaker(popup1),273,1),sequencer.add(new PopupShaker(popup4),274.5,.5),sequencer.add(new PopupShaker(popup3),275.5,.5),sequencer.add(new PopupZoomOut(popup1,{x:0,y:2e3,width:400,height:300,duration:10}),134.5,10),sequencer.add(new PopupZoomOut(popup3,{x:500,y:2e3,width:400,height:300,duration:12}),135.5,12),sequencer.add(new PopupZoomOut(popup4,{x:800,y:2e3,width:400,height:300,duration:15}),136.5,15),sequencer.add(new PopupTween(popup3,{x:300},9),82.1,8.9)}function addContent(a){_contents.push(a)}function loadContents(){for(var a=0;a<_contents.length;a++)isMapContent(a)||_contents[a].load()}function loadMapContents(){for(var a=0;a<mapContents.length;a++)_contents[mapContents[a]].load()}function isMapContent(a){for(var b=!1,c=0;c<mapContents.length;c++)if(mapContents[c]===a){b=!0;break}return b}function getLoadedContents(){for(var a=0,b=0;b<_contents.length;b++)_contents[b].preloaded&&a++;return a}function getUnloadedContents(){return _contents.length-getLoadedContents()}function checkIfPreloaded(a){for(var b=!0,c=0;c<_contents.length;c++)b&=a?_contents[c].preloaded||_contents[c].loadingfailed:_contents[c].preloaded;return b}function loadDataFailed(){for(var a=!1,b=0;b<mapContents.length;b++)if(_contents[mapContents[b]].loadingfailed){a=!0;break}return a}function addContentToSequence(a,b,c,d){_contents[a].target=b,sequencer.add(_contents[a],c,d)}function appendFinalDrawingTool(a){var b=main_drawingTool;return drawingTool=new DrawingTool(b.canvas.width,b.canvas.height),drawingTool.target=a,drawingTool.show(!0),isDrawing=!0,fadeBlocker(100),drawingTool}function drawingToolClosed(){isDrawing=!1,fadeBlocker(0)}function resetContents(){for(var a=0;a<_contents.length;a++)delete _contents[a];_contents=[],addContents()}function resetMapContents(){for(var a=0;a<mapContents.length;a++)_contents[mapContents[a]].loadingfailed=!1,_contents[mapContents[a]].preloaded=!1}function BirdsSky(a,b){function c(a){s=a.target.innerWidth,t=a.target.innerHeight,u=s/2,v=t/2,e.projectionMatrix=THREE.Matrix4.makePerspective(75,s/t,1,1e4),g.setSize(s,t)}function d(a){k.x=a.clientX-u,k.y=-a.clientY+v+e.position.y;for(var b=0,c=n.length;c>b;b++)m=n[b],k.z=m.position.z,m.repulse(k)}Content.call(this);var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=a,t=b,u=s/2,v=t/2,w=[31,32,33,35,39,40,41,44,48,49,50,53,58,59,60,100],x=0,y=[new THREE.Vector3(100,100,100),new THREE.Vector3(-50,50,100),new THREE.Vector3(50,100,50),new THREE.Vector3(-100,-50,50),new THREE.Vector3(0,0,0),new THREE.Vector3(100,100,100),new THREE.Vector3(-50,50,100),new THREE.Vector3(50,100,50),new THREE.Vector3(-100,-50,50),new THREE.Vector3(0,0,0),new THREE.Vector3(100,100,100),new THREE.Vector3(-50,-100,50),new THREE.Vector3(50,-400,50),new THREE.Vector3(-100,-800,-50),new THREE.Vector3(0,-800,0),new THREE.Vector3(0,-800,0)];this.load=function(){r=new MANUAL_TWEEN.Manager,j=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3,o=document.createElement("img"),o.src="files/img/clouds.png",p=document.createElement("img"),p.src="files/img/vignette2.png",e=new THREE.Camera(75,s/t,1,1e4),e.position.z=400,f=new THREE.Scene,h=[],n=[];for(var a=0;100>a;a++)m=n[a]=new Boid,m.position.x=200*Math.random()-100,m.position.y=200*Math.random()-100,m.position.z=200*Math.random()-100,m.velocity.x=4*Math.random()-2,m.velocity.y=4*Math.random()-2,m.velocity.z=4*Math.random()-2,i=h[a]=new THREE.Mesh(new Crow,new THREE.MeshColorFillMaterial(0)),i.phase=Math.floor(62.83*Math.random()),i.position=m.position,i.doubleSided=!0,f.addObject(i);g=new THREE.CanvasRenderer,g.domElement.style.position="absolute",g.autoClear=!1,g.setSize(s,t);var b=new MANUAL_TWEEN.Tween(l).to(2,{y:-1200}).easing(TWEEN.Easing.Expo.EaseIn);r.add(b),q=g.domElement.getContext("2d"),this.preloaded=!0},this.show=function(){sendStat("/50-Birds"),this.container.appendChild(g.domElement),this.container.addEventListener("mousemove",d,!1),this.target.window.addEventListener("resize",c,!1)},this.hide=function(){this.container.removeChild(g.domElement),this.container.removeEventListener("mousemove",d,!1),this.target.window.removeEventListener("resize",c,!1)},this.update=function(a,b,c){var d,k,u,v;if(a>w[x]){for(j=y[x],u=0,v=n.length;v>u;u++){m=n[u];var z=new THREE.Vector3;z.copy(j),z.x+=(300*Math.random()-150)*(b+.2),z.y+=(300*Math.random()-150)*(b+.2),z.z+=(300*Math.random()-150)*(b+.2),m.setGoal(z)}x++}for(e.position.y=-(300*b)+200,e.target.position.y=e.position.y,b>.6&&(r.update(5e3*(b-.6)),e.target.position.addSelf(l),l.divideScalar(80)),q.drawImage(o,0,-(e.target.position.y-200),600,t,0,0,s,t),u=0,v=h.length;v>u;u++)m=n[u],m.run(n),i=h[u],d=i.material[0].color,k=(500-i.position.z)/1e4,d.r=.9*k,d.g=.67*k,d.b=.37*k,d.updateStyleString(),i.position.y+=l.y,i.position.z-=l.y,i.rotation.y=Math.atan2(-m.velocity.z,m.velocity.x),i.rotation.z=Math.asin(m.velocity.y/m.velocity.length()),i.phase+=Math.max(0,i.rotation.z-.5)+.1,i.geometry.vertices[5].position.y=i.geometry.vertices[4].position.y=5*Math.sin(i.phase%62.83);g.render(f,e),b>.96&&(q.fillStyle="rgba(255, 255, 255, "+(b-.96)/.04+")",q.fillRect(0,0,s,t)),q.drawImage(p,0,0,s,t)}}function GAddCopyright(a,b,c,d,e,f,g,h,i,j){map.addCopyright(h)}function GVerify(){}function BirdsMap(a,b){function c(){var c;if(!f){if(f=!0,e=SharedObject.data.dt_points.slice(0),!e.length)for(c=0;250>c;c++)e.push([700*Math.random(),400*Math.random()]);e.sort(function(){return Math.random()>.5?-1:1});var d=e.length>250?250:e.length;for(c=0;d>c;c++){k=j[c]=new THREE.Mesh(new Crow,new THREE.MeshColorFillMaterial(0)),k.scale.x=k.scale.y=k.scale.z=Math.random()+.5,k.doubleSided=!0,h.addObject(k),k.phase=Math.floor(62.83*Math.random()),Math.random()>.5?(k.position.x=-2e3*Math.random(),k.position.y=1e3*Math.random(),k.position.z=-1e3*Math.random()-1e3):(k.position.x=Math.random()-1e3,k.position.y=1e3*Math.random(),k.position.z=1e3*Math.random()-500),k.rotation.y=(90*Math.random()-45)*Math.PI/180,k.rotation.z=-5*Math.PI/180;var g=5*Math.random(),i=2*Math.random()+3;n=new MANUAL_TWEEN.Tween(k.position).delay(g).to(i-.5,{x:e[c][0]-a/2,y:-e[c][1]+b/2,z:0}).easing(TWEEN.Easing.Sine.EaseOut),l.add(n),n=new MANUAL_TWEEN.Tween(k.rotation).delay(g).to(i,{z:20*Math.PI/180}).easing(TWEEN.Easing.Sine.EaseOut),l.add(n),n=new MANUAL_TWEEN.Tween(k).delay(g).to(i,{phase:200}).easing(TWEEN.Easing.Expo.EaseIn),l.add(n),k.phase=200,k.position.x=e[c][0]-a/2,k.position.y=-e[c][1]+b/2,k.position.z=0,g=5*Math.random(),n=new MANUAL_TWEEN.Tween(k.position).delay(g).to(4,{x:700*Math.random()+750,y:1e3*Math.random()-500,z:1e3*Math.random()-400}).easing(TWEEN.Easing.Sine.EaseIn),m.add(n),n=new MANUAL_TWEEN.Tween(k).delay(g).to(4,{phase:400}).easing(TWEEN.Easing.Back.EaseIn),m.add(n)}}}function d(c){SharedObject.data.dt_canvas.style.left=.5*(c.target.innerWidth-SharedObject.data.dt_canvas.width)-1+"px",SharedObject.data.dt_canvas.style.top=.5*(c.target.innerHeight-SharedObject.data.dt_canvas.height)-1+"px",i.domElement.style.left=.5*(c.target.innerWidth-a)+10+"px",i.domElement.style.top=.5*(c.target.innerHeight-b)+10+"px"}var e,f,g,h,i,j,k,l,m,n,o=a,p=b;this.load=function(){l=new MANUAL_TWEEN.Manager,m=new MANUAL_TWEEN.Manager,j=[],g=new THREE.Camera(75,o/p,1,1e4),g.position.z=340,h=new THREE.Scene,i=new THREE.CanvasRenderer,i.domElement.style.position="absolute",i.domElement.style.left="0px",i.domElement.style.top="0px",i.setSize(o,p),this.preloaded=!0},this.show=function(){c(),this.container.appendChild(i.domElement),this.container.appendChild(SharedObject.data.dt_canvas),SharedObject.data.dt_canvas.style.left=.5*(this.target.innerWidth-SharedObject.data.dt_canvas.width)-1+"px",SharedObject.data.dt_canvas.style.top=.5*(this.target.innerHeight-SharedObject.data.dt_canvas.height)-1+"px",i.domElement.style.left=.5*(this.target.innerWidth-a)+10+"px",i.domElement.style.top=.5*(this.target.innerHeight-b)+10+"px",this.target.window.addEventListener("resize",d,!1)},this.hide=function(){this.container.removeChild(i.domElement),this.container.removeChild(SharedObject.data.dt_canvas),this.target.window.removeEventListener("resize",d,!1)},this.update=function(a,b,c){var d,e;.5>b?l.update(2e4*b):m.update(2e4*(b-.5));for(var f=0,n=j.length;n>f;f++)k=j[f],d=k.material[0].color,e=(500-k.position.z)/1500,d.r=e,d.g=e,d.b=e,d.updateStyleString(),k.geometry.vertices[5].position.y=k.geometry.vertices[4].position.y=5*Math.sin(k.phase%62.83);i.render(h,g)}}function CanvasBirds(a,b,c){"use strict";function d(){m=Date.now(),k=new THREE.Vector3(0,1e3,0),g=new THREE.Camera(75,n/o,1,1e4),g.position.z=500,h=new THREE.Scene,j=[],l=[],i=new THREE.CanvasRenderer,i.domElement.style.position="absolute",i.domElement.style.left="0px",i.domElement.style.top="0px",i.setSize(n,o),a.style.left="0px",a.appendChild(i.domElement),document.addEventListener("mousemove",f,!1)}function e(){var a,b;b=new Boid,l.push(b),b.position.x=100*Math.random()+900,b.position.y=600*Math.random()-300,b.position.z=200*Math.random()-100,b.velocity.x=2*Math.random()+1,b.velocity.y=2*Math.random()+1,b.velocity.z=2*Math.random()+1,b.setAvoidWalls(!0),b.setWorldSize(1e3,800,300),a=new THREE.Mesh(new Crow,r),j.push(a),a.phase=Math.floor(62.83*Math.random()),a.position=b.position,a.doubleSided=!0,h.addObject(a)}function f(a){k.x=a.clientX-p,k.y=-a.clientY+q}var g,h,i,j,k,l,m,n=b,o=c,p=n/2,q=o/2,r=new THREE.MeshColorFillMaterial(0),s=100;this.container=a,d(),this.update=function(){var a,b,c,d,f=Date.now()-m,n=parseInt(f/100)+1;s>=n&&n!=l.length&&e();for(var o=0,p=j.length;p>o;o++)b=l[o],b.run(l),k.z=b.position.z,b.repulse(k),c=j[o],a=c.material[0].color,a.r=a.g=a.b=(500-c.position.z)/1e3,a.updateStyleString(),c.rotation.y=Math.atan2(-b.velocity.z,b.velocity.x),c.rotation.z=Math.asin(b.velocity.y/b.velocity.length()),c.phase+=Math.max(0,c.rotation.z-.5)+.1,d=5*Math.sin(c.phase%62.83),c.geometry.vertices[5].position.y=d,c.geometry.vertices[4].position.y=d;i.render(h,g)}}function init(){audio.readyState>=3&&searchLoaded&&(clearInterval(lInterval),totalTime=audio.duration,canvasBirds=new CanvasBirds(bg,window.innerWidth,window.innerHeight),
addContents(),loadContents(),aSearch.value!=defaultSearchString?checkAddress():appendSearchField(),loop())}function preload(){createPreloader(),setTimeout(logIfTimedOut,3e5),loadMapContents(),loadInterval=setInterval(function(){addToPreloader(Math.round(100*getLoadedContents()/_contents.length)),checkIfPreloaded()?(clearInterval(loadInterval),preloaded()):loadDataFailed()&&(clearInterval(loadInterval),onNotEnoughTileData())},100),addToPreloader(Math.round(100*getLoadedContents()/_contents.length)),createTip()}function logIfTimedOut(){if(!checkIfPreloaded()){var a="Still waiting for "+getUnloadedContents()+" assets.";TraceKit.report("Preload Timeout\n"+a)}}function continuePreloading(){createPreloader(),loadInterval=setInterval(function(){addToPreloader(Math.round(100*getLoadedContents()/_contents.length)),checkIfPreloaded(!0)&&(clearInterval(loadInterval),preloaded())},100),addToPreloader(Math.round(100*getLoadedContents()/_contents.length)),createTip()}function preloaded(){createLauncher(),createTip(),sendStat("/30-End-loading")}function checkAddress(){clearButtonsArea(),removeAddressFeedback(),removeSuggestionListeners(),gLocation.checkAddress(aSearch.value,64),sendStat("/10-Address-search")}function checkAddressInputText(a){aSearch.value===defaultSearchString&&(aSearch.value="")}function restoreAddressInputText(a){""===aSearch.value&&(aSearch.value=defaultSearchString)}function handleKeyPress(a){var b=a.keyCode||a.which;13==b&&checkAddress()}function onSuccess(){launchSequencer(),preload(),sendStat("/20-Loading")}function onInvalidAddress(){removeAddressFeedback(),appendSearchField(),addressFeedback=document.createElement("div"),addressFeedback.id="gc_as",addressFeedback.innerHTML="We're having difficulty finding this address. Please try again.",searchField.appendChild(addressFeedback),addSuggestionListeners()}function onNotEnoughData(){removeAddressFeedback(),appendSearchField(),addressFeedback=document.createElement("div"),addressFeedback.id="gc_as",addressFeedback.innerHTML="The entered address does not contain enough data for this experiment to run.",searchField.appendChild(addressFeedback),addSuggestionListeners()}function onNotEnoughTileData(){removeAddressFeedback(),onSuggestionBlur(null),clearButtonsArea(),clearInterval(loadInterval),createNotEnoughDataLayout()}function removeAddressFeedback(){try{void 0!==addressFeedback&&searchField.removeChild(addressFeedback)}catch(a){}}function start(){document.getElementById("popup-warning").style.top="-40px",clearButtonsArea(),launchWindowManager(),createWindowSequence(),createContentSequence(),audio.addEventListener("ended",audioEnded,!1),sendStat("/40-Launch-film")}function launch(){launched=!0,audio.play(),clearButtonsArea(),fadeBlocker(90)}function checkPopupBlocker(){if("Chrome"==BrowserDetect.browser){window.open("blocker.html","test","menubar=0, resizable=0, location=0, toolbar=0, status=0, scrollbars=0, titlebar=0, left=0, top=0, width=100, height=100");document.getElementById("popup-warning").style.top="0px"}}function launchSequencer(){sequencer=new Sequencer}function loop(){TWEEN_MANAGER.update(),launched?playing&&(sequencer.update(audio.currentTime,0),audio.currentTime>287&&controller.kill()):isDrawing?drawingTool.update():canvasBirds.update(),window.requestAnimationFrame(loop)}function toggleMute(){audio.muted=!audio.muted}function togglePlayPause(){audio.paused?audio.play():audio.pause(),playing=!audio.paused,audio.paused?sequencer.pause():sequencer.resume()}function audioEnded(a){exitSequencer(),launched=!1,resuming=!0,fadeBlocker(0),sendStat("/80-End-film"),isKioskMode?trySearchAgain(a):createEndButtons()}function pausedByClose(){launched=!1,resuming=!0,createPausedState(),fadeBlocker(0)}function resumeAfterClose(a){windowsReady=0,audio.muted=!1,resetContents(),loadContents(),loadMapContents(),continuePreloading()}function replayVideo(a){audio.pause(),audio.currentTime=0,resumeAfterClose(a),sendStat("/Click-on-Replay-your-film"),sendStat("/20-Loading")}function showShareVideo(a){if(!document.getElementById("shareVideo")){var b=document.getElementById("buttons-area"),c=document.createElement("div");c.id="shareVideo",b.appendChild(c);var d=document.createElement("p");d.innerHTML="Copy and paste the link below to send this film <br />to someone with your address built in: ",c.appendChild(d);var e=document.createElement("input");e.id="aSearch",e.value="http://www.thewildernessdowntown.com/#"+storedAddress.replace(/\ /gi,"+"),e.setAttribute("readonly","readonly"),c.appendChild(e),e.focus(),e.select();var f=document.createElement("span");f.innerHTML="<b>[x]</b>",f.style.cursor="pointer",f.style.marginLeft="10px",c.appendChild(f),f.addEventListener("click",closeShareVideo,!1),sendStat("/Click-on-Share-your-film")}}function closeShareVideo(a){try{var b=document.getElementById("buttons-area"),c=document.getElementById("shareVideo");b.removeChild(c)}catch(d){}}function createSearchField(){searchField=document.createElement("div"),searchField.id="search-form",searchField.appendChild(aSearch),searchBtn=document.createElement("img"),searchBtn.width=77,searchBtn.height=20,searchBtn.src="img/search.png",searchBtn.onload=function(){searchLoaded=!0},searchBtn.id="search-img",searchBtn.addEventListener("click",checkAddress,!1),searchField.appendChild(searchBtn),searchHlp=document.createElement("span"),searchHlp.innerHTML="<b>[?]</b>",searchHlp.style.cursor="pointer",searchHlp.addEventListener("mouseover",showSearchHelp,!1),searchHlp.addEventListener("mouseout",hideHelp,!1),searchField.appendChild(searchHlp),warningBlock=document.createElement("div"),warningBlock.id="warning-block",warningBlock.innerHTML=warningCopy,searchField.appendChild(warningBlock)}function createWarning(a){var b=document.createElement("div");b.id="warning",b.innerHTML="<p>"+a+"</p>";var c=document.getElementById("top");c.appendChild(b)}function createTryAnywayButton(){var a=document.createElement("input");a.setAttribute("class","button"),a.id="tryanyway",a.type="button",a.value="Try Anyway",a.addEventListener("click",function(){var a=document.getElementById("top"),b=document.getElementById("warning");a.removeChild(b),createSearchField(),createPreloader()},!1);var b=document.getElementById("warning");b.appendChild(a)}function downloadChrome(a){window.location="http://www.google.com/chrome/",sendStat("/Click-on-Downlod-Chrome")}function appendSearchField(){clearButtonsArea(),buttonsArea.appendChild(searchField)}function clearButtonsArea(){for(buttonsArea.innerHTML="";buttonsArea.lastChild;)buttonsArea.removeChild(buttonsArea.lastChild)}function createPreloader(){var a=document.createElement("div"),b=document.createElement("div"),c=new Image;a.id="preloader",clearButtonsArea(),buttonsArea.appendChild(a),c.src="img/preloader.gif",a.appendChild(c),a.appendChild(b),b.id="preloaderText",styleElement(b,"paddingTop: 5px")}function addToPreloader(a){var b=document.getElementById("preloaderText");b.innerHTML="PLEASE WAIT... LOADING "+a+" <span id='percentage'>%</span>"}function createNotEnoughDataLayout(){var a,b;clearButtonsArea(),b=document.createElement("div"),b.setAttribute("class","centered"),b.innerHTML="Your address doesn't contain enough Street-View and/or Google Maps data to 100% enjoy this experience. You may want to try another address, or the name of your school and its town could work as well.<br/><br/>",buttonsArea.appendChild(b),a=document.createElement("input"),a.type=a.className="button",a.id="continueAnywayButton",a.value="Continue Anyway",b.appendChild(a),a.addEventListener("click",continueAnyway,!1),a=document.createElement("input"),a.type=a.className="button",a.id="trySearchAgainButton",a.value="Search Again",b.appendChild(a),a.addEventListener("click",trySearchAgain,!1)}function trySearchAgain(a){aSearch.value=defaultSearchString,resetMapContents(),appendSearchField(),addSuggestionListeners()}function continueAnyway(a){continuePreloading()}function createTip(){if(!document.getElementById("tipText")){var a=document.createElement("div");a.setAttribute("class","subtitle-inside"),a.id="tipText",a.innerHTML="This film is processor intensive. <br />Please shut down other programs and close unnecessary browser tabs. Doing this will enhance your viewing experience. Thanks.",buttonsArea.appendChild(a)}}function createLauncher(){var a=document.createElement("div"),b=document.createElement("input");b.setAttribute("class","button"),b.type="button",b.value="Play Film",b.id="launcherButton",b.addEventListener("click",start,!1),clearButtonsArea(),a.innerHTML="We're ready. Please turn your speakers on.<br/><br/>",a.appendChild(b),buttonsArea.appendChild(a)}function createEndButtons(){var a=document.createElement("div"),b=document.createElement("input"),c=document.createElement("input"),d=document.createElement("input"),e=document.createElement("input"),f=document.createElement("span"),g=document.createElement("span");document.createElement("div");styleElement(a,"textAlign: center;");var h="210px";b.setAttribute("class","button"),b.type="button",b.value="Replay Your Film",b.style.marginRight="15px",b.style.width=h,b.addEventListener("click",replayVideo,!1),c.setAttribute("class","button"),c.type="button",c.value="Send your postcard downtown",c.style.marginRight="10px",c.style.width=h,c.addEventListener("click",continueDrawing,!1),f.innerHTML="<b>[?]</b>",f.style.cursor="pointer",f.addEventListener("mouseover",showCodeHelp,!1),f.addEventListener("mouseout",hideHelp,!1),e.setAttribute("class","button"),e.type="button",e.value="Share your film",e.style.marginRight="15px",e.style.marginTop="20px",e.style.width=h,e.addEventListener("click",showShareVideo,!1),d.setAttribute("class","button"),d.type="button",d.value="Respond to a postcard",d.style.marginRight="10px",d.style.marginTop="20px",d.style.width=h,d.addEventListener("click",respondPostcard,!1),g.innerHTML="<b>[?]</b>",g.style.cursor="pointer",g.addEventListener("mouseover",showCodeHelp2,!1),g.addEventListener("mouseout",hideHelp,!1),clearButtonsArea(),a.appendChild(b),a.appendChild(c),a.appendChild(f),a.appendChild(e),a.appendChild(d),a.appendChild(g),buttonsArea.appendChild(a)}function createPausedState(){var a=document.createElement("div"),b=document.createElement("input");b.setAttribute("class","button"),b.type="button",b.value="Resume",b.addEventListener("click",resumeAfterClose,!1),styleElement(a,"textAlign: center;"),clearButtonsArea(),a.innerHTML="We Used To Wait has paused because you have closed a window.<br/><br/>",a.appendChild(b),buttonsArea.appendChild(a)}function continueDrawing(a){try{final_drawing.close()}catch(b){}var c=1e3,d=770,e=(screen.width-c)/2,f=(screen.height-d)/2;final_drawing=window.open("drawingtool.html","final_drawing","width="+c+", height="+d+", left="+e+", top="+f),sendStat("/Click-on-Send-your-postcard-downton")}function respondPostcard(a){try{final_drawing.close()}catch(b){}var c=1e3,d=770,e=(screen.width-c)/2,f=(screen.height-d)/2;final_drawing=window.open("respond.html","final_drawing","width="+c+", height="+d+", left="+e+", top="+f),sendStat("/Click-on-Respond-to-a-postcard")}function resizeHandler(a){var b=document.getElementById("top"),c=window.innerHeight>700?100:100*((window.innerHeight-550)/150);0>c&&(c=0),b.style.top=c+"px"}function fadeBlocker(a){blockerTween.destroy(),blockerTween=new TWEEN.Tween(blockerSettings),blockerTween.easing(TWEEN.Easing.Linear.EaseOut),blockerTween.onUpdate(fadeBlockerUpdate),blockerTween.onComplete(checkBlockerVisibility),blockerTween.to(1,{opacity:a})}function fadeBlockerUpdate(){var a=parseInt(blockerSettings.opacity),b=blockerSettings.opacity/100;blocker.style.filter="alpha(opacity="+a+")",blocker.style.opacity=b+"",blocker.style["-moz-opacity"]=b+"",blocker.style.visibility=b>.1?"visible":"hidden"}function checkBlockerVisibility(){var a=blockerSettings.opacity>50?90:0;blockerSettings.opacity=a,fadeBlockerUpdate()}function showCodeHelp(a){showHelp(a,"Continue your postcard and send it downtown. It could go to the Wilderness Machine, the Arcade Fire tour visuals, or another Wilderness Downtown user.")}function showCodeHelp2(a){showHelp(a,"If you’ve found a postcard you can respond to it here. You’ll need the code in its lower right hand corner to do so.")}function showSearchHelp(a){showHelp(a,"This can be the home you grew up in or another place from your childhood. Entering the name of a school and the town will work as well.")}function showHelp(a,b){hideHelp(a),codeHelper=document.createElement("div"),codeHelper.id="help",codeHelper.innerHTML=b,document.body.appendChild(codeHelper),repositionCodeHelper(a),a.target.addEventListener("mousemove",repositionCodeHelper,!1)}function repositionCodeHelper(a){codeHelper.style.top=a.clientY-codeHelper.offsetHeight-10+"px",codeHelper.style.left=a.clientX-codeHelper.offsetWidth/2+"px"}function hideHelp(a){try{document.body.removeChild(codeHelper)}catch(b){}}function hideWarning(a){try{document.body.removeChild(warning)}catch(b){}}function refresh(a){window.location="/"}function openCredits(){var a=465,b=600,c=(screen.width-a)/2,d=(screen.height-b)/2;window.open("credits.html","credits","width="+a+", height="+b+", left="+c+", top="+d+", location=0, menubar=0, toolbar=0, scrollbars=1"),sendStat("/Click-on-Credits")}function openTerms(){var a=400,b=600,c=(screen.width-a)/2,d=(screen.height-b)/2;window.open("terms.html","terms","width="+a+", height="+b+", left="+c+", top="+d+", location=0, menubar=0, toolbar=0, scrollbars=1"),sendStat("/Click-on-Terms")}function openPrivacyPolicy(){var a=400,b=600,c=(screen.width-a)/2,d=(screen.height-b)/2;window.open("privacy-policy.html","privacyPolicy","width="+a+", height="+b+", left="+c+", top="+d+", location=0, menubar=0, toolbar=0, scrollbars=1"),sendStat("/Click-on-Privacy-Policy")}function openTheWildernessMachine(){var a=465,b=600,c=(screen.width-a)/2,d=(screen.height-b)/2;window.open("the-wilderness-machine.html","theWildernessMachine","width="+a+", height="+b+", left="+c+", top="+d+", location=0, menubar=0, toolbar=0, scrollbars=1"),sendStat("/Click-on-The-Wilderness-Machine")}function sendStat(a){try{pageTracker._trackPageview(a)}catch(b){}}function addSuggestionListeners(){document.addEventListener("keydown",onSuggestionKeyDown,!1),document.addEventListener("blur",onSuggestionBlur,!1),aSearch.addEventListener("focus",startSuggestionsLookup,!1),aSearch.addEventListener("blur",stopSuggestionsLookup,!1),suggestInterval=setInterval(checkAsYouType,100)}function removeSuggestionListeners(){document.removeEventListener("keydown",onSuggestionKeyDown,!1),document.removeEventListener("blur",onSuggestionBlur,!1),aSearch.removeEventListener("focus",startSuggestionsLookup,!1),aSearch.removeEventListener("blur",stopSuggestionsLookup,!1),clearInterval(suggestInterval)}function startSuggestionsLookup(a){searchFocus=!0,storedAddress=""}function stopSuggestionsLookup(a){searchFocus=!1,onSuggestionBlur(a)}function checkAsYouType(a){storedAddress!=aSearch.value&&searchFocus&&(storedAddress=aSearch.value,suggestionsGeocoder.geocode({address:storedAddress},function(a,b){b==google.maps.GeocoderStatus.OK&&renderSuggestions(a)}))}function renderSuggestions(a){var b,c=document.getElementById("top"),d=parseFloat(c.style.top.replace("px","")),e=window.innerHeight>600?window.innerHeight:600,f=e-d-440;removeAddressFeedback(),void 0!==autoSuggestions&&onSuggestionBlur(null),autoSuggestions=document.createElement("div"),autoSuggestions.id="gc_as",suggestionResults={results:[],selectedIndex:-1};for(var g in a)b=document.createElement("div"),styleElement(b,"padding: 4px; overflow:hidden; z-index:"+suggestionResults.results.length+"; cursor: pointer"),b.innerHTML=a[g].formatted_address,b.addEventListener("mousedown",selectResultByMouse,!1),b.addEventListener("mouseover",rollOverItem,!1),b.addEventListener("mouseout",rollOutItem,!1),autoSuggestions.appendChild(b),suggestionResults.results.push(b);autoSuggestions.offsetHeight>f&&(autoSuggestions.style.height=f+"px"),searchField.appendChild(autoSuggestions)}function onSuggestionKeyDown(a){40==a.keyCode?selectSuggestionResult(1):38==a.keyCode?selectSuggestionResult(-1):13==a.keyCode?(selectCurrentSuggestion(),onSuggestionBlur(a)):27==a.keyCode&&(onSuggestionBlur(a),aSearch.blur())}function onSuggestionBlur(a){try{searchField.removeChild(autoSuggestions),suggestionResults={results:[],selectedIndex:-1}}catch(b){}}function selectSuggestionResult(a){var b=0;if(void 0!==suggestionResults){suggestionResults.selectedIndex+=a,suggestionResults.selectedIndex<0?suggestionResults.selectedIndex=suggestionResults.results.length-1:suggestionResults.selectedIndex>=suggestionResults.results.length&&(suggestionResults.selectedIndex=0);for(var c=0;c<suggestionResults.results.length;c++)c<=suggestionResults.selectedIndex&&(b+=suggestionResults.results[c].offsetHeight),suggestionResults.results[c].style.color=c==suggestionResults.selectedIndex?"#212121":"#666",suggestionResults.results[c].style.fontWeight=c==suggestionResults.selectedIndex?"bold":"normal";b>autoSuggestions.offsetHeight+autoSuggestions.scrollTop?autoSuggestions.scrollTop=b-autoSuggestions.offsetHeight:b-suggestionResults.results[suggestionResults.selectedIndex].offsetHeight<Math.abs(autoSuggestions.scrollTop)&&(autoSuggestions.scrollTop=b-suggestionResults.results[suggestionResults.selectedIndex].offsetHeight)}}function selectCurrentSuggestion(){void 0!==suggestionResults&&suggestionResults.selectedIndex>-1&&suggestionResults.selectedIndex<suggestionResults.results.length&&selectAddress(suggestionResults.results[suggestionResults.selectedIndex].innerHTML)}function selectAddress(a){aSearch.value=a,storedAddress=aSearch.value,aSearch.blur(),onSuggestionBlur(null),checkAddress()}function rollOverItem(a){var b=a.target;b.style.fontWeight="bold"}function rollOutItem(a){var b=a.target;b.style.fontWeight=parseInt(b.style.zIndex)!=suggestionResults.selectedIndex?"normal":"bold"}function selectResultByMouse(a){var b=a.target;selectAddress(b.innerHTML)}!function(a,b){function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function d(a){return"undefined"==typeof a}var e={},f=a.TraceKit,g=[].slice,h="?";e.noConflict=function(){return a.TraceKit=f,e},e.wrap=function(a){function b(){try{return a.apply(this,arguments)}catch(b){throw e.report(b),b}}return b},e.report=function(){function b(a){i.push(a)}function d(a){for(var b=i.length-1;b>=0;--b)i[b]===a&&i.splice(b,1)}function f(a,b){var d=null;if(!b||e.collectWindowErrors){for(var f in i)if(c(i,f))try{i[f].apply(null,[a].concat(g.call(arguments,2)))}catch(h){d=h}if(d)throw d}}function h(b){var c=g.call(arguments,1);if(k){if(j===b)return;var d=k;k=null,j=null,f.apply(null,[d,null].concat(c))}var h=e.computeStackTrace(b);throw k=h,j=b,a.setTimeout(function(){j===b&&(k=null,j=null,f.apply(null,[h,null].concat(c)))},h.incomplete?2e3:0),b}var i=[],j=null,k=null,l=a.onerror;return a.onerror=function(a,b,c){var d=null;if(k)e.computeStackTrace.augmentStackTraceWithInitialElement(k,b,c,a),d=k,k=null,j=null;else{var g={url:b,line:c};g.func=e.computeStackTrace.guessFunctionName(g.url,g.line),g.context=e.computeStackTrace.gatherContext(g.url,g.line),d={mode:"onerror",message:a,url:document.location.href,stack:[g],useragent:navigator.userAgent}}if(l){var h=l.apply(this,arguments);return h&&h.notifyTraceKitHandlers===!1||f(d,"from window.onerror"),h}return f(d,"from window.onerror"),!1},h.subscribe=b,h.unsubscribe=d,h}(),e.computeStackTrace=function(){function b(b){function c(){try{return new a.XMLHttpRequest}catch(b){return new a.ActiveXObject("Microsoft.XMLHTTP")}}if(!e.remoteFetching)return"";try{var d=c();return d.open("GET",b,!1),d.send(""),d.responseText}catch(f){return""}}function f(a){if(!c(w,a)){var d="";-1!==a.indexOf(document.domain)&&(d=b(a)),w[a]=d?d.split("\n"):[]}return w[a]}function g(a,b){var c,e=/function ([^(]*)\(([^)]*)\)/,g=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,i="",j=10,k=f(a);if(!k.length)return h;for(var l=0;j>l;++l)if(i=k[b-l]+i,!d(i)){if(c=g.exec(i))return c[1];if(c=e.exec(i))return c[1]}return h}function i(a,b){var c=f(a);if(!c.length)return null;var g=[],h=Math.floor(e.linesOfContext/2),i=h+e.linesOfContext%2,j=Math.max(0,b-h-1),k=Math.min(c.length,b+i-1);b-=1;for(var l=j;k>l;++l)d(c[l])||g.push(c[l]);return g.length>0?g:null}function j(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g,"\\$&")}function k(a){return j(a).replace("<","(?:<|&lt;)").replace(">","(?:>|&gt;)").replace("&","(?:&|&amp;)").replace('"','(?:"|&quot;)').replace(/\s+/g,"\\s+")}function l(a,b){for(var c,d,e=0,g=b.length;g>e;++e)if((c=f(b[e])).length&&(c=c.join("\n"),d=a.exec(c)))return{url:b[e],line:c.substring(0,d.index).split("\n").length,column:d.index-c.lastIndexOf("\n",d.index)-1};return null}function m(a,b,c){var d,e=f(b),g=new RegExp("\\b"+j(a)+"\\b");return c-=1,e&&e.length>c&&(d=g.exec(e[c]))?d.index:null}function n(b){for(var c,d,e,f,g=[a.location.href],h=document.getElementsByTagName("script"),i=""+b,m=/^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,n=/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,o=0;o<h.length;++o){var p=h[o];p.src&&g.push(p.src)}if(e=m.exec(i)){var q=e[1]?"\\s+"+e[1]:"",r=e[2].split(",").join("\\s*,\\s*");c=j(e[3]).replace(/;$/,";?"),d=new RegExp("function"+q+"\\s*\\(\\s*"+r+"\\s*\\)\\s*{\\s*"+c+"\\s*}")}else d=new RegExp(j(i).replace(/\s+/g,"\\s+"));if(f=l(d,g))return f;if(e=n.exec(i)){var s=e[1];if(c=k(e[2]),d=new RegExp("on"+s+"=[\\'\"]\\s*"+c+"\\s*[\\'\"]","i"),f=l(d,g[0]))return f;if(d=new RegExp(c),f=l(d,g))return f}return null}function o(a){if(!a.stack)return null;for(var b,c,d=/^\s*at (?:((?:\[object object\])?\S+) )?\(?((?:file|http|https):.*?):(\d+)(?::(\d+))?\)?\s*$/i,e=/^\s*(\S*)(?:\((.*?)\))?@((?:file|http|https).*?):(\d+)(?::(\d+))?\s*$/i,f=a.stack.split("\n"),j=[],k=/^(.*) is undefined$/.exec(a.message),l=0,n=f.length;n>l;++l){if(b=e.exec(f[l]))c={url:b[3],func:b[1]||h,args:b[2]?b[2].split(","):"",line:+b[4],column:b[5]?+b[5]:null};else{if(!(b=d.exec(f[l])))continue;c={url:b[2],func:b[1]||h,line:+b[3],column:b[4]?+b[4]:null}}!c.func&&c.line&&(c.func=g(c.url,c.line)),c.line&&(c.context=i(c.url,c.line)),j.push(c)}return j[0]&&j[0].line&&!j[0].column&&k&&(j[0].column=m(k[1],j[0].url,j[0].line)),j.length?{mode:"stack",name:a.name,message:a.message,url:document.location.href,stack:j,useragent:navigator.userAgent}:null}function p(a){for(var b,c=a.stacktrace,d=/ line (\d+), column (\d+) in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\) in (.*):\s*$/i,e=c.split("\n"),f=[],h=0,j=e.length;j>h;h+=2)if(b=d.exec(e[h])){var k={line:+b[1],column:+b[2],func:b[3]||b[4],args:b[5]?b[5].split(","):[],url:b[6]};if(!k.func&&k.line&&(k.func=g(k.url,k.line)),k.line)try{k.context=i(k.url,k.line)}catch(l){}k.context||(k.context=[e[h+1]]),f.push(k)}return f.length?{mode:"stacktrace",name:a.name,message:a.message,url:document.location.href,stack:f,useragent:navigator.userAgent}:null}function q(b){var d=b.message.split("\n");if(d.length<4)return null;var e,h,j,m,n=/^\s*Line (\d+) of linked script ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,o=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,p=/^\s*Line (\d+) of function script\s*$/i,q=[],r=document.getElementsByTagName("script"),s=[];for(h in r)c(r,h)&&!r[h].src&&s.push(r[h]);for(h=2,j=d.length;j>h;h+=2){var t=null;if(e=n.exec(d[h]))t={url:e[2],func:e[3],line:+e[1]};else if(e=o.exec(d[h])){t={url:e[3],func:e[4]};var u=+e[1],v=s[e[2]-1];if(v&&(m=f(t.url))){m=m.join("\n");var w=m.indexOf(v.innerText);w>=0&&(t.line=u+m.substring(0,w).split("\n").length)}}else if(e=p.exec(d[h])){var x=a.location.href.replace(/#.*$/,""),y=e[1],z=new RegExp(k(d[h+1]));m=l(z,[x]),t={url:x,line:m?m.line:y,func:""}}if(t){t.func||(t.func=g(t.url,t.line));var A=i(t.url,t.line),B=A?A[Math.floor(A.length/2)]:null;A&&B.replace(/^\s*/,"")===d[h+1].replace(/^\s*/,"")?t.context=A:t.context=[d[h+1]],q.push(t)}}return q.length?{mode:"multiline",name:b.name,message:d[0],url:document.location.href,stack:q,useragent:navigator.userAgent}:null}function r(a,b,c,d){var e={url:b,line:c};if(e.url&&e.line){a.incomplete=!1,e.func||(e.func=g(e.url,e.line)),e.context||(e.context=i(e.url,e.line));var f=/ '([^']+)' /.exec(d);if(f&&(e.column=m(f[1],e.url,e.line)),a.stack.length>0&&a.stack[0].url===e.url){if(a.stack[0].line===e.line)return!1;if(!a.stack[0].line&&a.stack[0].func===e.func)return a.stack[0].line=e.line,a.stack[0].context=e.context,!1}return a.stack.unshift(e),a.partial=!0,!0}return a.incomplete=!0,!1}function s(a,b){for(var c,d,f,i=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,j=[],k={},l=!1,o=s.caller;o&&!l;o=o.caller)if(o!==t&&o!==e.report){if(d={url:null,func:h,line:null,column:null},o.name?d.func=o.name:(c=i.exec(o.toString()))&&(d.func=c[1]),f=n(o)){d.url=f.url,d.line=f.line,d.func===h&&(d.func=g(d.url,d.line));var p=/ '([^']+)' /.exec(a.message||a.description);p&&(d.column=m(p[1],f.url,f.line))}k[""+o]?l=!0:k[""+o]=!0,j.push(d)}b&&j.splice(0,b);var q={mode:"callers",name:a.name,message:a.message,url:document.location.href,stack:j,useragent:navigator.userAgent};return r(q,a.sourceURL||a.fileName,a.line||a.lineNumber,a.message||a.description),q}function t(a,b){var c=null;b=null==b?0:+b;try{if(c=p(a))return c}catch(d){if(v)throw d}try{if(c=o(a))return c}catch(d){if(v)throw d}try{if(c=q(a))return c}catch(d){if(v)throw d}try{if(c=s(a,b+1))return c}catch(d){if(v)throw d}return{mode:"failed"}}function u(a){a=(null==a?0:+a)+1;try{throw new Error}catch(b){return t(b,a+1)}return null}var v=!1,w={};return t.augmentStackTraceWithInitialElement=r,t.guessFunctionName=g,t.gatherContext=i,t.ofCaller=u,t}(),function(){var b=function(b){var c=a[b];a[b]=function(){var a=g.call(arguments),b=a[0];return"function"==typeof b&&(a[0]=e.wrap(b)),c.apply?c.apply(this,a):c(a[0],a[1])}};b("setTimeout"),b("setInterval")}(),function(a){if(a){var b=a.event.add;a.event.add=function(c,d,f,g,h){var i;return f.handler?(i=f.handler,f.handler=e.wrap(f.handler)):(i=f,f=e.wrap(f)),i.guid?f.guid=i.guid:f.guid=i.guid=a.guid++,b.call(this,c,d,f,g,h)};var c=a.fn.ready;a.fn.ready=function(a){return c.call(this,e.wrap(a))};var d=a.ajax;a.ajax=function(b){for(var c,f=["complete","error","success"];c=f.pop();)a.isFunction(b[c])&&(b[c]=e.wrap(b[c]));try{return d.call(this,b)}catch(g){throw e.report(g),g}}}}(a.jQuery),e.remoteFetching||(e.remoteFetching=!0),e.collectWindowErrors||(e.collectWindowErrors=!0),(!e.linesOfContext||e.linesOfContext<1)&&(e.linesOfContext=11),a.TraceKit=e}(window);var reporter=ErrorReporter("/errors");TraceKit.report.subscribe(reporter.report);var SharedObject=function(){return{toString:function(){return"[object SharedObject]"},getSpectrum:function(a,b){var c=0,d=Math.round(60*b),e=window["spectrum_"+a];return void 0!==e&&void 0!==e[d]&&(c=e[d]),c},getTitleData:function(){var a=parseInt(Math.random()*titleMemoryData.length);return titleMemoryData[a]},data:Object}}();SharedObject.data={},SharedObject.data.dt_shared_memory="";var MERCATOR_RANGE=256;MercatorProjection.prototype.fromLatLngToPoint=function(a,b){var c=this,d=b||new google.maps.Point(0,0),e=c.pixelOrigin_;d.x=e.x+a.lng()*c.pixelsPerLonDegree_;var f=bound(Math.sin(degreesToRadians(a.lat())),-.9999,.9999);return d.y=e.y+.5*Math.log((1+f)/(1-f))*-c.pixelsPerLonRadian_,d},MercatorProjection.prototype.fromPointToLatLng=function(a){var b=this,c=b.pixelOrigin_,d=(a.x-c.x)/b.pixelsPerLonDegree_,e=(a.y-c.y)/-b.pixelsPerLonRadian_,f=radiansToDegrees(2*Math.atan(Math.exp(e))-Math.PI/2);return new google.maps.LatLng(f,d)};var gLocation=function(){function a(a){e=a;var c=new Date;Math.random(c.getTime());var d=2*Math.random()*Math.PI;randlat=a.lat()+l*Math.cos(d),randlong=a.lng()+l*Math.sin(d);var g={origin:a,destination:new google.maps.LatLng(randlat,randlong),travelMode:google.maps.DirectionsTravelMode.WALKING};i.route(g,function(a,c){c==google.maps.DirectionsStatus.OK?(p=a.routes[0].copyrights,f=a.routes[0].overview_path,b(),onSuccess()):onNotEnoughData()})}function b(){var a=0,b=0;g=0;var c,e,h,i,j=!1,k=[];for(e=1;2>=e;e++)for(c=1;c<f.length-1;c++){h=f[c],i=f[c-1];var m=f[c+1];a=d(i,h);var n=h.lat()-i.lat(),o=h.lng()-i.lng(),p=m.lat()-h.lat(),q=m.lng()-h.lng(),r=Math.atan2(o,n),s=Math.atan2(q,p),t=Math.sqrt(n*n+o*o),u=Math.sqrt(p*p+q*q),v=s-r;if(v+=2*Math.PI,v%=2*Math.PI,v>.16/e){var w=3e-5/e;t>w&&u>w&&(r+=Math.PI,f[c]=new google.maps.LatLng(h.lat()+w*Math.cos(r),h.lng()+w*Math.sin(r)),f.splice(c+1,0,new google.maps.LatLng(h.lat()+w*Math.cos(s),h.lng()+w*Math.sin(s))),c++)}}for(k.push(f[0]),c=1;c<f.length;c++){if(h=f[c],i=f[c-1],a=d(i,h),b+a>l){var x=l-b,y=d(i,h),z=h.lat()-i.lat(),A=h.lng()-i.lng(),B=new google.maps.LatLng(i.lat()+z*x/y,i.lng()+A*x/y);a=d(i,B),h=B,j=!0}if(k.push(h),b+=a,j)break}for(f=k,f.reverse(),b=0,f[0].acc_distance=0,f[0].distance=0,c=1;c<f.length;c++){h=f[c];var C=f[c-1];a=d(h,C),b+=a,h.distance=a,h.acc_distance=b}g=b}function c(a,b){0>a&&(a=0),a>1&&(a=1);var c=a*g;b===!0&&(c=a*m);for(var e=f[f.length-1],h=0;h<f.length-1;h++)if(f[h+1].acc_distance>=c){var i=f[h],j=f[h+1],k=c-i.acc_distance,l=k/j.distance,o=j.lat()-i.lat(),p=j.lng()-i.lng();e=new google.maps.LatLng(i.lat()+o*l,i.lng()+p*l),n=i.acc_distance+d(i,e);break}return e}function d(a,b){var c=b.lat()-a.lat(),d=b.lng()-a.lng();return Math.sqrt(c*c+d*d)}var e,f,g,h=new google.maps.Geocoder,i=new google.maps.DirectionsService,j=(new MercatorProjection,4e-5),k=60,l=0,m=0,n=0,o=0,p="";return{checkAddress:function(b,c){k=c,l=j*k,m=34.409*j,h.geocode({address:b},function(b,c){c==google.maps.GeocoderStatus.OK?a(b[0].geometry.location):onInvalidAddress()})},getPosition:function(a,b){return c(a,b)},getLocation:function(){return e},getRoute:function(){return f},getSP:function(){return f[o]},getCopyright:function(){return p}}}(),THREE=THREE||{};THREE.Color=function(a){this.__styleString="rgba(0, 0, 0, 1)",this.setHex=function(a){this.hex=a,this.updateRGBA(),this.updateStyleString()},this.setRGBA=function(a,b,c,d){this.r=a,this.g=b,this.b=c,this.a=d,this.updateHex(),this.updateStyleString()},this.updateHex=function(){this.hex=Math.floor(255*this.a)<<24|Math.floor(255*this.r)<<16|Math.floor(255*this.g)<<8|Math.floor(255*this.b)},this.updateRGBA=function(){this.a=(this.hex>>24&255)/255,this.r=(this.hex>>16&255)/255,this.g=(this.hex>>8&255)/255,this.b=(255&this.hex)/255},this.updateStyleString=function(){this.__styleString="rgba("+Math.floor(255*this.r)+","+Math.floor(255*this.g)+","+Math.floor(255*this.b)+","+this.a+")"},this.toString=function(){return"THREE.Color ( r: "+this.r+", g: "+this.g+", b: "+this.b+", a: "+this.a+", hex: "+this.hex+" )"},this.setHex(a)},THREE.Vector2=function(a,b){this.x=a||0,this.y=b||0},THREE.Vector2.prototype={set:function(a,b){this.x=a,this.y=b},copy:function(a){this.x=a.x,this.y=a.y},addSelf:function(a){this.x+=a.x,this.y+=a.y},add:function(a,b){this.x=a.x+b.x,this.y=a.y+b.y},subSelf:function(a){this.x-=a.x,this.y-=a.y},sub:function(a,b){this.x=a.x-b.x,this.y=a.y-b.y},multiplyScalar:function(a){this.x*=a,this.y*=a},unit:function(){this.multiplyScalar(1/this.length())},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSq:function(){return this.x*this.x+this.y*this.y},negate:function(){this.x=-this.x,this.y=-this.y},clone:function(){return new THREE.Vector2(this.x,this.y)},toString:function(){return"THREE.Vector2 ("+this.x+", "+this.y+")"}},THREE.Vector3=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0},THREE.Vector3.prototype={set:function(a,b,c){this.x=a,this.y=b,this.z=c},copy:function(a){this.x=a.x,this.y=a.y,this.z=a.z},add:function(a,b){this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z},addSelf:function(a){this.x+=a.x,this.y+=a.y,this.z+=a.z},addScalar:function(a){this.x+=a,this.y+=a,this.z+=a},sub:function(a,b){this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z},subSelf:function(a){this.x-=a.x,this.y-=a.y,this.z-=a.z},cross:function(a,b){this.x=a.y*b.z-a.z*b.y,this.y=a.z*b.x-a.x*b.z,this.z=a.x*b.y-a.y*b.x},crossSelf:function(a){var b=this.x,c=this.y,d=this.z;
this.x=c*a.z-d*a.y,this.y=d*a.x-b*a.z,this.z=b*a.y-c*a.x},multiplySelf:function(a){this.x*=a.x,this.y*=a.y,this.z*=a.z},multiplyScalar:function(a){this.x*=a,this.y*=a,this.z*=a},divideScalar:function(a){this.x/=a,this.y/=a,this.z/=a},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},negate:function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},normalize:function(){this.multiplyScalar(this.length()>0?1/this.length():0)},isZero:function(){var a=1e-4;return Math.abs(this.x)<a&&Math.abs(this.y)<a&&Math.abs(this.z)<a},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},toString:function(){return"THREE.Vector3 ( "+this.x+", "+this.y+", "+this.z+" )"}},THREE.Vector4=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=d||1},THREE.Vector4.prototype={set:function(a,b,c,d){this.x=a,this.y=b,this.z=c,this.w=d},copy:function(a){this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w},add:function(a,b){this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w},addSelf:function(a){this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w},sub:function(a,b){this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w},subSelf:function(a){this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},toString:function(){return"THREE.Vector4 ("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}},THREE.Rectangle=function(){function a(){f=d-b,g=e-c}var b,c,d,e,f,g,h=!0;this.getX=function(){return b},this.getY=function(){return c},this.getWidth=function(){return f},this.getHeight=function(){return g},this.getX1=function(){return b},this.getY1=function(){return c},this.getX2=function(){return d},this.getY2=function(){return e},this.set=function(f,g,i,j){h=!1,b=f,c=g,d=i,e=j,a()},this.addPoint=function(f,g){h?(h=!1,b=f,c=g,d=f,e=g):(b=Math.min(b,f),c=Math.min(c,g),d=Math.max(d,f),e=Math.max(e,g)),a()},this.addRectangle=function(f){h?(h=!1,b=f.getX1(),c=f.getY1(),d=f.getX2(),e=f.getY2()):(b=Math.min(b,f.getX1()),c=Math.min(c,f.getY1()),d=Math.max(d,f.getX2()),e=Math.max(e,f.getY2())),a()},this.inflate=function(f){b-=f,c-=f,d+=f,e+=f,a()},this.minSelf=function(f){b=Math.max(b,f.getX1()),c=Math.max(c,f.getY1()),d=Math.min(d,f.getX2()),e=Math.min(e,f.getY2()),a()},this.instersects=function(a){return Math.min(d,a.getX2())-Math.max(b,a.getX1())>=0&&Math.min(e,a.getY2())-Math.max(c,a.getY1())>=0},this.empty=function(){h=!0,b=0,c=0,d=0,e=0,a()},this.isEmpty=function(){return h},this.toString=function(){return"THREE.Rectangle (x1: "+b+", y1: "+e+", x2: "+d+", y1: "+c+", width: "+f+", height: "+g+")"}},THREE.Matrix4=function(){this._x=new THREE.Vector3,this._y=new THREE.Vector3,this._z=new THREE.Vector3},THREE.Matrix4.prototype={n11:1,n12:0,n13:0,n14:0,n21:0,n22:1,n23:0,n24:0,n31:0,n32:0,n33:1,n34:0,n41:0,n42:0,n43:0,n44:1,identity:function(){this.n11=1,this.n12=0,this.n13=0,this.n14=0,this.n21=0,this.n22=1,this.n23=0,this.n24=0,this.n31=0,this.n32=0,this.n33=1,this.n34=0,this.n41=0,this.n42=0,this.n43=0,this.n44=1},lookAt:function(a,b,c){var d=this._x,e=this._y,f=this._z;f.sub(a,b),f.normalize(),d.cross(c,f),d.normalize(),e.cross(f,d),e.normalize(),this.n11=d.x,this.n12=d.y,this.n13=d.z,this.n14=-d.dot(a),this.n21=e.x,this.n22=e.y,this.n23=e.z,this.n24=-e.dot(a),this.n31=f.x,this.n32=f.y,this.n33=f.z,this.n34=-f.dot(a)},transform:function(a){var b=a.x,c=a.y,d=a.z,e=a.w?a.w:1;a.x=this.n11*b+this.n12*c+this.n13*d+this.n14*e,a.y=this.n21*b+this.n22*c+this.n23*d+this.n24*e,a.z=this.n31*b+this.n32*c+this.n33*d+this.n34*e,e=this.n41*b+this.n42*c+this.n43*d+this.n44*e,a.w?a.w=e:(a.x=a.x/e,a.y=a.y/e,a.z=a.z/e)},crossVector:function(a){var b=new THREE.Vector4;return b.x=this.n11*a.x+this.n12*a.y+this.n13*a.z+this.n14*a.w,b.y=this.n21*a.x+this.n22*a.y+this.n23*a.z+this.n24*a.w,b.z=this.n31*a.x+this.n32*a.y+this.n33*a.z+this.n34*a.w,b.w=a.w?this.n41*a.x+this.n42*a.y+this.n43*a.z+this.n44*a.w:1,b},multiply:function(a,b){this.n11=a.n11*b.n11+a.n12*b.n21+a.n13*b.n31+a.n14*b.n41,this.n12=a.n11*b.n12+a.n12*b.n22+a.n13*b.n32+a.n14*b.n42,this.n13=a.n11*b.n13+a.n12*b.n23+a.n13*b.n33+a.n14*b.n43,this.n14=a.n11*b.n14+a.n12*b.n24+a.n13*b.n34+a.n14*b.n44,this.n21=a.n21*b.n11+a.n22*b.n21+a.n23*b.n31+a.n24*b.n41,this.n22=a.n21*b.n12+a.n22*b.n22+a.n23*b.n32+a.n24*b.n42,this.n23=a.n21*b.n13+a.n22*b.n23+a.n23*b.n33+a.n24*b.n43,this.n24=a.n21*b.n14+a.n22*b.n24+a.n23*b.n34+a.n24*b.n44,this.n31=a.n31*b.n11+a.n32*b.n21+a.n33*b.n31+a.n34*b.n41,this.n32=a.n31*b.n12+a.n32*b.n22+a.n33*b.n32+a.n34*b.n42,this.n33=a.n31*b.n13+a.n32*b.n23+a.n33*b.n33+a.n34*b.n43,this.n34=a.n31*b.n14+a.n32*b.n24+a.n33*b.n34+a.n34*b.n44,this.n41=a.n41*b.n11+a.n42*b.n21+a.n43*b.n31+a.n44*b.n41,this.n42=a.n41*b.n12+a.n42*b.n22+a.n43*b.n32+a.n44*b.n42,this.n43=a.n41*b.n13+a.n42*b.n23+a.n43*b.n33+a.n44*b.n43,this.n44=a.n41*b.n14+a.n42*b.n24+a.n43*b.n34+a.n44*b.n44},multiplySelf:function(a){var b=this.n11,c=this.n12,d=this.n13,e=this.n14,f=this.n21,g=this.n22,h=this.n23,i=this.n24,j=this.n31,k=this.n32,l=this.n33,m=this.n34,n=this.n41,o=this.n42,p=this.n43,q=this.n44;this.n11=b*a.n11+c*a.n21+d*a.n31+e*a.n41,this.n12=b*a.n12+c*a.n22+d*a.n32+e*a.n42,this.n13=b*a.n13+c*a.n23+d*a.n33+e*a.n43,this.n14=b*a.n14+c*a.n24+d*a.n34+e*a.n44,this.n21=f*a.n11+g*a.n21+h*a.n31+i*a.n41,this.n22=f*a.n12+g*a.n22+h*a.n32+i*a.n42,this.n23=f*a.n13+g*a.n23+h*a.n33+i*a.n43,this.n24=f*a.n14+g*a.n24+h*a.n34+i*a.n44,this.n31=j*a.n11+k*a.n21+l*a.n31+m*a.n41,this.n32=j*a.n12+k*a.n22+l*a.n32+m*a.n42,this.n33=j*a.n13+k*a.n23+l*a.n33+m*a.n43,this.n34=j*a.n14+k*a.n24+l*a.n34+m*a.n44,this.n41=n*a.n11+o*a.n21+p*a.n31+q*a.n41,this.n42=n*a.n12+o*a.n22+p*a.n32+q*a.n42,this.n43=n*a.n13+o*a.n23+p*a.n33+q*a.n43,this.n44=n*a.n14+o*a.n24+p*a.n34+q*a.n44},multiplyScalar:function(a){this.n11*=a,this.n12*=a,this.n13*=a,this.n14*=a,this.n21*=a,this.n22*=a,this.n23*=a,this.n24*=a,this.n31*=a,this.n32*=a,this.n33*=a,this.n34*=a,this.n41*=a,this.n42*=a,this.n43*=a,this.n44*=a},determinant:function(){return this.n14*this.n23*this.n32*this.n41-this.n13*this.n24*this.n32*this.n41-this.n14*this.n22*this.n33*this.n41+this.n12*this.n24*this.n33*this.n41+this.n13*this.n22*this.n34*this.n41-this.n12*this.n23*this.n34*this.n41-this.n14*this.n23*this.n31*this.n42+this.n13*this.n24*this.n31*this.n42+this.n14*this.n21*this.n33*this.n42-this.n11*this.n24*this.n33*this.n42-this.n13*this.n21*this.n34*this.n42+this.n11*this.n23*this.n34*this.n42+this.n14*this.n22*this.n31*this.n43-this.n12*this.n24*this.n31*this.n43-this.n14*this.n21*this.n32*this.n43+this.n11*this.n24*this.n32*this.n43+this.n12*this.n21*this.n34*this.n43-this.n11*this.n22*this.n34*this.n43-this.n13*this.n22*this.n31*this.n44+this.n12*this.n23*this.n31*this.n44+this.n13*this.n21*this.n32*this.n44-this.n11*this.n23*this.n32*this.n44-this.n12*this.n21*this.n33*this.n44+this.n11*this.n22*this.n33*this.n44},clone:function(){var a=new THREE.Matrix4;return a.n11=this.n11,a.n12=this.n12,a.n13=this.n13,a.n14=this.n14,a.n21=this.n21,a.n22=this.n22,a.n23=this.n23,a.n24=this.n24,a.n31=this.n31,a.n32=this.n32,a.n33=this.n33,a.n34=this.n34,a.n41=this.n41,a.n42=this.n42,a.n43=this.n43,a.n44=this.n44,a},toString:function(){return"| "+this.n11+" "+this.n12+" "+this.n13+" "+this.n14+" |\n| "+this.n21+" "+this.n22+" "+this.n23+" "+this.n24+" |\n| "+this.n31+" "+this.n32+" "+this.n33+" "+this.n34+" |\n| "+this.n41+" "+this.n42+" "+this.n43+" "+this.n44+" |"}},THREE.Matrix4.translationMatrix=function(a,b,c){var d=new THREE.Matrix4;return d.n14=a,d.n24=b,d.n34=c,d},THREE.Matrix4.scaleMatrix=function(a,b,c){var d=new THREE.Matrix4;return d.n11=a,d.n22=b,d.n33=c,d},THREE.Matrix4.rotationXMatrix=function(a){var b=new THREE.Matrix4;return b.n22=b.n33=Math.cos(a),b.n32=Math.sin(a),b.n23=-b.n32,b},THREE.Matrix4.rotationYMatrix=function(a){var b=new THREE.Matrix4;return b.n11=b.n33=Math.cos(a),b.n13=Math.sin(a),b.n31=-b.n13,b},THREE.Matrix4.rotationZMatrix=function(a){var b=new THREE.Matrix4;return b.n11=b.n22=Math.cos(a),b.n21=Math.sin(a),b.n12=-b.n21,b},THREE.Matrix4.makeInvert=function(a){var b=new THREE.Matrix4;return b.n11=a.n23*a.n34*a.n42-a.n24*a.n33*a.n42+a.n24*a.n32*a.n43-a.n22*a.n34*a.n43-a.n23*a.n32*a.n44+a.n22*a.n33*a.n44,b.n12=a.n14*a.n33*a.n42-a.n13*a.n34*a.n42-a.n14*a.n32*a.n43+a.n12*a.n34*a.n43+a.n13*a.n32*a.n44-a.n12*a.n33*a.n44,b.n13=a.n13*a.n24*a.n42-a.n14*a.n23*a.n42+a.n14*a.n22*a.n43-a.n12*a.n24*a.n43-a.n13*a.n22*a.n44+a.n12*a.n23*a.n44,b.n14=a.n14*a.n23*a.n32-a.n13*a.n24*a.n32-a.n14*a.n22*a.n33+a.n12*a.n24*a.n33+a.n13*a.n22*a.n34-a.n12*a.n23*a.n34,b.n21=a.n24*a.n33*a.n41-a.n23*a.n34*a.n41-a.n24*a.n31*a.n43+a.n21*a.n34*a.n43+a.n23*a.n31*a.n44-a.n21*a.n33*a.n44,b.n22=a.n13*a.n34*a.n41-a.n14*a.n33*a.n41+a.n14*a.n31*a.n43-a.n11*a.n34*a.n43-a.n13*a.n31*a.n44+a.n11*a.n33*a.n44,b.n23=a.n14*a.n23*a.n41-a.n13*a.n24*a.n41-a.n14*a.n21*a.n43+a.n11*a.n24*a.n43+a.n13*a.n21*a.n44-a.n11*a.n23*a.n44,b.n24=a.n13*a.n24*a.n31-a.n14*a.n23*a.n31+a.n14*a.n21*a.n33-a.n11*a.n24*a.n33-a.n13*a.n21*a.n34+a.n11*a.n23*a.n34,b.n31=a.n22*a.n34*a.n41-a.n24*a.n32*a.n41+a.n24*a.n31*a.n42-a.n21*a.n34*a.n42-a.n22*a.n31*a.n44+a.n21*a.n32*a.n44,b.n32=a.n14*a.n32*a.n41-a.n12*a.n34*a.n41-a.n14*a.n31*a.n42+a.n11*a.n34*a.n42+a.n12*a.n31*a.n44-a.n11*a.n32*a.n44,b.n33=a.n13*a.n24*a.n41-a.n14*a.n22*a.n41+a.n14*a.n21*a.n42-a.n11*a.n24*a.n42-a.n12*a.n21*a.n44+a.n11*a.n22*a.n44,b.n34=a.n14*a.n22*a.n31-a.n12*a.n24*a.n31-a.n14*a.n21*a.n32+a.n11*a.n24*a.n32+a.n12*a.n21*a.n34-a.n11*a.n22*a.n34,b.n41=a.n23*a.n32*a.n41-a.n22*a.n33*a.n41-a.n23*a.n31*a.n42+a.n21*a.n33*a.n42+a.n22*a.n31*a.n43-a.n21*a.n32*a.n43,b.n42=a.n12*a.n33*a.n41-a.n13*a.n32*a.n41+a.n13*a.n31*a.n42-a.n11*a.n33*a.n42-a.n12*a.n31*a.n43+a.n11*a.n32*a.n43,b.n43=a.n13*a.n22*a.n41-a.n12*a.n23*a.n41-a.n13*a.n21*a.n42+a.n11*a.n23*a.n42+a.n12*a.n21*a.n43-a.n11*a.n22*a.n43,b.n44=a.n12*a.n23*a.n31-a.n13*a.n22*a.n31+a.n13*a.n21*a.n32-a.n11*a.n23*a.n32-a.n12*a.n21*a.n33+a.n11*a.n22*a.n33,b.scale(1/a.determinant()),b},THREE.Matrix4.makeFrustum=function(a,b,c,d,e,f){var g,h,i,j,k,l,m;return g=new THREE.Matrix4,h=2*e/(b-a),i=2*e/(d-c),j=(b+a)/(b-a),k=(d+c)/(d-c),l=-(f+e)/(f-e),m=-2*f*e/(f-e),g.n11=h,g.n12=0,g.n13=j,g.n14=0,g.n21=0,g.n22=i,g.n23=k,g.n24=0,g.n31=0,g.n32=0,g.n33=l,g.n34=m,g.n41=0,g.n42=0,g.n43=-1,g.n44=0,g},THREE.Matrix4.makePerspective=function(a,b,c,d){var e,f,g,h;return e=c*Math.tan(a*Math.PI/360),f=-e,g=f*b,h=e*b,THREE.Matrix4.makeFrustum(g,h,f,e,c,d)},THREE.Matrix4.makeOrtho=function(a,b,c,d,e,f){var g,h,i,j,k,l,m;return g=new THREE.Matrix4,k=b-a,l=d-c,m=f-e,h=(b+a)/k,i=(d+c)/l,j=(f+e)/m,g.n11=2/k,g.n12=0,g.n13=0,g.n14=-h,g.n21=0,g.n22=2/l,g.n23=0,g.n24=-i,g.n31=0,g.n32=0,g.n33=-2/m,g.n34=-j,g.n41=0,g.n42=0,g.n43=0,g.n44=1,g},THREE.Vertex=function(a,b){this.position=a||new THREE.Vector3,this.normal=b||new THREE.Vector3,this.screen=new THREE.Vector3,this.__visible=!0,this.toString=function(){return"THREE.Vertex ( position: "+this.position+", normal: "+this.normal+" )"}},THREE.Face3=function(a,b,c,d,e){this.a=a,this.b=b,this.c=c,this.normal=d||new THREE.Vector3,this.screen=new THREE.Vector3,this.color=e||new THREE.Color(0),this.toString=function(){return"THREE.Face3 ( "+this.a+", "+this.b+", "+this.c+" )"}},THREE.Face4=function(a,b,c,d,e,f){this.a=a,this.b=b,this.c=c,this.d=d,this.normal=e||new THREE.Vector3,this.screen=new THREE.Vector3,this.color=f||new THREE.Color(0),this.toString=function(){return"THREE.Face4 ( "+this.a+", "+this.b+", "+this.c+" "+this.d+" )"}},THREE.UV=function(a,b){this.u=a||0,this.v=b||0},THREE.UV.prototype={copy:function(a){this.u=a.u,this.v=a.v},toString:function(){return"THREE.UV ("+this.u+", "+this.v+")"}},THREE.Geometry=function(){this.vertices=[],this.faces=[],this.uvs=[],this.computeNormals=function(){var a,b,c,d,e,f,g,h;for(a=0;a<this.vertices.length;a++)this.vertices[a].normal.set(0,0,0);for(b=0;b<this.faces.length;b++)c=this.vertices[this.faces[b].a],d=this.vertices[this.faces[b].b],e=this.vertices[this.faces[b].c],f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3,f.sub(e.position,d.position),g.sub(c.position,d.position),f.crossSelf(g),f.isZero()||f.normalize(),this.faces[b].normal=f,c.normal.addSelf(h),d.normal.addSelf(h),e.normal.addSelf(h),this.faces[b]instanceof THREE.Face4&&this.vertices[this.faces[b].d].normal.addSelf(h)}},THREE.Camera=function(a,b,c,d){this.position=new THREE.Vector3(0,0,0),this.target={position:new THREE.Vector3(0,0,0)},this.projectionMatrix=THREE.Matrix4.makePerspective(a,b,c,d),this.up=new THREE.Vector3(0,1,0),this.matrix=new THREE.Matrix4,this.autoUpdateMatrix=!0,this.updateMatrix=function(){this.matrix.lookAt(this.position,this.target.position,this.up)},this.toString=function(){return"THREE.Camera ( "+this.position+", "+this.target.position+" )"}},THREE.Object3D=function(a){this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.scale=new THREE.Vector3(1,1,1),this.matrix=new THREE.Matrix4,this.screen=new THREE.Vector3,this.material=a instanceof Array?a:[a],this.autoUpdateMatrix=!0,this.updateMatrix=function(){this.matrix.identity(),this.matrix.multiplySelf(THREE.Matrix4.translationMatrix(this.position.x,this.position.y,this.position.z)),this.matrix.multiplySelf(THREE.Matrix4.rotationXMatrix(this.rotation.x)),this.matrix.multiplySelf(THREE.Matrix4.rotationYMatrix(this.rotation.y)),this.matrix.multiplySelf(THREE.Matrix4.rotationZMatrix(this.rotation.z)),this.matrix.multiplySelf(THREE.Matrix4.scaleMatrix(this.scale.x,this.scale.y,this.scale.z))}},THREE.Line=function(a,b){THREE.Object3D.call(this,b),this.geometry=a},THREE.Line.prototype=new THREE.Object3D,THREE.Line.prototype.constructor=THREE.Line,THREE.Mesh=function(a,b){THREE.Object3D.call(this,b),this.geometry=a,this.flipSided=!1,this.doubleSided=!1,this.overdraw=!1},THREE.Mesh.prototype=new THREE.Object3D,THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Particle=function(a){THREE.Object3D.call(this,a),this.autoUpdateMatrix=!1},THREE.Particle.prototype=new THREE.Object3D,THREE.Particle.prototype.constructor=THREE.Particle,THREE.LineColorMaterial=function(a,b,c){this.lineWidth=c||1,this.color=new THREE.Color((b>=0?255*b<<24:4278190080)|a),this.toString=function(){return"THREE.LineColorMaterial ( color: "+this.color+", lineWidth: "+this.lineWidth+" )"}},THREE.MeshBitmapUVMappingMaterial=function(a){this.bitmap=a,this.toString=function(){return"THREE.MeshBitmapUVMappingMaterial ( bitmap: "+this.bitmap+" )"}},THREE.MeshColorFillMaterial=function(a,b){this.color=new THREE.Color((b>=0?255*b<<24:4278190080)|a),this.toString=function(){return"THREE.MeshColorFillMaterial ( color: "+this.color+" )"}},THREE.MeshColorStrokeMaterial=function(a,b,c){this.lineWidth=c||1,this.color=new THREE.Color((b>=0?255*b<<24:4278190080)|a),this.toString=function(){return"THREE.MeshColorStrokeMaterial ( lineWidth: "+this.lineWidth+", color: "+this.color+" )"}},THREE.MeshFaceColorFillMaterial=function(){this.toString=function(){return"THREE.MeshFaceColorFillMaterial ( )"}},THREE.MeshFaceColorStrokeMaterial=function(a){this.lineWidth=a||1,this.toString=function(){return"THREE.MeshFaceColorStrokeMaterial ( lineWidth: "+this.lineWidth+" )"}},THREE.ParticleBitmapMaterial=function(a){this.bitmap=a,this.offset=new THREE.Vector2,this.toString=function(){return"THREE.ParticleBitmapMaterial ( bitmap: "+this.bitmap+" )"}},THREE.ParticleCircleMaterial=function(a,b){this.color=new THREE.Color((b>=0?255*b<<24:4278190080)|a),this.toString=function(){return"THREE.ParticleCircleMaterial ( color: "+this.color+" )"}},THREE.Scene=function(){this.objects=[],this.addObject=function(a){this.objects.push(a)},this.removeObject=function(a){for(var b=0,c=this.objects.length;c>b;b++)if(a==this.objects[b])return void this.objects.splice(b,1)},this.add=function(a){this.addObject(a)},this.toString=function(){return"THREE.Scene ( "+this.objects+" )"}},THREE.Renderer=function(){function a(a,b){return b.z-a.z}var b=[],c=[],d=[],e=[],f=new THREE.Vector4,g=new THREE.Matrix4;this.renderList=null,this.project=function(h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=0,y=0,z=0,A=0;for(this.renderList=[],i.autoUpdateMatrix&&i.updateMatrix(),j=0,k=h.objects.length;k>j;j++)if(s=h.objects[j],s.autoUpdateMatrix&&s.updateMatrix(),s instanceof THREE.Mesh){for(g.multiply(i.matrix,s.matrix),l=0,m=s.geometry.vertices.length;m>l;l++)p=s.geometry.vertices[l],p.screen.copy(p.position),g.transform(p.screen),i.projectionMatrix.transform(p.screen),p.__visible=p.screen.z>0&&p.screen.z<1;for(n=0,o=s.geometry.faces.length;o>n;n++)r=s.geometry.faces[n],r instanceof THREE.Face3?(t=s.geometry.vertices[r.a],u=s.geometry.vertices[r.b],v=s.geometry.vertices[r.c],t.__visible&&u.__visible&&v.__visible&&(s.doubleSided||s.flipSided!=(v.screen.x-t.screen.x)*(u.screen.y-t.screen.y)-(v.screen.y-t.screen.y)*(u.screen.x-t.screen.x)<0)&&(b[x]||(b[x]=new THREE.RenderableFace3),b[x].v1.copy(t.screen),b[x].v2.copy(u.screen),b[x].v3.copy(v.screen),b[x].z=Math.max(t.screen.z,Math.max(u.screen.z,v.screen.z)),b[x].material=s.material,b[x].overdraw=s.overdraw,b[x].uvs=s.geometry.uvs[n],b[x].color=r.color,this.renderList.push(b[x]),x++)):r instanceof THREE.Face4&&(t=s.geometry.vertices[r.a],u=s.geometry.vertices[r.b],v=s.geometry.vertices[r.c],w=s.geometry.vertices[r.d],t.__visible&&u.__visible&&v.__visible&&w.__visible&&(s.doubleSided||s.flipSided!=((w.screen.x-t.screen.x)*(u.screen.y-t.screen.y)-(w.screen.y-t.screen.y)*(u.screen.x-t.screen.x)<0||(u.screen.x-v.screen.x)*(w.screen.y-v.screen.y)-(u.screen.y-v.screen.y)*(w.screen.x-v.screen.x)<0))&&(c[y]||(c[y]=new THREE.RenderableFace4),c[y].v1.copy(t.screen),c[y].v2.copy(u.screen),c[y].v3.copy(v.screen),c[y].v4.copy(w.screen),c[y].z=Math.max(t.screen.z,Math.max(u.screen.z,Math.max(v.screen.z,w.screen.z))),c[y].material=s.material,c[y].overdraw=s.overdraw,c[y].uvs=s.geometry.uvs[n],c[y].color=r.color,this.renderList.push(c[y]),y++))}else if(s instanceof THREE.Line)for(g.multiply(i.matrix,s.matrix),l=0,m=s.geometry.vertices.length;m>l;l++)p=s.geometry.vertices[l],p.screen.copy(p.position),g.transform(p.screen),i.projectionMatrix.transform(p.screen),p.__visible=p.screen.z>0&&p.screen.z<1,l>0&&(q=s.geometry.vertices[l-1],p.__visible&&q.__visible&&(d[z]||(d[z]=new THREE.RenderableLine),d[z].v1.copy(p.screen),d[z].v2.copy(q.screen),d[z].z=Math.max(p.screen.z,q.screen.z),d[z].material=s.material,this.renderList.push(d[z]),z++));else s instanceof THREE.Particle&&(f.set(s.position.x,s.position.y,s.position.z,1),i.matrix.transform(f),i.projectionMatrix.transform(f),s.screen.set(f.x/f.w,f.y/f.w,f.z/f.w),s.screen.z>0&&s.screen.z<1&&(e[A]||(e[A]=new THREE.RenderableParticle),e[A].x=s.screen.x,e[A].y=s.screen.y,e[A].z=s.screen.z,e[A].rotation=s.rotation.z,e[A].scale.x=s.scale.x*Math.abs(f.x/f.w-(f.x+i.projectionMatrix.n11)/(f.w+i.projectionMatrix.n14)),e[A].scale.y=s.scale.y*Math.abs(f.y/f.w-(f.y+i.projectionMatrix.n22)/(f.w+i.projectionMatrix.n24)),e[A].material=s.material,e[A].color=s.color,this.renderList.push(e[A]),A++));this.renderList.sort(a)}},THREE.CanvasRenderer=function(){function a(a,b,c,d,e,f,g,i,j,k,l,m,n){var o,p,q,r,s,t,u;h.beginPath(),h.moveTo(b,c),h.lineTo(d,e),h.lineTo(f,g),h.lineTo(b,c),h.closePath(),h.save(),h.clip(),o=i*(n-l)-k*n+m*l+(k-m)*j,p=-(j*(f-d)-l*f+n*d+(l-n)*b)/o,q=(l*g+j*(e-g)-n*e+(n-l)*c)/o,r=(i*(f-d)-k*f+m*d+(k-m)*b)/o,s=-(k*g+i*(e-g)-m*e+(m-k)*c)/o,t=(i*(n*d-l*f)+j*(k*f-m*d)+(m*l-k*n)*b)/o,u=(i*(n*e-l*g)+j*(k*g-m*e)+(m*l-k*n)*c)/o,h.transform(p,q,r,s,t,u),h.drawImage(a,0,0),h.restore()}function b(a,b){l.sub(b,a),l.unit(),b.addSelf(l),a.subSelf(l)}THREE.Renderer.call(this);var c,d,e,f,g=document.createElement("canvas"),h=g.getContext("2d"),i=new THREE.Rectangle,j=new THREE.Rectangle,k=new THREE.Rectangle,l=new THREE.Vector2,m=new THREE.Vector2,n=new THREE.Vector2,o=new THREE.UV,p=new THREE.UV,q=new THREE.UV,r=new THREE.UV;this.domElement=g,this.autoClear=!0,this.setSize=function(a,b){c=a,d=b,e=c/2,f=d/2,g.width=c,g.height=d,i.set(-e,-f,e,f)},this.clear=function(){j.isEmpty()||(j.inflate(1),j.minSelf(i),h.setTransform(1,0,0,1,e,f),h.clearRect(j.getX(),-(j.getHeight()+j.getY()),j.getWidth(),j.getHeight()),j.empty())},this.render=function(c,d){var g,l,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R=2*Math.PI;for(this.project(c,d),this.autoClear&&this.clear(),h.setTransform(1,0,0,-1,e,f),g=0,l=this.renderList.length;l>g;g++){if(u=this.renderList[g],k.empty(),u instanceof THREE.RenderableParticle){for(w=u.x*e,x=u.y*f,s=0,t=u.material.length;t>s;s++)if(v=u.material[s],v instanceof THREE.ParticleCircleMaterial){if(I=u.scale.x*e,J=u.scale.y*f,k.set(w-I,x-J,w+I,x+J),!i.instersects(k))continue;h.save(),h.translate(w,x),h.rotate(-u.rotation),h.scale(I,J),h.beginPath(),h.arc(0,0,1,0,R,!0),h.closePath(),h.fillStyle=v.color.__styleString,h.fill(),h.restore()}else if(v instanceof THREE.ParticleBitmapMaterial){if(O=v.bitmap,P=O.width/2,Q=O.height/2,K=u.scale.x*e,L=u.scale.y*f,I=K*P,J=L*Q,M=v.offset.x*K,N=v.offset.y*L,k.set(w+M-I,x+N-J,w+M+I,x+N+J),!i.instersects(k))continue;h.save(),h.translate(w,x),h.rotate(-u.rotation),h.scale(K,-L),h.translate(-P+v.offset.x,-Q-v.offset.y),h.drawImage(O,0,0),h.restore()}}else if(u instanceof THREE.RenderableLine){if(w=u.v1.x*e,x=u.v1.y*f,y=u.v2.x*e,z=u.v2.y*f,k.addPoint(w,x),k.addPoint(y,z),!i.instersects(k))continue;for(h.beginPath(),h.moveTo(w,x),h.lineTo(y,z),h.closePath(),s=0,t=u.material.length;t>s;s++)v=u.material[s],v instanceof THREE.LineColorMaterial&&(h.lineWidth=v.lineWidth,h.lineJoin="round",h.lineCap="round",h.strokeStyle=v.color.__styleString,h.stroke(),k.inflate(h.lineWidth))}else if(u instanceof THREE.RenderableFace3){if(u.v1.x*=e,u.v1.y*=f,u.v2.x*=e,u.v2.y*=f,u.v3.x*=e,u.v3.y*=f,u.overdraw&&(b(u.v1,u.v2),b(u.v2,u.v3),b(u.v3,u.v1)),w=u.v1.x,x=u.v1.y,y=u.v2.x,z=u.v2.y,A=u.v3.x,B=u.v3.y,k.addPoint(w,x),k.addPoint(y,z),k.addPoint(A,B),!i.instersects(k))continue;for(s=0,t=u.material.length;t>s;s++)v=u.material[s],v instanceof THREE.MeshColorFillMaterial?(h.beginPath(),h.moveTo(w,x),h.lineTo(y,z),h.lineTo(A,B),h.lineTo(w,x),h.closePath(),h.fillStyle=v.color.__styleString,h.fill()):v instanceof THREE.MeshColorStrokeMaterial?(h.beginPath(),h.moveTo(w,x),h.lineTo(y,z),h.lineTo(A,B),h.lineTo(w,x),h.closePath(),h.lineWidth=v.lineWidth,h.lineJoin="round",h.lineCap="round",h.strokeStyle=v.color.__styleString,h.stroke(),k.inflate(h.lineWidth)):v instanceof THREE.MeshFaceColorFillMaterial?(h.beginPath(),h.moveTo(w,x),h.lineTo(y,z),h.lineTo(A,B),h.lineTo(w,x),h.closePath(),h.fillStyle=u.color.__styleString,h.fill()):v instanceof THREE.MeshFaceColorStrokeMaterial?(h.beginPath(),h.moveTo(w,x),h.lineTo(y,z),h.lineTo(A,B),h.lineTo(w,x),h.closePath(),h.lineWidth=v.lineWidth,h.lineJoin="round",h.lineCap="round",h.strokeStyle=u.color.__styleString,h.stroke(),k.inflate(h.lineWidth)):v instanceof THREE.MeshBitmapUVMappingMaterial&&(O=v.bitmap,P=O.width-1,Q=O.height-1,o.copy(u.uvs[0]),p.copy(u.uvs[1]),q.copy(u.uvs[2]),o.u*=P,o.v*=Q,p.u*=P,p.v*=Q,q.u*=P,q.v*=Q,a(O,w,x,y,z,A,B,o.u,o.v,p.u,p.v,q.u,q.v))}else if(u instanceof THREE.RenderableFace4){if(u.v1.x*=e,u.v1.y*=f,u.v2.x*=e,u.v2.y*=f,u.v3.x*=e,u.v3.y*=f,u.v4.x*=e,u.v4.y*=f,m.copy(u.v2),n.copy(u.v4),u.overdraw&&(b(u.v1,u.v2),b(u.v2,u.v4),b(u.v4,u.v1)),w=u.v1.x,x=u.v1.y,y=u.v2.x,z=u.v2.y,C=u.v4.x,D=u.v4.y,u.overdraw&&(b(u.v3,m),b(u.v3,n)),A=u.v3.x,B=u.v3.y,E=m.x,F=m.y,G=n.x,H=n.y,k.addPoint(w,x),k.addPoint(y,z),k.addPoint(A,B),k.addPoint(C,D),!i.instersects(k))continue;for(s=0,t=u.material.length;t>s;s++)v=u.material[s],v instanceof THREE.MeshColorFillMaterial?(h.beginPath(),h.moveTo(w,x),h.lineTo(y,z),h.lineTo(A,B),h.lineTo(C,D),h.lineTo(w,x),h.closePath(),h.fillStyle=v.color.__styleString,h.fill()):v instanceof THREE.MeshColorStrokeMaterial?(h.beginPath(),h.moveTo(w,x),h.lineTo(y,z),h.lineTo(A,B),h.lineTo(C,D),h.lineTo(w,x),h.closePath(),h.lineWidth=v.lineWidth,h.lineJoin="round",h.lineCap="round",h.strokeStyle=v.color.__styleString,h.stroke(),k.inflate(h.lineWidth)):v instanceof THREE.MeshFaceColorFillMaterial?(h.beginPath(),h.moveTo(w,x),h.lineTo(y,z),h.lineTo(A,B),h.lineTo(C,D),h.lineTo(w,x),h.closePath(),h.fillStyle=u.color.__styleString,h.fill()):v instanceof THREE.MeshFaceColorStrokeMaterial?(h.beginPath(),h.moveTo(w,x),h.lineTo(y,z),h.lineTo(A,B),h.lineTo(C,D),h.lineTo(w,x),h.closePath(),h.lineWidth=v.lineWidth,h.lineJoin="round",h.lineCap="round",h.strokeStyle=u.color.__styleString,h.stroke(),k.inflate(h.lineWidth)):v instanceof THREE.MeshBitmapUVMappingMaterial&&(O=v.bitmap,P=O.width-1,Q=O.height-1,o.copy(u.uvs[0]),p.copy(u.uvs[1]),q.copy(u.uvs[2]),r.copy(u.uvs[3]),o.u*=P,o.v*=Q,p.u*=P,p.v*=Q,q.u*=P,q.v*=Q,r.u*=P,r.v*=Q,a(O,w,x,y,z,C,D,o.u,o.v,p.u,p.v,r.u,r.v),a(O,E,F,A,B,G,H,p.u,p.v,q.u,q.v,r.u,r.v))}j.addRectangle(k)}h.setTransform(1,0,0,1,0,0)}},THREE.CanvasRenderer.prototype=new THREE.Renderer,THREE.CanvasRenderer.prototype.constructor=THREE.CanvasRenderer,THREE.SVGRenderer=function(){function a(a){return null==j[a]?(j[a]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==l&&j[a].setAttribute("shape-rendering","crispEdges"),j[a]):j[a]}function b(a){return null==k[a]?(k[a]=document.createElementNS("http://www.w3.org/2000/svg","circle"),0==l&&k[a].setAttribute("shape-rendering","crispEdges"),k[a]):k[a]}THREE.Renderer.call(this);var c,d,e,f,g=document.createElementNS("http://www.w3.org/2000/svg","svg"),h=new THREE.Rectangle,i=new THREE.Rectangle,j=[],k=[],l=1;this.domElement=g,this.autoClear=!0,this.setQuality=function(a){switch(a){case"high":l=1;break;case"low":l=0}},this.setSize=function(a,b){c=a,d=b,e=c/2,f=d/2,g.setAttribute("viewBox",-e+" "+-f+" "+c+" "+d),g.setAttribute("width",c),g.setAttribute("height",d),h.set(-e,-f,e,f)},this.clear=function(){for(;g.childNodes.length>0;)g.removeChild(g.childNodes[0])},this.render=function(c,d){var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=0,A=0;for(this.autoClear&&this.clear(),this.project(c,d),j=0,k=this.renderList.length;k>j;j++)for(n=this.renderList[j],l=0,m=n.material.length;m>l;l++){if(o=n.material[l],i.empty(),n instanceof THREE.RenderableParticle){if(q=n.x*e,r=n.y*-f,y=n.size*e,i.set(q-y,r-y,q+y,r+y),!h.instersects(i))continue;p=b(A++),p.setAttribute("cx",q),p.setAttribute("cy",r),p.setAttribute("r",y)}else if(n instanceof THREE.RenderableFace3){if(q=n.v1.x*e,r=n.v1.y*-f,s=n.v2.x*e,t=n.v2.y*-f,u=n.v3.x*e,v=n.v3.y*-f,i.addPoint(q,r),i.addPoint(s,t),i.addPoint(u,v),!h.instersects(i))continue;p=a(z++),p.setAttribute("d","M "+q+" "+r+" L "+s+" "+t+" L "+u+","+v+"z")}else if(n instanceof THREE.RenderableFace4){if(q=n.v1.x*e,r=n.v1.y*-f,s=n.v2.x*e,t=n.v2.y*-f,u=n.v3.x*e,v=n.v3.y*-f,w=n.v4.x*e,x=n.v4.y*-f,i.addPoint(q,r),i.addPoint(s,t),i.addPoint(u,v),i.addPoint(w,x),!h.instersects(i))continue;p=a(z++),p.setAttribute("d","M "+q+" "+r+" L "+s+" "+t+" L "+u+","+v+" L "+w+","+x+"z")}o instanceof THREE.MeshColorFillMaterial?p.setAttribute("style","fill: "+o.color.__styleString):o instanceof THREE.MeshFaceColorFillMaterial?p.setAttribute("style","fill: "+n.color.__styleString):o instanceof THREE.MeshColorStrokeMaterial?p.setAttribute("style","fill: none; stroke: "+o.color.__styleString+"; stroke-width: "+o.lineWidth+"; stroke-linecap: round; stroke-linejoin: round"):o instanceof THREE.MeshFaceColorStrokeMaterial&&p.setAttribute("style","fill: none; stroke: "+n.color.__styleString+"; stroke-width: "+o.lineWidth+"; stroke-linecap: round; stroke-linejoin: round"),g.appendChild(p)}}},THREE.SVGRenderer.prototype=new THREE.Renderer,THREE.SVGRenderer.prototype.constructor=THREE.CanvasRenderer,THREE.WebGLRenderer=function(){function a(){try{e=g.getContext("experimental-webgl")}catch(a){}if(!e)throw alert("WebGL not supported"),"cannot create webgl context";e.clearColor(0,0,0,1),e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.clearColor(0,0,0,0)}function b(){f=e.createProgram(),e.attachShader(f,c("fragment",["varying vec4 vcolor;","void main(){","gl_FragColor = vcolor;","}"].join(""))),e.attachShader(f,c("vertex",["attribute vec3 position;","attribute vec4 color;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","varying vec4 vcolor;","void main(void) {","vcolor = color;","gl_Position = projectionMatrix * viewMatrix * vec4( position, 1 );","}"].join(""))),e.linkProgram(f),e.getProgramParameter(f,e.LINK_STATUS)||alert("Could not initialise shaders"),e.useProgram(f),f.viewMatrix=e.getUniformLocation(f,"viewMatrix"),f.projectionMatrix=e.getUniformLocation(f,"projectionMatrix"),f.color=e.getAttribLocation(f,"color"),e.enableVertexAttribArray(f.color),f.position=e.getAttribLocation(f,"position"),e.enableVertexAttribArray(f.position),f.viewMatrixArray=new WebGLFloatArray(16),f.projectionMatrixArray=new WebGLFloatArray(16)}function c(a,b){var c;return"fragment"==a?c=e.createShader(e.FRAGMENT_SHADER):"vertex"==a&&(c=e.createShader(e.VERTEX_SHADER)),e.shaderSource(c,b),e.compileShader(c),e.getShaderParameter(c,e.COMPILE_STATUS)?c:(alert(e.getShaderInfoLog(c)),null)}function d(a,b){b[0]=a.n11,b[1]=a.n21,b[2]=a.n31,b[3]=a.n41,b[4]=a.n12,b[5]=a.n22,b[6]=a.n32,b[7]=a.n42,b[8]=a.n13,b[9]=a.n23,b[10]=a.n33,b[11]=a.n43,b[12]=a.n14,b[13]=a.n24,b[14]=a.n34,b[15]=a.n44}var e,f,g=document.createElement("canvas"),h=new THREE.Matrix4;this.domElement=g,this.autoClear=!0,a(),b(),this.setSize=function(a,b){g.width=a,g.height=b,e.viewport(0,0,g.width,g.height)},this.clear=function(){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},this.render=function(a,b){var c,g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;for(this.autoClear&&this.clear(),o=0,p=a.objects.length;p>o;o++)if(i=a.objects[o],i instanceof THREE.Mesh){if(!i.__webGLVertexBuffer){for(k=[],l=[],m=[],n=0,q=0,r=i.geometry.faces.length;r>q;q++)c=i.geometry.faces[q],g=c.color,c instanceof THREE.Face3?(v=i.geometry.vertices[c.a].position,w=i.geometry.vertices[c.b].position,x=i.geometry.vertices[c.c].position,k.push(v.x,v.y,v.z),k.push(w.x,w.y,w.z),k.push(x.x,x.y,x.z),m.push(g.r,g.g,g.b,g.a),m.push(g.r,g.g,g.b,g.a),m.push(g.r,g.g,g.b,g.a),l.push(n,n+1,n+2),n+=3):c instanceof THREE.Face4&&(v=i.geometry.vertices[c.a].position,w=i.geometry.vertices[c.b].position,x=i.geometry.vertices[c.c].position,y=i.geometry.vertices[c.d].position,k.push(v.x,v.y,v.z),k.push(w.x,w.y,w.z),k.push(x.x,x.y,x.z),k.push(y.x,y.y,y.z),m.push(g.r,g.g,g.b,g.a),m.push(g.r,g.g,g.b,g.a),m.push(g.r,g.g,g.b,g.a),m.push(g.r,g.g,g.b,g.a),l.push(n,n+1,n+2),l.push(n,n+2,n+3),n+=4);if(!k.length)continue;i.__webGLVertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i.__webGLVertexBuffer),e.bufferData(e.ARRAY_BUFFER,new WebGLFloatArray(k),e.STATIC_DRAW),i.__webGLColorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i.__webGLColorBuffer),e.bufferData(e.ARRAY_BUFFER,new WebGLFloatArray(m),e.STATIC_DRAW),i.__webGLFaceBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.__webGLFaceBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new WebGLUnsignedShortArray(l),e.STATIC_DRAW),i.__webGLFaceCount=l.length}for(h.multiply(b.matrix,i.matrix),d(h,f.viewMatrixArray),d(b.projectionMatrix,f.projectionMatrixArray),e.uniformMatrix4fv(f.viewMatrix,!1,f.viewMatrixArray),e.uniformMatrix4fv(f.projectionMatrix,!1,f.projectionMatrixArray),e.bindBuffer(e.ARRAY_BUFFER,i.__webGLVertexBuffer),e.vertexAttribPointer(f.position,3,e.FLOAT,!1,0,0),s=0,t=i.material.length;t>s;s++)if(j=i.material[s],j instanceof THREE.MeshColorFillMaterial){if(!j.__webGLColorBuffer){for(m=[],u=0;u<i.__webGLFaceCount;u++)m.push(j.color.r,j.color.g,j.color.b,j.color.a);j.__webGLColorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,j.__webGLColorBuffer),e.bufferData(e.ARRAY_BUFFER,new WebGLFloatArray(m),e.STATIC_DRAW)}e.bindBuffer(e.ARRAY_BUFFER,j.__webGLColorBuffer),e.vertexAttribPointer(f.color,4,e.FLOAT,!1,0,0)}else j instanceof THREE.MeshFaceColorFillMaterial&&(e.bindBuffer(e.ARRAY_BUFFER,i.__webGLColorBuffer),e.enableVertexAttribArray(f.color),e.vertexAttribPointer(f.color,4,e.FLOAT,!1,0,0));
e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.__webGLFaceBuffer),e.drawElements(e.TRIANGLES,i.__webGLFaceCount,e.UNSIGNED_SHORT,0)}}},THREE.RenderableFace3=function(){this.v1=new THREE.Vector2,this.v2=new THREE.Vector2,this.v3=new THREE.Vector2,this.z=null,this.color=null,this.material=null},THREE.RenderableFace4=function(){this.v1=new THREE.Vector2,this.v2=new THREE.Vector2,this.v3=new THREE.Vector2,this.v4=new THREE.Vector2,this.z=null,this.color=null,this.material=null},THREE.RenderableParticle=function(){this.x=null,this.y=null,this.z=null,this.rotation=null,this.scale=new THREE.Vector2,this.color=null,this.material=null},THREE.RenderableLine=function(){this.v1=new THREE.Vector2,this.v2=new THREE.Vector2,this.z=null,this.color=null,this.material=null};var TWEEN_MANAGER=TWEEN_MANAGER||function(){var a,b,c=[];return this.add=function(a){c.push(a)},this.remove=function(a){for(var b=0,d=c.length;d>b;b++)if(a==c[b])return void c.splice(b,1)},this.update=function(){for(a=0,b=(new Date).getTime();a<c.length;)c[a].update(b)?a++:c.splice(a,1)},this}(),TWEEN=TWEEN||{};TWEEN.Tween=function(a){TWEEN_MANAGER.add(this);var b=a,c={},d={},e=1e3,f=(new Date).getTime(),g=TWEEN.Easing.Elastic.EaseInOut,h=null,i=null;this.to=function(a,f){e=1e3*a;for(var g in f)null!==b[g]&&(c[g]=b[g],d[g]=f[g]-b[g]);return this},this.delay=function(a){return f+=1e3*a,this},this.easing=function(a){return g=a,this},this.onUpdate=function(a){return h=a,this},this.onComplete=function(a){return i=a,this},this.update=function(a){var j,k;if(f>a)return!0;if(k=a-f,k>e)return null!==i&&i(),!1;for(j in d)b[j]=g(k,c[j],d[j],e);return null!==h&&h(),!0},this.destroy=function(){TWEEN_MANAGER.remove(this)}},TWEEN.Easing={Back:{},Elastic:{},Expo:{},Linear:{},Sine:{}},TWEEN.Easing.Back.EaseIn=function(a,b,c,d){var e=1.70158;return c*(a/=d)*a*((e+1)*a-e)+b},TWEEN.Easing.Back.EaseOut=function(a,b,c,d){var e=1.70158;return c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},TWEEN.Easing.Back.EaseInOut=function(a,b,c,d){var e=1.70158;return(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},TWEEN.Easing.Elastic.EaseIn=function(a,b,c,d){if(0==a)return b;if(1==(a/=d))return b+c;var e=.3*d,f=c,g=e/4;return-(f*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/e))+b},TWEEN.Easing.Elastic.EaseOut=function(a,b,c,d){if(0==a)return b;if(1==(a/=d))return b+c;var e=.3*d,f=c,g=e/4;return f*Math.pow(2,-10*a)*Math.sin(2*(a*d-g)*Math.PI/e)+c+b},TWEEN.Easing.Elastic.EaseInOut=function(a,b,c,d){if(0==a)return b;if(2==(a/=d/2))return b+c;var e=.3*d*1.5,f=c,g=e/4;return 1>a?-.5*f*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/e)+b:f*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/e)*.5+c+b},TWEEN.Easing.Expo.EaseIn=function(a,b,c,d){return 0==a?b:c*Math.pow(2,10*(a/d-1))+b},TWEEN.Easing.Expo.EaseOut=function(a,b,c,d){return a==d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b},TWEEN.Easing.Expo.EaseInOut=function(a,b,c,d){return 0==a?b:a==d?b+c:(a/=d/2)<1?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b},TWEEN.Easing.Linear.EaseNone=function(a,b,c,d){return c*a/d+b},TWEEN.Easing.Linear.EaseIn=function(a,b,c,d){return c*a/d+b},TWEEN.Easing.Linear.EaseOut=function(a,b,c,d){return c*a/d+b},TWEEN.Easing.Linear.EaseInOut=function(a,b,c,d){return c*a/d+b},TWEEN.Easing.Sine.EaseIn=function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},TWEEN.Easing.Sine.EaseInOutSine=function(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b},TWEEN.Easing.Sine.EaseOut=function(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b};var MANUAL_TWEEN=MANUAL_TWEEN||{};MANUAL_TWEEN.Manager=function(){var a=[];this.add=function(b){a.push(b)},this.remove=function(b){for(var c=0,d=a.length;d>c;c++)if(b==a[c])return void a.splice(c,1)},this.update=function(b){for(var c=0,d=a.length;d>c;c++)a[c].update(b)}},MANUAL_TWEEN.Tween=function(a,b){var c=a,d={},e={},f={},g=1e3,h=0,i=TWEEN.Easing.Linear.EaseNone;this.to=function(a,b){g=1e3*a;for(var h in b)null!==c[h]&&(d[h]=c[h],e[h]=b[h]-c[h],f[h]=b[h]);return this},this.delay=function(a){return h+=1e3*a,this},this.easing=function(a){return i=a,this},this.update=function(a){var b,j;if(h>a)for(b in d)c[b]=d[b];else if(j=a-h,j>=g)for(b in f)c[b]=f[b];else for(b in e)c[b]=i(j,d[b],e[b],g)}};var Boid=function(){"use strict";var a,b,c,d,e,f,g,h=new THREE.Vector3,i=1e4,j=3,k=.1,l=!1;a=this.position=new THREE.Vector3,b=this.velocity=new THREE.Vector3,c=new THREE.Vector3,this.setGoal=function(a){g=a},this.setAvoidWalls=function(a){l=a},this.setWorldSize=function(a,b,c){d=a,e=b,f=c},this.run=function(b){l&&(h.set(-d,a.y,a.z),this.avoid(h),h.set(d,a.y,a.z),this.avoid(h),h.set(a.x,-e,a.z),this.avoid(h),h.set(a.x,e,a.z),this.avoid(h),h.set(a.x,a.y,-f),this.avoid(h),h.set(a.x,a.y,f),this.avoid(h)),Math.random()>.5&&this.flock(b),this.move()},this.flock=function(a){g&&this.reach(g,.005),this.alignment(a),this.cohesion(a),this.separation(a)},this.move=function(){b.addSelf(c);var d=b.length();d>j&&b.divideScalar(d/j),a.addSelf(b),c.set(0,0,0)},this.checkBounds=function(){a.x>d&&(a.x=-d),a.x<-d&&(a.x=d),a.y>e&&(a.y=-e),a.y<-e&&(a.y=e),a.z>f&&(a.z=-f),a.z<-f&&(a.z=f)};var m=new THREE.Vector3,n=new THREE.Vector3;this.avoid=function(b){m.copy(a),m.subSelf(b),m.multiplyScalar(5/a.distanceToSquared(b)),c.addSelf(m)},this.repulse=function(b){var d=a.distanceToSquared(b);22500>d&&(m.copy(a),m.subSelf(b),m.multiplyScalar(75/d),c.addSelf(m))},this.reach=function(b,d){m.copy(b),m.subSelf(a),m.multiplyScalar(d),c.addSelf(m)},this.alignment=function(b){var d,e;m.set(0,0,0);for(var f=0,g=0;g<b.length;g++)Math.random()>.6||(d=b[g],e=d.position.distanceToSquared(a),e>0&&i>=e&&(m.addSelf(d.velocity),f++));if(f>0){m.divideScalar(f);var h=m.length();h>k&&m.divideScalar(h/k)}c.addSelf(m)},this.cohesion=function(b){var d,e;m.set(0,0,0);for(var f=0,g=0;g<b.length;g++)Math.random()>.6||(d=b[g],e=d.position.distanceToSquared(a),e>0&&i>=e&&(m.addSelf(d.position),f++));f>0&&m.divideScalar(f),m.subSelf(a);var h=m.length();h>k&&m.divideScalar(h/k),c.addSelf(m)},this.separation=function(b){for(var d,e,f=0;f<b.length;f++)Math.random()>.6||(d=b[f],e=d.position.distanceToSquared(a),e>0&&i>=e&&(n.copy(a),n.subSelf(d.position),n.normalize(),n.divideScalar(Math.sqrt(e)),m.addSelf(n)));c.addSelf(m)}},ImprovedNoise=function(){function a(a){return a*a*a*(a*(6*a-15)+10)}function b(a,b,c){return b+a*(c-b)}function c(a,b,c,d){var e=15&a,f=8>e?b:c,g=4>e?c:12==e||14==e?b:d;return(0===(1&e)?f:-f)+(0===(2&e)?g:-g)}for(var d=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],e=0;256>e;e++)d[256+e]=d[e];return{noise:function(e,f,g){var h=Math.floor(e),i=Math.floor(f),j=Math.floor(g),k=255&h,l=255&i,m=255&j;e-=h,f-=i,g-=j;var n=e-1,o=f-1,p=g-1,q=a(e),r=a(f),s=a(g),t=d[k]+l,u=d[t]+m,v=d[t+1]+m,w=d[k+1]+l,x=d[w]+m,y=d[w+1]+m;return b(s,b(r,b(q,c(d[u],e,f,g),c(d[x],n,f,g)),b(q,c(d[v],e,o,g),c(d[y],n,o,g))),b(r,b(q,c(d[u+1],e,f,p),c(d[x+1],n,f,g-1)),b(q,c(d[v+1],e,o,p),c(d[y+1],n,o,p))))}}};shuffle=function(a){for(var b,c,d=a.length;d>0;)c=Math.floor(Math.random()*d),d--,b=a[d],a[d]=a[c],a[c]=b;return a},sprite.prototype={create:function(a,b,c){this.image=new Image;var d=this;this.image.onload=function(){d.onImage()};var e=new Date;this.image.src=a+"?"+e.getTime(),this.step=0,this.running=!0,this.framerate=c,this.size=b,this.off_x=0,this.off_y=0,this.loop=!0,this.offset=0},onImage:function(){this.steps=this.image.height/this.size},blit:function(a,b,c,d){if(this.image.complete){if(this.loop){var e=(d+this.offset)%1;this.step=Math.floor(e*this.framerate)%this.steps}else this.step=Math.floor(d*this.framerate),this.step>this.steps-1&&(this.step=this.steps-1);a.drawImage(this.image,0,this.step*this.size,this.image.width,this.size,b-this.image.width/2+this.off_x,c-this.size/2+this.off_y,this.image.width,this.size)}},start:function(){this.running=!0},stop:function(){this.running=!1,this.step=0}},ProjMap.prototype={create:function(a){this.locationObject=a,this.projection=new MercatorProjection,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.ctx=this.canvas.getContext("2d"),this.texture=document.createElement("canvas"),this.texture.width=320,this.texture.height=240,this.texture_ctx=this.texture.getContext("2d"),this.runner=new sprite,this.standing=new sprite,this.tree=new sprite,this.bird=new sprite,this.bird2=new sprite,this.runner.create("files/img/running.png",15,24),this.standing.create("files/img/runner_static.png",7,1),this.tree.create("files/img/treeSprite_2.png",64,30),this.bird.create("files/img/bird3.png",16,22),this.bird2.create("files/img/birdb.png",64,22),this.tree.loop=!1,this.init(),this.addTrees(),this.addBirds1(),this.addBirds2(),this.addBirds3()},init:function(){this.perspective=.35,this.default_zoom=19,this.deviation=0,this.tween_zoom=0,this.tween_zoom2=0,this.tween_angle1=0,this.tween_angle2=0,this.tween_angle3=0,this.tween_perspective=0,this.tween_alpha=0,this.angle=0,this.runner_angle=0,this.running=!1,this.rotating=!1,this.clouds=!1,this.zooming=!1,this.clouds_alpha=0,this.white_alpha=0,this.texture_angle=0,this.precalc(),this.setZoom(this.default_zoom,!0),this.preloadImages()},setScene:function(a){1==a&&(this.tint_alpha=.4,this.tint_colour="#85622a"),2==a&&(this.tint_alpha=0,this.tint_colour="#704214")},addTrees:function(){var a,b,c,d,e,f,g,h,i,j;for(d=[],a=0;50>a;a++)c={pos:this.locationObject.getPosition(a/50),d:1e-4},d.push(c);for(d.push({pos:this.locationObject.getLocation(),d:1e-4}),a=0;50>a;a++){c=this.locationObject.getPosition(a/100);do for(e=c.lat()+5e-4-.001*Math.random(),f=c.lng()+5e-4-.001*Math.random(),i=!0,b=0;b<d.length;b++)if(g=e-d[b].pos.lat(),h=f-d[b].pos.lng(),j=Math.sqrt(g*g+h*h),j<d[b].d){i=!1;break}while(!i);this.trees_array.push({pos:new google.maps.LatLng(e,f),a:2*Math.random()*Math.PI,scale:.75+1.25*Math.random(),offset:12.562+21*Math.random()})}var k=6e-4,l=25e-5;for(d=[],d.push({pos:this.locationObject.getLocation(),d:5e-4}),c=this.locationObject.getLocation(),a=0;150>a;a++){do for(e=c.lat()+75e-5-.0015*Math.random(),f=c.lng()+75e-5-.0015*Math.random(),i=!0,b=0;b<d.length;b++)if(g=e-d[b].pos.lat(),h=f-d[b].pos.lng(),j=Math.sqrt(g*g+h*h),j<d[b].d){i=!1;break}while(!i);this.trees_array.push({pos:new google.maps.LatLng(e,f),a:2*Math.random()*Math.PI,scale:.75+1.5*Math.random(),offset:31.875-6*Math.random()})}k=35e-5,l=15e-5;for(var m=-k;k>m;m+=l)for(var n=-k;k>n;n+=l)e=c.lat()+m+(1e-5-5e-5*Math.random()),f=c.lng()+n+(1e-5-5e-5*Math.random()),this.trees_array.push({pos:new google.maps.LatLng(e,f),a:2*Math.random()*Math.PI,scale:.75+1.5*Math.random(),offset:33.875-2*Math.random()});for(a=0;a<this.trees_array.length;a++){var o=2*Math.random()*Math.PI;k=300+300*Math.random();var p=3+2*Math.random(),q={x:k*Math.cos(o)/p,y:k*Math.sin(o)/p};this.trees_array[a].bird={a:o,r:k,d:q,t:p,s:null,o:Math.random()}}this.trees_array.sort(function(a,b){return a.scale-b.scale})},addBirds1:function(){for(var a=0;100>a;a++){var b=-1-.5*Math.random(),c=1-2*Math.random(),d=1+.5*Math.random(),e=1-2*Math.random()-.5*Math.random(),f=1.5*(.025+.05*Math.random()),g=(d-b)/f,h=(e-c)/f,i=Math.atan2(h,g);this.birds_array.push({start:{x:b,y:c},end:{x:d,y:e},d:{x:g,y:h},a:i,t:f,o:Math.random(),scale:.4+.4*Math.random()})}},addBirds2:function(){for(var a=0;50>a;a++){var b=1-2*Math.random(),c=1+.5*Math.random(),d=1-2*Math.random(),e=-1-.5*Math.random(),f=3*(.025+.05*Math.random()),g=(d-b)/f,h=(e-c)/f,i=Math.atan2(h,g);this.birds2_array.push({start:{x:b,y:c},end:{x:d,y:e},d:{x:g,y:h},a:i,t:f,o:Math.random(),scale:.5+.3*Math.random()})}},addBirds3:function(){for(var a=0;10>a;a++){var b=1.5-3*Math.random(),c=1+.5*Math.random(),d=0,e=-3,f=3*(.025+.05*Math.random()),g=(d-b)/f,h=(e-c)/f,i=Math.atan2(h,g);this.birds3_array.push({start:{x:b,y:c},end:{x:d,y:e},d:{x:g,y:h},a:i,t:f,o:Math.random(),scale:.75+.25*Math.random()})}},addCopyright:function(a){""!==a&&(this.copyrights.push(a),this.invalidate_c=!0)},fixCopyrights:function(){this.invalidate_c&&(this.copyrights=unique(this.copyrights),this.copyright_str="© 2010 Google, "+this.copyrights.join(", "),this.copyright_str=this.copyright_str.replace(/&amp;/gi,"&"),this.canvas.title=this.copyright_str,this.invalidate_c=!1)},getCopyrights:function(){return this.copyright_str},loadCopyright:function(a,b){var c="http://maps.google.com/maps/vp?spn=1.2,1.2&t=h&z="+b+"&vp="+a.lat()+","+a.lng()+"&ev=mh&hl=en&country=us",d=document.getElementsByTagName("head").item(0),e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src",c),d.appendChild(e)},preloadImages:function(){var a,b;this.tilemap=[],this.load_failed=!1,this.setZoom(this.default_zoom,!0);for(var c=this.locationObject.getPosition(0),d=this.locationObject.getLocation(),e=d.lat()-c.lat(),f=d.lng()-c.lng(),g=0;1>g;g+=.01)a=new google.maps.LatLng(c.lat()+g*e,c.lng()+g*f),this.loadCopyright(a,this.int_zoom),b=this.calculateTileFromLatLng(a),this.enableTile(b.x,b.y,!0);a=this.locationObject.getLocation();for(var h=13;20>h;h++)this.setZoom(h),b=this.calculateTileFromLatLng(a),this.enableTile(b.x,b.y,!0);this.setZoom(this.default_zoom),this.updateCamera(0)},isPreloaded:function(){for(var a in this.tilemap){var b=this.tilemap[a];for(var c in b)if(!b[c].complete)return!1}return this.tree.image.complete&&this.bird.image.complete?!0:!1},setZoom:function(a,b){var c;if(a!=this.zoom||b){a>21.99&&(a=21.99),this.zoom=a,this.int_zoom=Math.floor(a),this.zoom2=Math.pow(2,this.int_zoom),this.tile_zoom=(1+(this.zoom-this.int_zoom))/this.scale;(1+this.int_zoom)/this.scale;this.real_zoom=1/(20-this.zoom),c=this.projection.fromLatLngToPoint(gLocation.getLocation());var d=new google.maps.Point(c.x*this.zoom2,c.y*this.zoom2),e=new google.maps.Point(Math.floor(d.x/MERCATOR_RANGE),Math.floor(d.y/MERCATOR_RANGE));this.tileorigin=e;var f=new google.maps.Point((e.x+.5)*MERCATOR_RANGE,(e.y+.5)*MERCATOR_RANGE),g=new google.maps.Point(f.x/this.zoom2,f.y/this.zoom2),h=this.projection.fromPointToLatLng(g);this.offset=new google.maps.LatLng(h.lat(),h.lng());var i=this.projection.fromLatLngToPoint(this.offset);this.poff=new google.maps.Point(i.x*this.zoom2,i.y*this.zoom2),null!==this.last_time&&this.updateCamera(this.last_time),c=new google.maps.Point(1e-5,1e-5),this.zoom_factor=new google.maps.Point(c.x*this.zoom2,c.y*this.zoom2),this.final_coordinates=this.getWorldPosition(this.locationObject.getPosition(1)),this.original_coordinates=this.getWorldPosition(this.locationObject.getPosition(0));var j=this.locationObject.getPosition(0),k=this.locationObject.getPosition(1),l=this.getWorldPosition(j),m=this.getWorldPosition(k),n=m.x-l.x,o=m.y-l.y;this.angle=-Math.atan2(o,n)}},setSize:function(a,b){this.canvas.width=a/this.scale,this.canvas.height=b/this.scale,this.canvas.style.width=a+"px",this.canvas.style.height=b+"px",this.texture.width=a/this.scale,this.texture.height=b/this.scale,this.precalc()},precalc:function(){this.spans=[];for(var a=-.5*this.texture.width,b=.5*this.texture.width,c=-.5*this.texture.height,d=.5*this.texture.height-1,e=-this.perspective*this.texture.width,f=(this.perspective*this.texture.width,180*Math.PI/180),g=-a/Math.tan(.5*f)+1e-100,h=-e/Math.tan(.5*f)+1e-100,i=(d/h-c/g)/this.canvas.height,j=(1/h-1/g)/this.canvas.height,k=(e-a)/this.canvas.height,l=.5*this.canvas.height,m=c/g,n=1/g,o=0,p=l;p>-l;p--){m+=i,n+=j;var q=m/n+.5*this.texture.height;o=(l-p)*k,this.spans.push({x:0,y:this.canvas.height-(p+l),w:this.canvas.width,h:1,u1:a+o+.5*this.texture.width,u2:b-o+.5*this.texture.width,v1:q,v2:q+1}),o+=k}},getWorldPosition:function(a){var b=this.projection.fromLatLngToPoint(a),c=new google.maps.Point(b.x*this.zoom2,b.y*this.zoom2);return c.x-=this.poff.x,c.y-=this.poff.y,c},render:function(a,b){var c,d,e,f,g,h,i,j=.5*this.texture.width,k=.5*this.texture.height;this.running&&this.updateCamera(b,a);var l=this.angle+this.texture_angle-.5*Math.PI;this.rotating&&(l=this.texture_angle),this.texture_ctx.save(),this.texture_ctx.translate(j,k),this.texture_ctx.scale(this.tile_zoom,this.tile_zoom),this.texture_ctx.rotate(l),this.texture_ctx.translate(this.position_offset.x,this.position_offset.y),this.texture_ctx.fillStyle="#000",this.debug&&(this.texture_ctx.strokeStyle="#f0f",this.texture_ctx.beginPath());var m=this.earthquake?257:256;for(c in this.tilemap[this.int_zoom]){var n=this.tilemap[this.int_zoom][c],o=n.x*n.w-128-this.position.x,p=n.y*n.h-128-this.position.y;o+n.w>=-this.texture.width&&p+n.h>=-this.texture.height&&o<=2*this.texture.width&&p<=2*this.texture.height&&(n.complete?this.texture_ctx.drawImage(n.image,0,0,255,255,o,p,m,m):this.texture_ctx.fillRect(o,o,n.w,n.h),this.debug&&(this.texture_ctx.moveTo(o,p),this.texture_ctx.lineTo(o+n.w,p),this.texture_ctx.lineTo(o+n.w,p+n.h),this.texture_ctx.lineTo(o,p+n.h),this.texture_ctx.lineTo(o,p)))}if(this.debug&&this.texture_ctx.stroke(),this.texture_ctx.restore(),this.texture_ctx.save(),this.texture_ctx.translate(j,k),this.texture_ctx.translate(this.position_offset.x,this.position_offset.y),this.texture_ctx.scale(this.tile_zoom,this.tile_zoom),this.texture_ctx.rotate(l),this.texture_ctx.globalAlpha=.7,d=this.runner_position.x-this.position.x,e=this.runner_position.y-this.position.y,this.texture_ctx.translate(d,e),this.texture_ctx.scale(this.zoom_factor.x,this.zoom_factor.y),this.texture_ctx.scale(.2,.2),this.running?(this.texture_ctx.rotate(this.runner_angle+.5*Math.PI),this.debug&&(this.texture_ctx.globalAlpha=1,this.texture_ctx.fillStyle="#f0f",this.texture_ctx.fillRect(-5,-5,10,10),this.texture_ctx.globalAlpha=.5),this.runner.blit(this.texture_ctx,0,0,a)):this.standing.blit(this.texture_ctx,0,0,a),this.texture_ctx.restore(),this.birds1){for(this.texture_ctx.save(),this.texture_ctx.translate(j,k),c=0;c<this.birds_array.length;c++)f=this.birds_array[c],g=a-this.start_time,d=f.start.x*j+f.d.x*g,e=f.start.y*k+f.d.y*g,this.texture_ctx.save(),this.texture_ctx.translate(d,e),this.texture_ctx.scale(f.scale,f.scale),this.texture_ctx.rotate(f.a+.5*Math.PI),this.texture_ctx.globalAlpha=.6+(f.scale-.4),this.bird.blit(this.texture_ctx,0,0,g+20*f.o),this.texture_ctx.restore();this.texture_ctx.restore()}if(this.birds2){for(this.texture_ctx.save(),this.texture_ctx.translate(j,k),c=0;c<this.birds2_array.length;c++)f=this.birds2_array[c],g=a-this.start_time,d=f.start.x*j+f.d.x*g,e=f.start.y*k+f.d.y*g,this.texture_ctx.save(),this.texture_ctx.translate(d,e),this.texture_ctx.globalAlpha=.6+(f.scale-.3),this.texture_ctx.scale(f.scale,f.scale),this.texture_ctx.rotate(f.a+.5*Math.PI),this.bird.blit(this.texture_ctx,0,0,g+20*f.o),this.texture_ctx.restore();this.texture_ctx.restore()}if(this.birds3){for(this.texture_ctx.save(),this.texture_ctx.translate(j,k),c=0;c<this.birds3_array.length;c++)f=this.birds3_array[c],g=a-this.start_time,d=f.start.x*j+f.d.x*g,e=f.start.y*k+f.d.y*g,this.texture_ctx.save(),this.texture_ctx.translate(d,e),i=f.scale-.1*g,.5>i&&(i=.5),this.texture_ctx.scale(i,i),this.texture_ctx.rotate(f.a+.5*Math.PI),this.bird2.blit(this.texture_ctx,0,0,g+20*f.o),this.texture_ctx.restore();this.texture_ctx.restore()}if(this.trees){for(this.texture_ctx.save(),this.texture_ctx.translate(j,k),this.texture_ctx.translate(this.position_offset.x,this.position_offset.y),this.texture_ctx.scale(this.tile_zoom,this.tile_zoom),c=0;c<this.trees_array.length;c++){var q=this.trees_array[c];if(g=a-this.start_time-q.offset,g>0)h=this.getWorldPosition(q.pos),d=h.x-this.position.x,e=h.y-this.position.y,this.texture_ctx.save(),this.texture_ctx.rotate(l),this.texture_ctx.translate(d,e),this.texture_ctx.scale(1.1*q.scale,1.1*q.scale),this.texture_ctx.rotate(q.a),this.tree.blit(this.texture_ctx,0,0,g),this.texture_ctx.restore();else if(g>-q.bird.t){null===q.bird.s&&(q.bird.s=a),g=a-q.bird.s;var r=1-g/q.bird.t;g=q.bird.t-g,h=this.getWorldPosition(q.pos),d=h.x-this.position.x,e=h.y-this.position.y,this.texture_ctx.save(),this.texture_ctx.translate(d,e),this.texture_ctx.rotate(l),d=q.bird.d.x*g,e=q.bird.d.y*g,this.texture_ctx.translate(d,e),this.texture_ctx.rotate(q.bird.a-.5*Math.PI),this.texture_ctx.scale(r,r),this.bird.blit(this.texture_ctx,0,0,a+20*q.bird.o),this.texture_ctx.restore()}}this.texture_ctx.restore()}if(this.clouds&&this.cloud.complete&&(this.texture_ctx.save(),this.texture_ctx.translate(j,k),this.texture_ctx.globalAlpha=this.clouds_alpha,this.texture_ctx.scale(2,2),this.texture_ctx.rotate(.25*l),this.texture_ctx.drawImage(this.cloud,-.5*this.cloud.width,-.5*this.cloud.height),this.texture_ctx.restore(),this.texture_ctx.save(),this.texture_ctx.globalAlpha=this.white_alpha,this.texture_ctx.fillStyle="#fff",this.texture_ctx.fillRect(0,0,this.texture.width,this.texture.height),this.texture_ctx.restore()),this.debug){for(this.texture_ctx.save(),this.texture_ctx.translate(j,k),this.texture_ctx.translate(this.position_offset.x,this.position_offset.y),this.texture_ctx.scale(this.tile_zoom,this.tile_zoom),this.texture_ctx.rotate(l),h=this.getWorldPosition(this.locationObject.getLocation()),d=h.x-this.position.x,e=h.y-this.position.y,this.texture_ctx.save(),this.texture_ctx.translate(d,e),this.texture_ctx.scale(this.zoom_factor.x,this.zoom_factor.y),this.texture_ctx.scale(.1,.1),this.texture_ctx.fillStyle="#f0f",this.texture_ctx.fillRect(-5,-5,10,10),this.texture_ctx.restore(),this.texture_ctx.save(),this.texture_ctx.translate(d,e),this.texture_ctx.scale(this.zoom_factor.x,this.zoom_factor.y),this.texture_ctx.scale(.1,.1),this.texture_ctx.fillStyle="#f0f",this.texture_ctx.fillRect(-5,-5,10,10),this.texture_ctx.restore(),this.texture_ctx.save(),this.texture_ctx.strokeStyle="#f0f",this.texture_ctx.beginPath(),c=0;1>c;c+=.1)h=this.getWorldPosition(this.locationObject.getPosition(c)),d=h.x-this.position.x,e=h.y-this.position.y,this.texture_ctx.lineTo(d,e),this.texture_ctx.arc(d,e,5,0,2*Math.PI),this.texture_ctx.moveTo(d,e);this.texture_ctx.stroke(),this.texture_ctx.restore(),this.texture_ctx.save(),this.texture_ctx.fillStyle="#f0f",this.texture_ctx.beginPath();var s=this.locationObject.getRoute();for(c=0;c<s.length;c++)h=this.getWorldPosition(s[c]),d=h.x-this.position.x,e=h.y-this.position.y,this.texture_ctx.arc(d,e,5,0,2*Math.PI);this.texture_ctx.fill(),this.texture_ctx.restore(),this.texture_ctx.restore()}for(c=0;c<this.spans.length;c++)i=this.spans[c],this.ctx.drawImage(this.texture,i.u1,i.v1,i.u2-i.u1,i.v2-i.v1,i.x,i.y,i.w,i.h);this.vignette.complete&&(this.ctx.save(),this.ctx.globalAlpha=1*(1-this.white_alpha),this.ctx.drawImage(this.vignette,0,0,this.vignette.width,this.vignette.height,0,0,this.canvas.width,this.canvas.height),this.ctx.restore()),this.frameCount++},updateCamera:function(a,b){var c,d,e,f=null;this.runner_position&&(f=this.runner_position);var g,h,i,j=this.trees?1.35:1;if(this.trees){var k=34.409/45.409,l=1-k,m=l+(b-244.5931396484375)/34.409*k;i=this.locationObject.getPosition(l),g=this.locationObject.getPosition(m),h=this.locationObject.getPosition(m+.005)}else i=this.locationObject.getPosition(0),g=this.locationObject.getPosition(a),h=this.locationObject.getPosition(a+.005);var n=this.locationObject.getLocation(),o=new google.maps.LatLng(n.lat()-i.lat(),n.lng()-i.lng()),p=new google.maps.LatLng(i.lat()+a*j*o.lat(),i.lng()+a*j*o.lng()),q=this.getWorldPosition(g),r=this.getWorldPosition(p),s=this.getWorldPosition(h);this.fpos=this.getWorldPosition(n),f||(f=q),c=s.x-f.x,d=s.y-f.y,e=Math.atan2(d,c),c=s.x-q.x,d=s.y-q.y,e=Math.atan2(d,c),this.runner_angle=e;var t=this.calculateTileFromLatLng(p);this.position={x:r.x,y:r.y,tile_x:t.x,tile_y:t.y},this.runner_position=q,this.last_time=a,this.enableTile(t.x,t.y,!1)},enableTile:function(a,b,c){for(var d=-this.extent;d<=this.extent;d++)for(var e=-this.extent;e<=this.extent;e++){var f=a+e+"."+(b+d);if(void 0===this.tilemap[this.int_zoom]&&(this.tilemap[this.int_zoom]={}),void 0===this.tilemap[this.int_zoom][f]){var g,h=a+e,i=b+d;switch(this.map_type){case 1:g="http://khm0.google.com/kh/v="+this.map_version+"&x="+h+"&s=&y="+i+"&z="+this.int_zoom+"&s=Galil";break;case 2:g="http://mt1.google.com/vt/lyrs=m@129&hl=en&x="+h+"&y="+i+"&z="+this.int_zoom+"&s=Gal"}var j={x:h-this.tileorigin.x,y:i-this.tileorigin.y,w:256,h:256,is_critical:c,image:new Image,complete:!1};this.attachImage(j,g),this.tilemap[this.int_zoom][h+"."+i]=j}}},attachImage:function(a,b){var c=this;a.image.onerror=function(){a.is_critical&&!c.load_failed&&(c.load_failed=!0)},a.image.onload=function(){if(RegExp(" AppleWebKit/").test(navigator.userAgent)){var b=document.createElement("canvas");b.width=256,b.height=256;var c=b.getContext("2d");c.drawImage(this,0,0),c.globalAlpha=.5,c.globalCompositeOperation="darker",c.fillStyle="#704214",c.fillRect(0,0,256,256),c.globalCompositeOperation="lighter",c.drawImage(this,0,0),a.image=b}a.complete=!0},a.image.src=b},calculateTileFromLatLng:function(a){var b=this.projection.fromLatLngToPoint(a),c=new google.maps.Point(b.x*this.zoom2,b.y*this.zoom2),d=new google.maps.Point(Math.floor(c.x/MERCATOR_RANGE),Math.floor(c.y/MERCATOR_RANGE));return{x:d.x,y:d.y}}};var BitmapSequence=function(a){var b=a,c=a.length-1;this.position=0,this.get=function(){return b[Math.floor(this.position*c)]}},Crow=function(){function a(a,b,d){c.vertices.push(new THREE.Vertex(new THREE.Vector3(a,b,d)))}function b(a,b,d){c.faces.push(new THREE.Face3(a,b,d))}var c=this;THREE.Geometry.call(this),a(5,0,0),a(-5,-2,1),a(-5,0,0),a(-5,-2,-1),a(0,2,-6),a(0,2,6),a(2,0,0),a(-3,0,0),b(0,2,1),b(4,7,6),b(5,6,7)};Crow.prototype=new THREE.Geometry,Crow.prototype.constructor=Crow;var Sphere=function(a,b,c,d,e){THREE.Geometry.call(this);var f,g,h=b||8,i=c||6,j=Math.max(3,h),k=Math.max(2,i),l=[];for(g=0;k+1>g;g++){var m=g/k,n=a*Math.cos(m*Math.PI),o=a*Math.sin(m*Math.PI),p=[],q=0;for(f=0;j>f;f++){var r=2*f/j,s=o*Math.sin(r*Math.PI),t=o*Math.cos(r*Math.PI);(0==g||g==k)&&f>0||(q=this.vertices.push(new THREE.Vertex(new THREE.Vector3(t,n,s)))-1),p.push(q)}l.push(p)}var u=l.length;for(g=0;u>g;g++){var v=l[g].length;if(g>0)for(f=0;v>f;f++){var w=f==v-1,x=l[g][w?0:f+1],y=l[g][w?v-1:f],z=l[g-1][w?v-1:f],A=l[g-1][w?0:f+1],B=g/(u-1),C=(g-1)/(u-1),D=(f+1)/v,E=f/v,F=new THREE.UV(d?D:1-D,e?1-B:B),G=new THREE.UV(d?E:1-E,e?1-B:B),H=new THREE.UV(d?E:1-E,e?1-C:C),I=new THREE.UV(d?D:1-D,e?1-C:C);g<l.length-1&&(this.faces.push(new THREE.Face3(x,y,z)),this.uvs.push([F,G,H])),g>1&&(this.faces.push(new THREE.Face3(x,z,A)),this.uvs.push([F,H,I]))}}};Sphere.prototype=new THREE.Geometry,Sphere.prototype.constructor=Sphere;var SeededRandom=function(){var a=0,b=[.855,.075,.33,.715,.165,.45,.905,.25,.665,.335,.0115,.41,.895,.735,.86,.54,.94,.725,.815,.37,.545,.31,.15,.485,.635,.765,.28,.195,.34,.475,.18,.285,.47,.95,.7,.135,.995,.755,.575,.04,.315,.87,.885,.59,.13,.125,.48,.75,.43,.42,.045,.215,.64,.66,.63,.9,.555,.1,.84,.175,.73,.11,.495,.415,.71,.99,.405,.455,.395,.645,.275,.52,.65,.235,.825,.58,.8,.775,.305,.17,.435,.03,.62,.68,.74,.505,.685,.36,.96,.56,.225,.035,.98,.865,.155,.27,.12,.83,.345,.61,.08,.745,.365,.845,.065,.965,.16,.67,.535,.51,.705,.3,.2,.085,.24,.565,.09,.465,.875,.82,.055,.265,.88,.29,.79,.22,.02,.605,.93,.92,.935,.5,.185,.785,.85,.625,.78,.06,.46,.89,.21,.26,.325,.91,.23,.05,.32,.145,.945,.97,.425,.205,.39,.805,.77,.075,.675,.025,.245,.35,.015,0,.4,.655,.53,.975,.295,.005,.49,.07,.69,.955,.595,.57,.615,.81,.14,.445,.985,.695,.795,.255,.19,.55,.915,.44,.385,.76,.515,.01,.925,.585,.72,.375,.6,.525,.835,.355,.38,.105];this.next=function(){var c=b[a];return a+=1,a%=b.length,c},this.reset=function(){a=0}},__seed=new SeededRandom;Brush.prototype.strokeStart=function(a,b){this.wasStroking=!1,this.stroking=!0,this.mouseX=this.prevMouseX=a,this.mouseY=this.prevMouseY=b,this.velocity=0,this.curCount=0},Brush.prototype.stroke=function(a,b){if(a==this.prevMouseX&&b==this.prevMouseY)return!1;this.prevMouseX=this.mouseX,this.prevMouseY=this.mouseY,this.mouseX=a,this.mouseY=b,this.bornFrom||this.points.push([a,b]),this.bornFrom||this.allPoints.push([a,b]),this.pvelocity=this.velocity,this.velocity=this.dist(this.mouseX,this.mouseY,this.prevMouseX,this.prevMouseY);var c=Math.atan2(this.mouseY-this.prevMouseY,this.mouseX-this.prevMouseX);if(this.velocity>0&&(this.angle=c),!this.bornFrom&&this.velocity>this.pointsEvery)for(var d=this.pointsEvery/this.velocity,e=0,f=0;1>=f;f+=d){var g=this.lerp(this.prevMouseX,this.mouseX,f),h=this.lerp(this.prevMouseY,this.mouseY,f);this.points.push([g,h]),e++}return this.opa(this.getStrokeOpacity()),this.context.lineWidth=this.getLineWidth(),this.line(this.prevMouseX,this.prevMouseY,this.mouseX,this.mouseY),this.curCount++,!0},Brush.prototype.strokeEnd=function(){this.wasStroking=!0,this.stroking=!1,this.curCount=0,this.clearPointsOnMouseUp&&(this.points=[])},Brush.prototype.destroy=function(){this.points=[],this.allPoints=[]},Brush.prototype.chance=function(a){return this.randomizer.next()<a},Brush.prototype.lerp=function(a,b,c){return(b-a)*c+a},Brush.prototype.constrain=function(a,b,c){return b>a&&(a=b),a>c&&(a=c),a},Brush.prototype.randomSpread=function(a){return this.randomizer.next()*a*(this.randomizer.next()<.5?1:-1)},Brush.prototype.random=function(a,b){return this.randomizer.next()*(b+a)-a},Brush.prototype.map=function(a,b,c,d,e){return d+(e-d)*((a-b)/(c-b))},Brush.prototype.dist=function(a,b,c,d){return Math.sqrt((a-c)*(a-c)+(b-d)*(b-d))},Brush.prototype.line=function(a,b,c,d){this.context.beginPath(),this.context.moveTo(a,b),this.context.lineTo(c,d),this.context.stroke()},Brush.prototype.opa=function(a){this.context.strokeStyle="rgba(0, 0, 0, "+a+")"},BranchingBrush.prototype=new Brush,BranchingBrush.prototype.constructor=BranchingBrush,BranchingBrush.prototype.stroke=function(a,b){if(Brush.prototype.stroke.call(this,a,b)){if(this.drawShading)for(var c=0;c<this.points.length;c+=this.shadeSkip){var e=this.points[c];this.dist(a,b,e[0],e[1]);dx=e[0]-a,dy=e[1]-b,d=dx*dx+dy*dy,this.context.lineWidth=this.shadeConnectionLineWidth,d<this.shadeConnectionDistanceSquared&&(this.opa((1-d/this.shadeConnectionDistanceSquared)*this.shadeConnectionOpacityDampening),this.line(a,b,e[0],e[1]))}if(!this.bornFrom&&this.curCount>this.minPointsToBranch&&this.pvelocity>=this.throwVelocity){this.shouldThrow=!0}this.shouldBranch()&&this.branch()}else{if(this.shouldThrow&&this.curCount>1){var f=this.branch();f.growthVelocity<this.minThrownBranchVelocity&&(f.growthVelocity=this.minThrownBranchVelocity)}this.shouldThrow=!1}},BranchingBrush.prototype.shouldBranch=function(){return this.bornFrom?this.chance(this.branchChance)&&this.velocity>1:this.curCount>this.minPointsToBranch&&this.chance(this.branchChance)&&this.velocity>this.speedToBranch},BranchingBrush.prototype.strokeEnd=function(){this.stroking&&(Brush.prototype.strokeEnd.call(this),this.velocity>=this.throwVelocity&&this.branch(),this.shouldThrow=!1)},BranchingBrush.prototype.branch=function(){return new Branch(this)},Branch.prototype=new BranchingBrush,Branch.prototype.constructor=Branch,Branch.prototype.isDead=function(){return this.growthVelocity<.5},Branch.prototype.update=function(){this.angle+=this.randomSpread(this.angleJitter),this.ix+=Math.cos(this.angle)*this.growthVelocity,this.iy+=Math.sin(this.angle)*this.growthVelocity,this.growthVelocity*=this.growthDecay,this.stroke(this.ix,this.iy),this.isDead()&&this.content.branches.splice(this.content.branches.indexOf(this),1)};var glyphs={NO_GLYPH:{character:"NO_GLYPH",svgData:'<path d="M0,0V0"/>',
speed:.08,width:0,height:100,left:0,right:0}," ":{character:" ",svgData:'<path d="M0,0V0"/>',speed:.08,width:100,height:100,left:-35,right:-34},A:{character:"A",svgData:'<path d="M43.917,57.479c0.1-1.356,5.364-15.577,5.994-16.592c3.093,6.399,5.207,13.092,7.773,19.858"></path><path d="M40.65,52.578c4.66-1.009,14.233-2.566,14.233-2.566"></path>',speed:.045,width:100,height:100,left:-40,right:-33},B:{character:"B",svgData:'<path d="M44.434,44.033c-0.206,4.864,1.365,10.883,1.633,16.1"></path><path d="M40.934,48.467C43.639,44.174,50.5,40.5,52.75,44.5s-5.703,6.9-8.593,7.232c2.739-3.653,13.55-4.009,11.601,2.549c-0.919,3.094-4.25,5.053-7.547,5.447"></path>',speed:.037,width:100,height:100,left:-39,right:-34},C:{character:"C",svgData:'<path d="M53.066,46.133c-1.689-2.732-3.345-6.051-6.519-2.609c-2.467,2.674-5.234,9.768-2.069,12.851c3.389,3.302,11.275,1.229,13.255-2.775"/>',speed:.09,width:100,height:100,left:-38,right:-34},D:{character:"D",svgData:'<path d="M44.2,44.033c-0.015,4.662,0.234,7.467-0.233,13.067"></path><path d="M43.267,42.4c5.65,0.015,10.5,1.4,11.667,7.467s-5.141,7.971-11.9,7.467"></path>',speed:.06,width:100,height:100,left:-40,right:-36},E:{character:"E",svgData:'<path d="M46.534,41.933c-1.699,2.655-3.714,8.763-2.805,11.906c1.427,4.935,9.845,1.554,13.304,1.627"></path><path d="M42.567,49.4c3.092-0.602,6.408-1.773,9.567-1.633"></path><path d="M43.967,43.1c3.388-0.317,6.544-1.634,10.033-1.633"></path>',speed:.04,width:100,height:100,left:-40,right:-36},F:{character:"F",svgData:'<path d="M41.512,44.54c0-0.519-0.006-0.55-0.02-0.095c0.188,5.119,2.236,10.008,2.048,15.16"></path><path d="M41.222,43.09c0.396,0.765,13.764-2.124,16.222-2.028"></path><path d="M42.091,50.623c0.411,0.479,6.53-0.504,8.113-0.869"></path>',speed:.066,width:100,height:100,left:-40,right:-38},G:{character:"G",svgData:'<path d="M50.25,52.75c2.5-0.5,5.36-1.278,10.223-1.732"></path><path d="M54.09,43.769c-1.432-1.068-2.445-2.59-4.462-2.339c-4.494,0.561-11.25,12.218-7.041,15.616c2.292,1.851,14.496,5.787,12.746-5.713"></path>',speed:.035,width:100,height:100,left:-36,right:-30},H:{character:"H",svgData:'<path d="M44.526,41.295c0.481,1.44,0.327,5.899,0.276,6.417c-0.314,3.181-1.18,6.353-1.194,9.556"></path><path d="M53.875,39.767c-1.02,6.904-2.086,14.284-0.7,21.233"></path><path d="M42.441,49.567c4.66,0.568,9.312,0.465,14,0.467"></path>',speed:.05,width:100,height:100,left:-39,right:-34},I:{character:"I",svgData:'<path d="M49.677,40.654c-0.07,6.42-0.234,12.8,0.401,19.201"/>',speed:.15,width:100,height:100,left:-43,right:-40},J:{character:"J",svgData:'<path d="M42.205,53.108c0.003-0.45-0.009-0.467-0.041-0.055c0.295,4.685,6.75,6.375,9.516,2.765c3.309-4.323,0.13-8.687-0.965-12.679"></path><path d="M44.617,44.519c1.246-0.375,8.545-1.306,13.033-1.75"></path>',speed:.055,width:100,height:100,left:-39,right:-34},K:{character:"K",svgData:'<path d="M43.142,42.567c1.616,4.896,0.967,11.478,0.933,16.567"></path><path d="M49.459,42.018c0.175,2.59-1.907,8.962-4.58,10.322c3.638-1.477,10.807-0.074,11.796,4.461"></path>',speed:.07,width:100,height:100,left:-39,right:-34},L:{character:"L",svgData:'<path d="M44.542,42.801c0,4.759-0.337,9.559-0.463,14.196c3.048,0.095,9.096-0.196,11.896-0.896"/>',speed:.11,width:100,height:100,left:-39,right:-34},M:{character:"M",svgData:'<path d="M43.142,57.734c-0.085,0.218-0.174,0.434-0.268,0.646c0.961-5.161,2.573-10.754,2.611-15.994c-0.04,2.397-0.583,9.317,2.825,9.984c3.462,0.677,6.394-8.415,6.28-10.935c-0.479,2.799,1.118,14.27,2.318,17.23"/>',speed:.055,width:100,height:100,left:-39,right:-34},N:{character:"N",svgData:'<path d="M45.061,56.533c-0.362-4.166,0.317-8.441,1.314-12.467c2.341,3.694,5.867,8.301,8.63,12.469c0.362-4.721,0.708-9.464,0.737-14.201"/>',speed:.072,width:100,height:100,left:-39,right:-34},O:{character:"O",svgData:'<path d="M49.441,45.133c-0.142-0.862-0.571-1.58-1.401-1.93c-2.579-1.087-4.65,2.956-5.6,4.729c-1.519,2.831-2.758,7.216,0.903,8.902c3.513,1.619,8.691-0.239,11.219-2.857c6-6.213-4.703-10.504-9.789-10.243"/>',speed:.065,width:100,height:100,left:-39,right:-34},P:{character:"P",svgData:'<path d="M47.808,43.034c0.006-0.467,0.001-0.548-0.016-0.243c0.218,5.45,0.839,11.39,2.583,16.576"></path><path d="M42.397,43.738c3.022-1.277,10.122-2.069,13.085-0.287c1.596,0.959,2.04,2.44,0.762,3.991c-1.754,2.128-5.825,1.868-8.203,1.892"></path>',speed:.05,width:100,height:100,left:-39,right:-34},Q:{character:"Q",svgData:'<path d="M54.348,46.347c0.411-1.815-0.982-3.375-2.71-3.678c-4.723-0.831-10.482,8.46-7.765,12.323c3.027,4.302,13.685,1.812,13.659-3.774c-0.026-5.366-7.393-8.693-12.015-6.685"></path><path d="M52.05,53.867c-0.383-0.23-0.419-0.237-0.106-0.02c1.375,1.072,2.74,2.162,4.073,3.285"></path>',speed:.03,width:100,height:100,left:-39,right:-34},R:{character:"R",svgData:'<path d="M44.117,44.533c-0.002,4.456,0.234,8.401-0.233,13.301"></path><path d="M41.783,42.221c2.52-0.105,11.812-0.59,12.632,2.78c0.783,3.218-11.582,4.06-13.569,3.971c2.21-0.047,4.283-0.281,6.517-0.059c2.984,0.297,9.146,3.687,10.986,6.588"></path>',speed:.03,width:100,height:100,left:-39,right:-34},S:{character:"S",svgData:'<path d="M54.384,45c0.585-5.4-9.261-2.55-8.145,1.161c0.465,1.548,4.597,2.486,5.809,3.135c1.86,0.997,3.728,2.209,3.577,4.57c-0.436,6.845-9.642,5.834-11.741,2.567"/>',speed:.07,width:100,height:100,left:-39,right:-34},T:{character:"T",svgData:'<path d="M42.483,43.6c3.714-0.057,14.7,0.234,14.7,0.234"></path><path d="M49.717,43.6c0,4.356,0,8.71,0,13.067"></path>',speed:.1,width:100,height:100,left:-39,right:-34},U:{character:"U",svgData:'<path d="M45.284,42.667c-1.78,5.364-3.395,14.686,5.833,13.767c6.807-0.678,5.336-9.574,3.732-14"/>',speed:.08,width:100,height:100,left:-39,right:-34},V:{character:"V",svgData:'<path d="M45.682,41.172c0.001,5.218,1.369,12.031,4.408,16.318c2.459-5.725,4.055-10.345,4.836-15.831"/>',speed:.08,width:100,height:100,left:-39,right:-34},W:{character:"W",svgData:'<path d="M44,43.075c-2.474,4.699-3.216,11.625,0.496,12.857c2.164,0.719,4.451-1.975,5.193-4.942c0.248,3.215,2.275,6.051,5.096,5.375c2.819-0.676,4.552-6.612,3.066-10.817"/>',speed:.065,width:100,height:100,left:-39,right:-34},X:{character:"X",svgData:'<path d="M43.802,42.911c3.093,4.157,8.042,10.134,12.681,12.731"></path><path d="M54.962,43.368c-1.251,4.495-6.52,8.898-11.779,13.055"></path>',speed:.08,width:100,height:100,left:-39,right:-34},Y:{character:"Y",svgData:'<path d="M55.449,39.5c0.471,0.122-2.462,6.636-2.744,7.378c-1.912,5.068-3.587,10.363-5.062,15.569c-0.159,0.561-1.182,5.646-1.439,5.646"></path><path d="M50.006,54.795c-0.091,0.156-0.022,0.458-0.207,0.258c-4.567-3.26-5.39-8.967-6.379-14.733"></path>',speed:.05,width:100,height:100,left:-39,right:-34},Z:{character:"Z",svgData:'<path d="M44.013,44.263c2.367,1.201,12.081,0.755,13.372-0.037c-3.932,3.267-9.373,8.112-13.372,11.167c4.658,0,9.835-0.259,13.976,0"></path>',speed:.08,width:100,height:100,left:-39,right:-34},".":{character:".",svgData:'<path d="M49.449,61.053c0.847,0.102,1.312-1.135,0.688-1.748c-0.717-0.705-1.877-0.084-1.407,1.043"/>',speed:.4,width:100,height:100,left:-45,right:-45},"\r":{character:"\r",svgData:'<path d="M0,0V0"/>',speed:.08,width:2e3,height:10,left:0,right:0}},SVG=function(a){this.filename="",this.children=[];var b=a.getAttribute("width"),c=a.getAttribute("height");this.width=null===b?0:parseFloat(b.replace("px","")),this.height=null===c?0:parseFloat(c.replace("px",""));for(var d=0;d<a.childNodes.length;d++)if(a.childNodes.item(d).getAttribute){var e;e="g"==a.childNodes.item(d).nodeName?new SVG(a.childNodes.item(d)):new Path(a.childNodes.item(d)),this.children.push(e)}this.draw=function(a){for(var b=0;b<this.children.length;b++)this.children[b].draw(a)}},Path=function(a){this.element=a,this.commands=commands(a),this.lineWidth=parseLineWidth(a),this.strokeStyle=parseStrokeStyle(a),this.fillStyle=parseFillStyle(a),this.totalLength=0,this.lengths=[],this.tlengths=[];var b=function(){this.reset=function(){this.x=this.y=this.x1=this.y1=this.x2=this.y2=0},this.reset()};this.draw=function(a){this.style(a),a.beginPath(),this.shape(a),this.end(a)},this.shape=function(a){for(var c=0;c<this.commands.length;c++)this.commands[c].shape(b,a)},this.lerp=function(a,b,c,d,e){var f=1-e;return a*f*f*f+3*b*e*f*f+3*c*e*e*f+d*e*e*e},this.at=function(a,c){var d,e;0===this.lengths.length&&this.calcLengths(c);for(var f=this.tlengths[0],g=0;a>f;)g++,f+=this.tlengths[g];pt=f-this.tlengths[g];for(var h=this.map(a,pt,f,0,1),i=0;g>=i;i++)this.commands[i].shape(b,c);var j=b.x,k=b.y;return this.commands[g+1].shape(b,c),d=this.lerp(j,b.x1,b.x2,b.x,h),e=this.lerp(k,b.y1,b.y2,b.y,h),{x:d,y:e}},this.map=function(a,b,c,d,e){return d+(e-d)*((a-b)/(c-b))},this.calcLengths=function(a){var c,d,e,f,g=0,h=.001;this.commands[0].shape(b,a);var i=b.x;e=i;var j=b.y;f=j;for(var k=1;k<this.commands.length;k++){g=0,i=b.x,j=b.y,this.commands[k].shape(b,a);for(var l=0;1>=l;l+=h)c=this.lerp(i,b.x1,b.x2,b.x,l),d=this.lerp(j,b.y1,b.y2,b.y,l),g+=this.dist(c,d,e,f),e=c,f=d;this.lengths.push(g),this.totalLength+=g}for(var m=0;m<this.lengths.length;m++)this.tlengths.push(this.lengths[m]/this.totalLength)},this.dist=function(a,b,c,d){return Math.sqrt((a-c)*(a-c)+(b-d)*(b-d))},this.style=function(a){null!==this.lineWidth&&(a.lineWidth=this.lineWidth),null!==this.strokeStyle&&(a.strokeStyle=this.strokeStyle,void 0===this.lineWidth&&(a.lineWidth=1)),null!==this.fillStyle&&(a.fillStyle=this.fillStyle)},this.end=function(a){null!==this.fillStyle&&a.fill(),null!==this.strokeStyle&&a.stroke()}},parseLineWidth=function(a){var b=a.attributes.getNamedItem("stroke-width");return null===b?null:parseFloat(b.nodeValue)},parseStrokeStyle=function(a){var b=a.attributes.getNamedItem("stroke");return null===b?null:b.nodeValue},parseFillStyle=function(a){var b=a.attributes.getNamedItem("fill");if(null===b){var c=a.attributes.getNamedItem("stroke");return null!==c?null:"#000000"}return"none"==b.nodeValue?null:b.nodeValue},Command=function(a,b){this.type=a,this.data=b,this.debug=!1,this.shape=function(a,b){var c,d;a.x,a.y;"M"==this.type?(a.x=this.data[0],a.y=this.data[1],b&&b.moveTo(a.x,a.y)):"C"==this.type?(a.x=this.data[4],a.y=this.data[5],b&&b.bezierCurveTo(a.x1=this.data[0],a.y1=this.data[1],a.x2=this.data[2],a.y2=this.data[3],a.x,a.y)):"c"==this.type?b&&b.bezierCurveTo(a.x1=a.x+this.data[0],a.y1=a.y+this.data[1],a.x2=a.x+this.data[2],a.y2=a.y+this.data[3],a.x+=this.data[4],a.y+=this.data[5]):"S"==this.type?(a.x=this.data[2],a.y=this.data[3],c=a.x-a.x2,d=a.y-a.y2,b&&b.bezierCurveTo(a.x1=a.x+c,a.y1=a.y+d,a.x2=this.data[0],a.y2=this.data[1],a.x,a.y)):"s"==this.type?(c=a.x-a.x2,d=a.y-a.y2,b&&b.bezierCurveTo(a.x1=a.x+c,a.y1=a.y+d,a.x2=a.x+this.data[0],a.y2=a.y+this.data[1],a.x+=this.data[2],a.y+=this.data[3])):"L"==this.type?(a.x1=a.x,a.y1=a.y,b&&b.lineTo(a.x=this.data[0],a.y=this.data[1]),a.x2=a.x,a.y2=a.y):"l"==this.type?(a.x1=a.x,a.y1=a.y,b&&b.lineTo(a.x+=this.data[0],a.y+=this.data[1]),a.x2=a.x,a.y2=a.y):"H"==this.type?(a.x1=a.x,a.y1=a.y,b&&b.lineTo(a.x=this.data[0],a.y),a.x2=a.x,a.y2=a.y):"h"==this.type?(a.x1=a.x,a.y1=a.y,b&&b.lineTo(a.x+=this.data[0],a.y),a.x2=a.x,a.y2=a.y):"V"==this.type?(a.x1=a.x,a.y1=a.y,b&&b.lineTo(a.x,a.y=this.data[0]),a.x2=a.x,a.y2=a.y):"v"==this.type?(a.x1=a.x,a.y1=a.y,b&&b.lineTo(a.x,a.y+=this.data[0]),a.x2=a.x,a.y2=a.y):"z"==this.type?b.closePath():alert("unrecognized command "+this.type),b&&(b.strokeStyle="#000000",b.lineWidth=1,this.debug&&(b.strokeRect(a.x-1.5,a.y-1.5,3,3),b.beginPath(),b.moveTo(a.px,a.py),b.lineTo(a.x1,a.y1),b.closePath(),b.stroke()))}},commands=function(a){return"path"==a.nodeName.toLowerCase()?commandsFromD(a.getAttribute("d")):"polygon"==a.nodeName.toLowerCase()?commandsFromPoints(a.getAttribute("points")):"line"==a.nodeName.toLowerCase()?commandsFromLine(a):"rect"==a.nodeName.toLowerCase()?commandsFromRect(a):[]},commandsFromD=function(a){for(var b=[],c=a.match(/[a-zA-Z][0-9\.\-\,]+/g),d=0;d<c.length;d++){var e=c[d].charAt(0),f=c[d].substr(1);f=f.replace(/\-/g,",-"),","==f.charAt(0)&&(f=f.substr(1)),f=f.split(",");for(var g=0;g<f.length;g++)f[g]=parseFloat(f[g]);b.push(new Command(e,f))}return b},commandsFromLine=function(a){var b=[],c=parseFloat(a.getAttribute("x1")),d=parseFloat(a.getAttribute("x2")),e=parseFloat(a.getAttribute("y1")),f=parseFloat(a.getAttribute("y2"));return b.push(new Command("M",[c,e])),b.push(new Command("L",[d,f])),b},commandsFromPoints=function(a){var b=!0;if(-1==a.indexOf(","))for(var c=0;c<a.length;c++){var d=a.charAt(c);" "==d&&(b&&(a=a.setCharAt(c,",")),b=!b)}a="M"+a,a=a.replace(/ /g,"L")+"z";var e=commandsFromD(a);return e};String.prototype.setCharAt=function(a,b){return a>this.length-1?str:this.substr(0,a)+b+this.substr(a+1)};var commandsFromRect=function(a){var b=[],c=parseFloat(a.getAttribute("x")),d=parseFloat(a.getAttribute("y")),e=parseFloat(a.getAttribute("width")),f=parseFloat(a.getAttribute("height"));return b.push(new Command("M",[c,d])),b.push(new Command("h",[e])),b.push(new Command("v",[f])),b.push(new Command("h",[-e])),b.push(new Command("v",[-f])),b},Sequencer=function(){var a=[],b=[],c=[],d=0,e=0,f=0;this.add=function(b,d,e){b.__active=!1,b.__start_time=d,b.__end_time=d+e,a.push(b),a.sort(function(a,b){return a.__start_time-b.__start_time}),c.push(b),c.sort(function(a,b){return a.__end_time-b.__end_time})},this.update=function(g,h){var i,j,k;if(!(f>g)){for(;c[e]&&(k=c[e],!(k.__end_time>g));){if(k.__active)for(k.__active=!1,k.hide(),i=0,j=b.length;j>i;i++)k==b[i]&&b.splice(i,1);e+=1}for(;a[d]&&(k=a[d],!(k.__start_time>g));)!k.__active&&k.__end_time>g&&(k.show(),k.__active=!0,b.push(k)),d+=1;for(i=0,j=b.length;j>i;i++)b[i].update(g,(g-b[i].__start_time)/(b[i].__end_time-b[i].__start_time),h);f=g}},this.clear=function(){for(d=0,e=0;b.length;){var a=b[0];a.__active=!1,a.hide(),b.splice(0,1)}},this.reset=function(){a=[],b=[],c=[],d=0,e=0,f=0},this.pause=function(){for(var a=0,c=b.length;c>a;a++)b[a].pause()},this.resume=function(){for(var a=0,c=b.length;c>a;a++)b[a].resume()}},Effect=function(){this.load=function(){},this.show=function(){},this.hide=function(){},this.update=function(a,b,c){},this.pause=function(){},this.resume=function(){}},PopupEffect=function(a,b,c){Effect.call(this);var d=a,e=b.x+win_offset_x,f=b.y+win_offset_y,g=b.width,h=b.height+50;10==b.x&&1024==b.y&&100==b.width&&60==b.height&&(e=0,f=screen.availHeight-110,h=110),this.tween=null,this.hasTween=c,this.show=function(){d.settings.x,d.settings.y,d.settings.width,d.settings.height;d.settings={x:e,y:f,width:g,height:h},d.resizeTo(g,h),d.innerHeight>b.height&&d.resizeTo(g,h-50),d.moveTo(e,f)},this.hide=function(){null!==this.tween&&this.tween.destroy()},this.update=function(a,b,c){}};PopupEffect.prototype=new Effect,PopupEffect.prototype.constructor=PopupEffect;var PopupTween=function(a,b,c){this.popup=a,this.x=this.popup.settings.x,this.y=this.popup.settings.y,this.tween=null;var d=this;this.show=function(){this.tween=new TWEEN.Tween(this.popup.settings),this.tween.easing(TWEEN.Easing.Linear.EaseNone),this.tween.onUpdate(function(){d.popup.moveTo(a.settings.x,a.settings.y),d.popup.resizeTo(a.settings.width,a.settings.height)}),this.tween.to(c,b)},this.hide=function(){null!==this.tween&&this.tween.destroy()},this.update=function(a,b,c){}};PopupTween.prototype=new Effect,PopupTween.prototype.constructor=PopupTween;var PopupShaker=function(a){this.popup=a,this.noise=10,this.x=0,this.y=0,this.show=function(){this.x=this.popup.screenX,this.y=this.popup.screenY},this.hide=function(){},this.update=function(a,b,c){this.popup.moveTo(this.x+this.noise*(Math.random()-Math.random()),this.y+this.noise*(Math.random()-Math.random()))}};PopupShaker.prototype=new Effect,PopupShaker.prototype.constructor=PopupShaker;var PopupZoomOut=function(a,b){this.popup=a,this.width=b.width,this.height=b.height,this.x=this.popup.settings.x,this.y=b.y,this.tween=null,this.decay=4;var c=this;this.show=function(){this.tween=new TWEEN.Tween(this.popup.settings),this.tween.easing(TWEEN.Easing.Expo.EaseOut),this.tween.onUpdate(function(){c.popup.moveTo(a.settings.x,a.settings.y)}),this.tween.to(b.duration,{x:screen.availWidth,y:0})},this.hide=function(){null!==this.tween&&this.tween.destroy(),this.popup.resizeTo(10,10),this.popup.moveTo(0,2100)},this.update=function(a,b,c){}};PopupZoomOut.prototype=new Effect,PopupZoomOut.prototype.constructor=PopupZoomOut;var mapContents=[2,7,9,11,13,14,15,23,27,29,31],DEFAULT_POPUP_PROPERTIES="menubar=0, resizable=0, location=0, toolbar=0, status=0, scrollbars=0, titlebar=0, left=0, top=0, width=100, height=100",windows=[],nWindows=6,windowsReady,controller,win_offset_x=screen.availWidth>1024?.5*(screen.availWidth-1024):0,win_offset_y=screen.availHeight>768?.5*(screen.availHeight-768):0,_contents=[],main_drawingTool,drawingTool,Content=function(){Effect.call(this),this.target=null,this.preloaded=!1,this.loadingfailed=!1,this.load=function(){this.preloaded=!0},this.setTarget=function(a){this.target=a},this.__defineGetter__("container",function(){return this.target.document.body}),this.update=function(a,b,c){}};Content.prototype=new Effect,Content.prototype.constructor=Content;var VideoContent=function(a,b,c,d){function e(){k.removeEventListener("load",e,!1),j.ratio=j.video.videoWidth/j.video.videoHeight,j.video.width=a,j.video.height=a/j.ratio,j.video.height<b&&(j.video.height=b,j.video.width=b*j.ratio),j.preloaded=!0}function f(){k.play()}function g(a){var b=a.target.innerWidth,c=a.target.innerHeight;j.video.style.left=.5*(b-j.video.width)+"px",j.video.style.top=.5*(c-j.video.height)+"px"}Content.call(this);var h,i,j=this;this.ratio=0;var k=this.video=document.createElement("video");h=document.createElement("source"),h.type="video/ogg",this.video.appendChild(h),i=document.createElement("source"),i.type="video/mp4",this.video.appendChild(i),this.load=function(){i.src=d,h.src=c,k.addEventListener("canplaythrough",e,!1),k.load()},this.show=function(){var c="position: absolute;left: "+.5*(a-this.video.width)+"px;top: "+.5*(b-this.video.height)+"px";styleElement(k,c),this.container.appendChild(k),this.target.window.addEventListener("resize",g,!1),setTimeout(f,500)},this.hide=function(){this.video.pause(),this.container.removeChild(this.video),this.target.window.removeEventListener("resize",g,!1)},this.update=function(a,b,c){},this.pause=function(){this.video.pause()},this.resume=function(){this.video.play()}};VideoContent.prototype=new Content,VideoContent.prototype.constructor=VideoContent;var FigureRunning=function(a,b,c){Content.call(this),this.canvas=document.createElement("canvas"),this.canvas.width=a,this.canvas.height=b,styleElement(this.canvas,"background: #000"),this.context=this.canvas.getContext("2d");var d=this;this.img=new Image,this.img.onload=function(){d.preloaded=!0},this.img.src=c,this.show=function(){this.container.appendChild(this.canvas),this.context.drawImage(this.img,0,0)},this.hide=function(){this.container.removeChild(this.canvas)},this.update=function(a,b,c){}};FigureRunning.prototype=new Content,FigureRunning.prototype.constructor=FigureRunning;var FigureRunningVideo=function(a,b,c,d){Content.call(this);var e,f,g,h=this;this.ratio=0,this.video=document.createElement("video"),f=document.createElement("source"),f.type="video/ogg",this.video.appendChild(f),g=document.createElement("source"),g.type="video/mp4",this.video.appendChild(g),this.video.loop="loop",g.src=d,f.src=c,e=document.createElement("div"),styleElement(e,"position: absolute; top: -1000px; left: -1000px; width: 0px; height: 0px; overflow: hidden; visibility: hidden"),e.appendChild(this.video),document.body.appendChild(e),this.video.addEventListener("canplaythrough",function(b){console.log("can play through"),h.ratio=h.video.videoWidth/h.video.videoHeight,h.video.width=a,h.video.height=a/h.ratio,h.preloaded=!0},!1),this.preloaded=!0,this.show=function(){this.container.appendChild(this.video),this.video.play()},this.hide=function(){this.container.removeChild(this.video)},this.update=function(a,b,c){}};FigureRunningVideo.prototype=new Content,FigureRunningVideo.prototype.constructor=FigureRunningVideo,BirdsSky.prototype=new Content,BirdsSky.prototype.constructor=BirdsSky;var map=new ProjMap,FlyingNeighborhood=function(a,b){function c(a){var b=a.target.innerWidth,c=a.target.innerHeight;map.canvas.style.left=.5*(b-map.canvas.width)+"px",map.canvas.style.top=.5*(c-map.canvas.height)+"px"}Content.call(this),this.preloaded=!1;var d,e,f,g=this;this.checkPreloaded=function(){g.loadingfailed=map.load_failed,map.isPreloaded()?g.preloaded=!0:setTimeout(g.checkPreloaded,1e3)},this.load=function(){map.scale=1,map.create(gLocation),this.checkPreloaded()},this.init=function(){this.frameCount=0},this.show=function(){sendStat("/60-Street-view"),this.target.window.addEventListener("resize",c,!1),map.setSize(a,b),map.running=!0,map.deviation=0,map.birds1=!1,map.birds2=!0,map.birds3=!0,map.start_time=59.5,map.setScene(1),map.trees=!1,map.rotate_angle=0,map.earthquake=!0,map.tween_perspective=0,map.tween_alpha=0,e=new MANUAL_TWEEN.Tween(map).to(4,{tween_perspective:.15}).easing(TWEEN.Easing.Sine.EaseOut),map.tweener.add(e),f=new MANUAL_TWEEN.Tween(map).to(1,{tween_alpha:1}).easing(TWEEN.Easing.Sine.EaseOut),map.tweener.add(f),d=this.target.document.title,this.container.appendChild(map.canvas)},this.hide=function(){map.tweener.remove(e),map.tweener.remove(f),this.target.window.removeEventListener("resize",c,!1),this.target.document.title=d,this.container.removeChild(map.canvas)},this.update=function(a,b,c){map.fixCopyrights(),this.target.document.title=map.getCopyrights();var d=49.900001525879;map.initial_angle=map.angle-.5*Math.PI+map.texture_angle,map.clouds_alpha=0,map.white_alpha=0,map.clouds=!1,.025>b&&(map.white_alpha=1-b/.025),.05>b&&(map.clouds=!0,map.clouds_alpha=1-b/.05);var e=map.perspective;map.tweener.update(b*d*1e3),map.perspective=.5-map.tween_perspective,e!=map.perspective&&map.precalc(),b>.5&&(map.deviation=(b-.5)/.5),map.render(a,b)}};FlyingNeighborhood.prototype=new Content,FlyingNeighborhood.prototype.constructor=FlyingNeighborhood;var StreetviewPan=function(a,b,c,d){function e(a,b,c,d){return{x:(b+180)/360*c,y:(90-a)/180*d}}function f(a,b,c,d){var e=document.createElement("img");e.addEventListener("load",function(){if(a.getContext("2d").drawImage(this,512*c,512*d),r++,r==s){var b=m.getContext("2d");RegExp(" AppleWebKit/").test(navigator.userAgent)&&(b.drawImage(a,0,0),b.globalAlpha=.5,b.globalCompositeOperation="darker",b.fillStyle="#704214",b.fillRect(0,0,x,y),b.globalCompositeOperation="lighter"),b.drawImage(a,0,0)}},!1),e.addEventListener("error",function(){t.loadingfailed=!0},!1),e.src="http://cbk0.google.com/cbk?output=tile&panoid="+b+"&zoom=2&x="+c+"&y="+d}function g(c){j.style.left=.5*(c.target.innerWidth-a)+"px",j.style.top=.5*(c.target.innerHeight-b)+"px"}Content.call(this);var h,i,j,k,l,m,n,o,p,q,r,s,t=this,u=1,v=a,w=b,x=1664,y=832,z=y/2,A=v/w,B=(Math.PI,[]),C=[],D=new ImprovedNoise,c=c?c:Math.random(),d=d?d:1;this.load=function(){r=0,s=8,j=document.createElement("canvas"),j.style.position="absolute",j.width=v,j.height=w,k=j.getContext("2d"),k.fillStyle="#000",k.fillRect(0,0,v,w),l=document.createElement("canvas"),l.width=x,l.height=y,m=document.createElement("canvas"),m.width=x,m.height=y,m.getContext("2d").fillStyle="rgb(0,0,0)",m.getContext("2d").fillRect(0,0,x,y);for(var a=0;v>a;a++)B[a]=Math.sin((a-v/2)/v*A)*v/1.75,C[a]=.35*Math.abs(Math.cos((a-v/2)/v*A*.5));o=gLocation.getPosition(c),p=gLocation.getPosition(c+.1),q=new google.maps.StreetViewService,q.getPanoramaByLocation(o,50,function(a,b){if(b==google.maps.StreetViewStatus.OK){var c=a.location.pano;f(l,c,0,0),f(l,c,1,0),f(l,c,2,0),f(l,c,3,0),f(l,c,0,1),f(l,c,1,1),f(l,c,2,1),f(l,c,3,1);var d=180-a.tiles.centerHeading,g=e(a.location.latLng.lat(),a.location.latLng.lng(),1e9,1e9),i=e(p.lat(),p.lng(),1e9,1e9);i.x-=g.x,i.y-=g.y,n=d+57.2957795*Math.atan2(i.x,-i.y),h=a.copyright,t.preloaded=!0}else t.loadingfailed=!0})},this.show=function(){this.container.appendChild(j),h&&(i=this.target.document.title,this.target.document.title=h),this.target.window.addEventListener("resize",g,!1)},this.hide=function(){this.container.removeChild(j),h&&(this.target.document.title=i),this.target.window.removeEventListener("resize",g,!1)},this.update=function(a,b,c){if(!t.loadingfailed)for(var e,f,g,h=.0174532925*(n+140*b*d),i=75*D.noise(0,b,a),j=0;v>j;j+=u)e=B[j]+270*h,f=e%(x-u),f=0>f?f+x-u:f,g=y*C[j],k.drawImage(m,f,z-C[j]*(z+i),u,g,j,0,u,w)}};StreetviewPan.prototype=new Content,StreetviewPan.prototype.constructor=StreetviewPan;var AerialHouse360=function(a,b){function c(a){var b=a.target.innerWidth,c=a.target.innerHeight;map.canvas.style.left=.5*(b-map.canvas.width)+"px",map.canvas.style.top=.5*(c-map.canvas.height)+"px"}Content.call(this);var d,e,f,g,h,i;map.tween_angle1=0,map.tween_angle2=0,map.tween_angle3=0,map.tween_zoom=0,i=new MANUAL_TWEEN.Tween(map).delay(20.767002868652).to(7,{tween_angle3:2*Math.PI}).easing(TWEEN.Easing.Linear.EaseNone),h=new MANUAL_TWEEN.Tween(map).delay(12.967002868652).to(7.8,{tween_angle2:2*Math.PI}).easing(TWEEN.Easing.Linear.EaseNone),g=new MANUAL_TWEEN.Tween(map).to(12.967002868652,{tween_angle1:2*Math.PI}).easing(TWEEN.Easing.Sine.EaseIn),f=new MANUAL_TWEEN.Tween(map).to(22.967002868652,{tween_zoom:.6}).easing(TWEEN.Easing.Sine.EaseIn),this.load=function(){map.setSize(a,b),this.preloaded=!0},this.init=function(){this.frameCount=0},this.show=function(){this.target.window.addEventListener("resize",c,!1),d=this.target.document.title,e=map.texture_angle,map.setSize(a,b),map.running=!1,map.deviation=1,map.rotating=!0,map.zooming=!0,map.perspective=.35,map.precalc(),map.birds1=!1,map.birds2=!1,map.birds3=!1,map.tween_angle1=0,map.tween_angle2=0,map.tween_angle3=0,map.tween_zoom=0,map.setScene(1),map.earthquake=!0,map.rotating=!0,map.tweener.add(i),map.tweener.add(h),map.tweener.add(g),map.tweener.add(f),this.container.appendChild(map.canvas)},this.hide=function(){this.target.window.removeEventListener("resize",c,!1),this.target.document.title=d,this.container.removeChild(map.canvas),map.tweener.remove(i),map.tweener.remove(h),map.tweener.remove(g),map.tweener.remove(f)},this.update=function(a,b,c){map.fixCopyrights(),this.target.document.title=map.getCopyrights();var d=22.967002868652;map.rotating=!0,map.zooming=!0,map.deviation=1,map.updateCamera(1),map.tweener.update(b*d*1e3),map.texture_angle=map.initial_angle+map.tween_angle1+map.tween_angle2+map.tween_angle3,map.setZoom(19+map.tween_zoom),map.render(a,b)}};AerialHouse360.prototype=new Content,AerialHouse360.prototype.constructor=AerialHouse360;var Streetview360=function(a,b){function c(a,b,c,d){return{x:(b+180)/360*c,y:(90-a)/180*d}}function d(a,b,c,d){var e=document.createElement("img");e.addEventListener("load",function(){if(a.getContext("2d").drawImage(this,512*c,512*d),n++,n==o){var b=texture_mod.getContext("2d");RegExp(" AppleWebKit/").test(navigator.userAgent)&&(b.drawImage(a,0,0),b.globalAlpha=.5,b.globalCompositeOperation="darker",b.fillStyle="#704214",b.fillRect(0,0,t,u),b.globalCompositeOperation="lighter"),b.drawImage(a,0,0)}},!1),e.addEventListener("error",function(){p.loadingfailed=!0},!1),e.src="http://cbk0.google.com/cbk?output=tile&panoid="+b+"&zoom=2&x="+c+"&y="+d}function e(c){h.style.left=.5*(c.target.innerWidth-a)+"px",h.style.top=.5*(c.target.innerHeight-b)+"px"}Content.call(this);var f,g,h,i,j,k,l,m,n,o,p=this,q=1,r=a,s=b,t=1664,u=832,v=u/2,w=r/s,x=(Math.PI,[]),y=[],z=new ImprovedNoise;this.load=function(){n=0,o=8,h=document.createElement("canvas"),h.style.position="absolute",h.width=r,h.height=s,i=h.getContext("2d"),i.fillStyle="#000",i.fillRect(0,0,r,s),j=document.createElement("canvas"),j.width=t,j.height=u,texture_mod=document.createElement("canvas"),texture_mod.width=t,texture_mod.height=u,texture_mod.getContext("2d").fillStyle="rgb(0,0,0)",texture_mod.getContext("2d").fillRect(0,0,t,u);for(var a=0;r>a;a++)x[a]=Math.sin((a-r/2)/r*w)*r/2.5,y[a]=.35*Math.abs(Math.cos((a-r/2)/r*w*.75));l=gLocation.getPosition(1),m=new google.maps.StreetViewService,m.getPanoramaByLocation(l,50,function(a,b){if(b==google.maps.StreetViewStatus.OK){var e=a.location.pano;d(j,e,0,0),d(j,e,1,0),d(j,e,2,0),d(j,e,3,0),d(j,e,0,1),d(j,e,1,1),d(j,e,2,1),d(j,e,3,1);var g=180-a.tiles.centerHeading,h=c(a.location.latLng.lat(),a.location.latLng.lng(),1e9,1e9),i=c(gLocation.getLocation().lat(),gLocation.getLocation().lng(),1e9,1e9);i.x-=h.x,i.y-=h.y,k=g+57.2957795*Math.atan2(i.x,-i.y),k+=35,f=a.copyright,p.preloaded=!0}else p.loadingfailed=!0})},this.show=function(){this.container.appendChild(h),f&&(g=this.target.document.title,this.target.document.title=f),this.target.window.addEventListener("resize",e,!1)},this.hide=function(){this.container.removeChild(h),f&&(this.target.document.title=g),this.target.window.removeEventListener("resize",e,!1)},this.update=function(a,b,c){if(!p.loadingfailed)for(var d,e,f,g=.0174532925*(k-450*b),h=60*z.noise(10*-b,0,10*b),j=60*z.noise(0,10*-b,10*b),l=0;r>l;l+=q)d=x[l]+270*g+h,e=d%(t-q),e=0>e?e+t-q:e,f=u*y[l],i.drawImage(texture_mod,e,v-y[l]*(v+j),q,f,l,0,q,s)}};Streetview360.prototype=new Content,Streetview360.prototype.constructor=Streetview360;var ZoomOut=function(a,b){function c(a){var b=a.target.innerWidth,c=a.target.innerHeight;map.canvas.style.left=.5*(b-map.canvas.width)+"px",map.canvas.style.top=.5*(c-map.canvas.height)+"px"}Content.call(this);var d;this.show=function(){this.target.window.addEventListener("resize",c,!1),d=this.target.document.title,map.setSize(a,b),map.running=!1,map.rotating=!0,map.updateCamera(1),map.perspective=.35,map.precalc(),map.birds1=!1,map.birds2=!1,map.birds3=!1,map.setScene(1),map.earthquake=!1,this.container.appendChild(map.canvas)},this.hide=function(){this.target.window.removeEventListener("resize",c,!1),this.target.document.title=d,this.container.removeChild(map.canvas)},this.update=function(a,b,c){map.fixCopyrights(),this.target.document.title=map.getCopyrights();map.rotating=!0,map.zooming=!0,map.deviation=1,map.updateCamera(1),map.setZoom(19.6-4.4*b),map.texture_angle=map.initial_angle+map.tween_angle1+map.tween_angle2+map.tween_angle3+1.35*b*2*Math.PI,map.render(a,b)}};ZoomOut.prototype=new Content,ZoomOut.prototype.constructor=ZoomOut;var currentCode,DrawingTool=function(a,b){"use strict";Content.call(this);var c=this;this.mousePressed=!1,this.randomizer=new SeededRandom,this.canvas=document.createElement("canvas"),this.canvas.width=a,this.canvas.height=b,this.context=this.canvas.getContext("2d"),this.megaContainer=document.createElement("div"),this.messageContainer=document.createElement("div"),this.memory=new Memory(this),this.brush=new BranchingBrush(this,this.context),this.branches=[],this.activeGlyphs=[],this.blockKeyboard=!1,this.dontCenterMe=!1,this.introStr="Write a postcard of advice to the younger you that lived there then.",this.aIntroString=this.introStr.split(""),this.userStartedDrawing=!1,this.introStep=0,this.introDelay=0,this.intro=document.createElement("div");var d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("div");d.innerHTML="to write or draw",styleElement(d,"position: absolute; top: 212px; left: 397px;"),e.innerHTML="for smaller letters",styleElement(e,"position: absolute; top: 325px; left: 397px;"),f.innerHTML="(double click to start)",styleElement(f,"position: absolute; top: 420px; left: 305px;"),this.introExtra=document.createElement("div"),styleElement(this.introExtra,"position: absolute; top: -10px; left: 0px; width: 100%; height: 100%; background: url(img/prompt.gif) 180px 162px no-repeat;"),this.introExtra.appendChild(d),this.introExtra.appendChild(e),this.introExtra.appendChild(f),styleElement(this.intro,"text-align: left; padding-left: 135px; padding-top: 90px; width: 100%; height: 100%;"),this.introText=document.createElement("span"),this.intro.appendChild(this.introText),this.ox=0,this.oy=0,this.messageContents="",SharedObject.data.drawingX=0,SharedObject.data.drawingPressed=0,SharedObject.data.drawingReleased=0,SharedObject.data.dt_canvas=this.canvas,SharedObject.data.dt_points=[];var g=SharedObject.data.dt_canvas.getContext("2d");
g.globalCompositeOperation="source-over",this.canvas.style.cursor="crosshair",this.canvas.style.border="1px solid #CCC",this.canvas.style.position="absolute",this.canvas.style.zIndex="2",this.megaContainer.style.position="absolute",this.megaContainer.style.cursor="crosshair",this.megaContainer.style.border="1px solid #CCC",this.megaContainer.style.padding="8px",this.megaContainer.style.width=this.canvas.width+3+"px",this.megaContainer.style.height=this.canvas.height+3+"px",this.megaContainer.style.overflow="hidden",this.megaContainer.style.background="#FDFDFD url(/img/pattern.jpg)",this.megaContainer.appendChild(this.messageContainer),this.megaContainer.appendChild(this.canvas),this.makeWordContainer=function(){var a=document.createElement("div");return a.style.border="1px solid #000",a},this.waitForExtra=0,this.timeToWaitForExtra=90,this.activeWordContainer=this.makeWordContainer(),this.isRedrawing=!1,this.show=function(a){SharedObject.data.drawingPressed=0,SharedObject.data.drawingReleased=0,SharedObject.data.dt_points=this.brush.allPoints,this.addListeners(),this.container.appendChild(this.megaContainer);var b=15,d=this.messageContainer;if(d.style.width=this.canvas.width-2*b+1+"px",d.width=this.canvas.width-2*b+1,d.style.height=this.canvas.height-2*b+1+"px",d.height=this.canvas.height-2*b+1,d.style.padding=b+"px",d.style.position="absolute",d.style.overflow="hidden",a)this.userStartedDrawing=!0,this.dontCenterMe=!0;else if(!a){try{sendStat("/70-Drawing")}catch(e){}this.megaContainer.appendChild(this.intro),this.startRecording()}if(this.container.style.backgroundColor="#FFF",this.onWindowResize(null),this.randomizer.reset(),this.canvas.focus(),"Safari"==BrowserDetect.browser){var f=function(){c.ox<0&&window.setTimeout(function(){c.onWindowResize(null),f()},10)};f()}},this.hide=function(){g.drawImage(this.canvas,0,0),this.stopRecording(),this.container.removeChild(this.megaContainer);try{clearTimeout(this.introKillInterval),this.introTween.destroy(),this.megaContainer.removeChild(this.intro)}catch(a){}this.container.style.backgroundColor="#000",this.removeListeners()},this.update=function(a,b,c){for(var d=this.isRedrawing&&void 0===currentCode?40:1,e=0;d>e;e++){(this.memory.isPlaying||this.memory.isRecording)&&this.memory.step();for(var f=0;f<this.branches.length;f++)this.branches[f].update();for(var g in this.activeGlyphs)this.activeGlyphs[g].update();this.userStartedDrawing||(this.introStep<this.aIntroString.length?1===this.introDelay?(this.introText.innerHTML+=this.aIntroString[this.introStep],"."==this.aIntroString[this.introStep]&&(this.introText.innerHTML+="<br/>"),this.introStep++,this.introDelay=0):this.introDelay++:this.waitForExtra<this.timeToWaitForExtra?this.waitForExtra++:this.intro.appendChild(this.introExtra)),this.mousePressed&&(this.memory.isRecording&&this.memory.add(1,this.mouseX-this.ox,this.mouseY-this.oy),this.brush.stroke(this.mouseX-this.ox,this.mouseY-this.oy))}},this.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.brush.destroy(),this.memory.forget(),this.clearMessage()},this.clearMessage=function(){for(this.messageContents="";this.messageContainer.children.length>0;)this.messageContainer.removeChild(this.messageContainer.firstChild)},this.addListeners=function(){this.addDrawingListeners(),this.target.window.addEventListener("resize",this.onWindowResize,!1),this.target.window.addEventListener("blur",this.blurHandler,!1),this.onWindowResize(null)},this.removeListeners=function(){this.removeDrawingListeners();var a=this.target.window;a.removeEventListener("resize",this.onWindowResize,!1),a.removeEventListener("blur",this.blurHandler,!1)},this.blurHandler=function(a){SharedObject.data.drawingPressed=0,SharedObject.data.drawingReleased=3},this.onWindowResize=function(a){var b=c.target.window.innerWidth,d=c.target.window.innerHeight,e=c.megaContainer.offsetWidth||771,f=c.megaContainer.offsetHeight||521;c.dontCenterMe?(c.megaContainer.style.left="0px",c.megaContainer.style.top="0px"):(c.megaContainer.style.left=.5*(b-e)+"px",c.megaContainer.style.top=.5*(d-f)+"px"),setTimeout(function(){var a=c.canvas.getBoundingClientRect();c.ox=a.left,c.oy=a.top},0)},this.onDocumentMouseOut=function(a){return c.onCanvasMouseUp(),!1},this.removeIntro=function(){if(!c.userStartedDrawing){c.userStartedDrawing=!0;try{c.megaContainer.removeChild(c.intro)}catch(a){}}},this.fadeIntroOut=function(){c.introTween=new TWEEN.Tween(c.introOpacity),c.introTween.easing(TWEEN.Easing.Linear.EaseOut),c.introTween.onUpdate(c.fadeIntroUpdate),c.introTween.onComplete(c.killIntro),c.introTween.to(1,{alpha:0})},this.fadeIntroUpdate=function(){var a=parseInt(c.introOpacity.alpha),b=a/100;c.intro.style.filter="alpha(opacity="+a+")",c.intro.style.opacity=b+"",c.intro.style["-moz-opacity"]=b+"",c.intro.style.visibility=b>.1?"visible":"hidden"},this.killIntro=function(){c.megaContainer.removeChild(c.intro)},this.onCanvasMouseDown=function(a){a.preventDefault();return c.removeIntro(),c.mousePressed=!0,c.brush.strokeStart(a.clientX-c.ox,a.clientY-c.oy),c.memory.isRecording&&c.memory.add(0,a.clientX-c.ox,a.clientY-c.oy),SharedObject.data.drawingPressed=3,c.canvas.addEventListener("mouseup",c.onCanvasMouseUp,!1),!1},this.onCanvasMouseMove=function(a){c.mouseX=a.clientX,c.mouseY=a.clientY},this.onCanvasMouseUp=function(a){c.mousePressed=!1,c.memory.isRecording&&c.memory.add(2,-1,-1),SharedObject.data.drawingReleased=3,SharedObject.data.drawingPressed=0,c.brush.strokeEnd(),c.canvas.removeEventListener("mouseup",c.onCanvasMouseUp,!1)},this.addDrawingListeners=function(){this.target.window.addEventListener("keyup",this.onKeyUp,!1),this.target.window.addEventListener("keydown",this.onKeyDown,!1),this.canvas.addEventListener("mouseout",this.onCanvasMouseUp,!1),this.canvas.addEventListener("mousemove",this.onCanvasMouseMove,!1),this.canvas.addEventListener("mousedown",this.onCanvasMouseDown,!1),this.canvas.style.cursor="crosshair"},this.removeDrawingListeners=function(){this.target.window.removeEventListener("keyup",this.onKeyUp,!1),this.target.window.removeEventListener("keydown",this.onKeyDown,!1),this.canvas.removeEventListener("mouseout",this.onCanvasMouseDown,!1),this.canvas.removeEventListener("mousemove",this.onCanvasMouseMove,!1),this.canvas.removeEventListener("mousedown",this.onCanvasMouseDown,!1),this.canvas.style.cursor="default";try{this.canvas.removeEventListener("mouseup",c.onCanvasMouseUp,!1)}catch(a){}},this.getFinalImage=function(a){var b=10,c=function(a,b){for(var c=0,d=0;a&&a!=b&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)c+=a.offsetLeft-a.scrollLeft,d+=a.offsetTop-a.scrollTop,a=a.parentNode;return{top:d,left:c}},d=document.createElement("canvas");d.width=this.canvas.width+2*b,d.height=this.canvas.height+2*b;var e=document.createElement("canvas");e.width=this.canvas.width,e.height=this.canvas.height;var f,g=e.getContext("2d"),h=d.getContext("2d");for(var i in this.messageContainer.children)if(f=this.messageContainer.children[i],"CANVAS"==f.nodeName||"canvas"==f.nodeName){var j=c(f,this.messageContainer);g.drawImage(f,j.left,j.top)}g.drawImage(this.canvas,0,0);var k=new Image;k.src="/img/pattern.jpg",k.onload=function(){var c=h.createPattern(k,"repeat");h.fillStyle=c,h.fillRect(Math.round(d.width/2-e.width/2-b)+.5,Math.round(d.height/2-b-e.height/2)+.5,e.width+2*b,e.height+2*b),h.strokeStyle="#ccc",h.lineWidth=1,h.strokeRect(Math.round(d.width/2-e.width/2-b)+.5,Math.round(d.height/2-b-e.height/2)+.5,e.width+2*b-1,e.height+2*b-1),h.strokeRect(Math.round(d.width/2-e.width/2)-.5,Math.round(d.height/2-e.height/2)-.5,e.width+1,e.height+1),h.drawImage(e,d.width/2-e.width/2,d.height/2-e.height/2),a(d.toDataURL("image/png"))}},this.loadMessage=function(a){this.clearMessage();for(var b=0;b<a.length;b++){var c=a.charAt(b);this.addGlyph(c)}},this.onKeyUp=function(a){if(!c.blockKeyboard)if(c.removeIntro(),SharedObject.data.drawingReleased=3,SharedObject.data.drawingPressed=0,8==a.keyCode)c.backspace();else if(190==a.keyCode)c.addGlyph(".");else{var b=String.fromCharCode(a.keyCode);c.addGlyph(b)}},this.onKeyDown=function(a){c.blockKeyboard||(SharedObject.data.drawingPressed=3)},this.backspace=function(){if(this.messageContainer.children.length>0){var a=this.activeGlyphs.pop();this.messageContainer.removeChild(a.canvas),this.messageContents=this.messageContents.substring(0,this.messageContents.length-1)}},this.addGlyph=function(a){var b;if(b=this.getGlyph(a)){this.activeGlyphs.push(b),this.messageContainer.appendChild(b.canvas),this.messageContents+=""+b.character;for(var c=0,d=0;d<this.activeGlyphs.length;d++)b=this.activeGlyphs[d],c+=b.left+b.width+b.right}},this.getGlyph=function(a){if(!glyphs[a])return!1;var b=glyphs[a],c=new CanvasSprite(b);return c.character=a,c},this.isEmpty=function(){var a=this.memory.actions,b=this.messageContents;return 0===a.length&&0===b.length},this.startRecording=function(){this.memory.beginRecord()},this.stopRecording=function(){this.memory.endRecord()},this.getSavedMemory=function(){return this.memory.save()},this.loadMemory=function(a,b){this.clear(),this.memory.read(a)}};DrawingTool.prototype=new Content,DrawingTool.prototype.constructor=DrawingTool;var VideoMachine=function(a,b,c,d,e,f){function g(){var c=p.video.readyState>=3;null!==p.idleLoop&&(c&=p.idleLoop.readyState>=3),c&&(p.ratio=p.video.videoWidth/p.video.videoHeight,p.video.width=a,p.video.height=a/p.ratio,p.video.height<b&&(p.video.height=b,p.video.width=b*p.ratio),"Chrome"!=BrowserDetect.browser&&document.body.removeChild(i),null!==p.idleLoop&&(p.idleLoop.width=p.video.width,p.idleLoop.height=p.video.height,"Chrome"!=BrowserDetect.browser&&document.body.removeChild(n)),p.preloaded=!0,clearInterval(o))}function h(c){var d=c.target.innerWidth>a?c.target.innerWidth:a,e=c.target.innerHeight>b?c.target.innerHeight:b;p.video.style.left=.5*(d-p.video.width)+"px",p.video.style.top=.5*(e-p.video.height)+"px",null!==p.idleLoop&&(p.idleLoop.style.left=.5*(d-p.idleLoop.width)+"px",p.idleLoop.style.top=.5*(e-p.idleLoop.height)+"px")}Content.call(this);var i,j,k,l,m,n,o,p=this;this.MAX_SPEED=1,this.playbackRate=0,this.videoState="idle",this.playbackStep=.03,this.ratio=0,this.video=document.createElement("video"),j=document.createElement("source"),j.type="video/ogg",this.video.appendChild(j),k=document.createElement("source"),k.type="video/mp4",this.video.appendChild(k),this.video.loop=!0,void 0!==e?(this.idleLoop=document.createElement("video"),this.idleLoop.appendChild(l=document.createElement("source")),this.idleLoop.appendChild(m=document.createElement("source")),this.idleLoop.loop=!0):this.idleLoop=null,this.load=function(){"Chrome"!=BrowserDetect.browser&&(i=document.createElement("div"),styleElement(i,"position: absolute; top: -1000px; left: -1000px; width: 0px; height: 0px; overflow: hidden; visibility: hidden"),i.appendChild(this.video),document.body.appendChild(i)),k.src=d,j.src=c,null!==this.idleLoop&&("Chrome"!=BrowserDetect.browser&&(n=document.createElement("div"),styleElement(n,"position: absolute; top: -1000px; left: -1000px; width: 0px; height: 0px; overflow: hidden; visibility: hidden"),n.appendChild(this.idleLoop),document.body.appendChild(n)),m.src=f,l.src=e),o=setInterval(g,500)},this.show=function(){this.container.appendChild(this.video),styleElement(this.video,"position: absolute; left: "+.5*(a-this.video.width)+"px; top: "+.5*(b-this.video.height)+"px"),null!==this.idleLoop&&(this.container.appendChild(this.idleLoop),styleElement(this.idleLoop,"position: absolute; left: "+.5*(a-this.idleLoop.width)+"px; top: "+.5*(b-this.idleLoop.height)+"px"),this.idleLoop.play()),this.video.play(),this.target.window.addEventListener("resize",h,!1)},this.hide=function(){this.container.removeChild(this.video),this.target.window.removeEventListener("resize",h,!1)},this.update=function(a,b,c){void 0===SharedObject.data.drawingX?0:SharedObject.data.drawingX;SharedObject.data.drawingPressed>0&&"speedUp"!=this.videoState?(null!==this.idleLoop&&(this.idleLoop.style.visibility="hidden"),SharedObject.data.drawingPressed--,this.videoState="speedUp"):SharedObject.data.drawingReleased>0&&"speedDown"!=this.videoState&&(SharedObject.data.drawingReleased--,this.videoState="speedDown"),"speedUp"==this.videoState?this.playbackRate<this.MAX_SPEED&&(this.playbackRate+=this.playbackStep):"speedDown"==this.videoState&&(this.playbackRate>0?this.playbackRate-=this.playbackStep:(this.playbackRate=0,this.videoState="idle",null!==this.idleLoop&&(this.idleLoop.style.visibility="visible"))),this.video.playbackRate=this.playbackRate}};VideoMachine.prototype=new Content,VideoMachine.prototype.constructor=VideoMachine,BirdsMap.prototype=new Content,BirdsMap.prototype.constructor=BirdsMap;var FlyingNeighborhood2=function(a,b){function c(c){var d=c.target.innerWidth>a?c.target.innerWidth:a,e=c.target.innerHeight>b?c.target.innerHeight:b;map.canvas.style.left=.5*(d-map.canvas.width)+"px",map.canvas.style.top=.5*(e-map.canvas.height)+"px"}Content.call(this);var d;this.show=function(){this.target.window.addEventListener("resize",c,!1),d=this.target.document.title,map.setSize(a,b),map.clouds=!1,map.running=!0,map.rotating=!1,map.zooming=!1,map.trees=!0,map.angle=0,map.texture_angle=0,map.start_time=244.591,map.birds1=!0,map.birds2=!1,map.birds3=!1,map.perspective=.35,map.precalc(),map.setScene(2),map.setZoom(19,!0),this.container.appendChild(map.canvas)},this.hide=function(){this.target.window.removeEventListener("resize",c,!1),this.target.document.title=d,this.container.removeChild(map.canvas)},this.update=function(a,b,c){map.fixCopyrights(),this.target.document.title=map.getCopyrights(),map.updateCamera(1),map.rotating=!1,map.texture_angle=0,map.running=!0,map.zooming=!1,map.deviation=0,map.trees=!0,map.render(a,b)}};FlyingNeighborhood2.prototype=new Content,FlyingNeighborhood2.prototype.constructor=FlyingNeighborhood2;var StreetViewTrees=function(a,b,c,d,e){function f(a,b,c,d){return{x:(b+180)/360*c,y:(90-a)/180*d}}function g(a,b,c,d){var e=document.createElement("img");e.addEventListener("load",function(){if(a.getContext("2d").drawImage(this,512*c,512*d),k++,k==l){var b=D.getContext("2d");RegExp(" AppleWebKit/").test(navigator.userAgent)&&(b.drawImage(a,0,0),b.globalAlpha=.5,b.globalCompositeOperation="darker",b.fillStyle="#000010",b.fillRect(0,0,I,J),b.globalCompositeOperation="lighter"),b.drawImage(a,0,0),x.render(u,m)}},!1),e.addEventListener("error",function(){H.loadingfailed=!0},!1),e.src="http://cbk0.google.com/cbk?output=tile&panoid="+b+"&zoom=2&x="+c+"&y="+d}function h(c){x.domElement.style.left=.5*(c.target.innerWidth-a)+"px",x.domElement.style.top=.5*(c.target.innerHeight-b)+"px",y.domElement.style.left=.5*(c.target.innerWidth-a)+"px",y.domElement.style.top=.5*(c.target.innerHeight-b)+"px"}Content.call(this);var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H=this,I=1664,J=832,c=0|c;this.load=function(){k=0,l=8,z=gLocation.getPosition(1),A=new google.maps.StreetViewService,m=new THREE.Camera(60,a/b,1,1e4),u=new THREE.Scene,v=new THREE.Scene,w=new THREE.Scene,C=document.createElement("canvas"),C.width=I,C.height=J,C.getContext("2d").fillStyle="rgb(0,0,0)",C.getContext("2d").fillRect(0,0,1664,832),D=document.createElement("canvas"),D.width=I,D.height=J,E=[];for(var d=0;63>d;d++){var e=document.createElement("canvas");e.width=256,e.height=256,E[d]=e}var h=document.createElement("img");h.addEventListener("load",function(){for(var a=0;63>a;a++){var b=256*a%2048,c=256*Math.floor(256*a/2048);E[a].getContext("2d").drawImage(this,b,c,256,256,0,0,256,256)}},!1),h.src="files/img/tree_front.png",A.getPanoramaByLocation(z,50,function(a,b){if(b==google.maps.StreetViewStatus.OK){i=a.copyright;var d=a.location.pano;g(C,d,0,0),g(C,d,1,0),g(C,d,2,0),g(C,d,3,0),g(C,d,0,1),g(C,d,1,1),g(C,d,2,1),g(C,d,3,1);var e=f(a.location.latLng.lat(),a.location.latLng.lng(),1e9,1e9),h=f(gLocation.getLocation().lat(),gLocation.getLocation().lng(),1e9,1e9);h.x-=e.x,h.y-=e.y;var j=57.2957795*Math.atan2(h.x,-h.y)+c;if(q=c+180-a.tiles.centerHeading+j,0!==c){for(var k,l=1e3,x=0;x<a.links.length;x++)k=Math.min(Math.abs(j-a.links[x].heading),Math.abs(j+360-a.links[x].heading)),l>k&&(closest_heading=a.links[x].heading,l=k);q=closest_heading+180-a.tiles.centerHeading}m.target.position.x=1e4*Math.cos(q*Math.PI/180),m.target.position.z=1e4*Math.sin(q*Math.PI/180),n=new THREE.Mesh(new Sphere(400,30,20,!0),new THREE.MeshBitmapUVMappingMaterial(D)),n.overdraw=!0,n.flipSided=!0,u.addObject(n),p=[],F=[],s=[],G=new MANUAL_TWEEN.Manager;var y=document.createElement("canvas");y.width=256,y.height=256;var z=y.getContext("2d"),A=z.createRadialGradient(128,128,0,128,128,128);A.addColorStop(.1,"rgba(0, 0, 0, 0.5)"),A.addColorStop(.5,"rgba(0, 0, 0, 0.2)"),A.addColorStop(.7,"rgba(0, 0, 0, 0.1)"),A.addColorStop(1,"rgba(0, 0, 0, 0)"),z.fillStyle=A,z.fillRect(0,0,256,256),t=new THREE.ParticleBitmapMaterial(y);for(var B=0;5>B;B++){var I=new THREE.ParticleBitmapMaterial(E[0]);I.offset.y=110,o=p[B]=new THREE.Particle(I),0===c?(o.position.copy(m.position),o.position.multiplyScalar(3),o.position.x+=2e3*Math.random()-1e3,o.position.y=-500,o.position.z+=2e3*Math.random()-1e3,o.scale.x=o.scale.y=5*Math.random()+5):(o.position.copy(m.target.position),o.position.multiplyScalar(1-2*B/9),o.position.x+=2e3*Math.random()-1e3,o.position.y=-700,o.position.z+=2e3*Math.random()-1e3,o.scale.x=o.scale.y=5*Math.random()+10),w.addObject(o),F[B]=new BitmapSequence(E),r=s[B]=new THREE.Particle(t),r.position=o.position,r.scale.x=r.scale.y=0,v.addObject(r);var J=2*B,K=new MANUAL_TWEEN.Tween(F[B]).delay(J).to(10,{position:1});G.add(K),K=new MANUAL_TWEEN.Tween(r.scale).delay(J).to(10,{x:8,y:2}).easing(TWEEN.Easing.Expo.EaseOut),G.add(K)}H.preloaded=!0}else H.loadingfailed=!0}),x=new THREE.CanvasRenderer,x.domElement.style.position="absolute",x.autoClear=!1,x.setSize(a,b),y=new THREE.CanvasRenderer,y.autoClear=!1,y.setSize(a,b),y.domElement.style.position="absolute",y.domElement.style.left="0px",y.domElement.style.top="0px",B=y.domElement.getContext("2d")},this.show=function(){this.container.appendChild(x.domElement),this.container.appendChild(y.domElement),i&&(j=this.target.document.title,this.target.document.title=i),this.target.window.addEventListener("resize",h,!1)},this.hide=function(){this.container.removeChild(x.domElement),this.container.removeChild(y.domElement),i&&(this.target.document.title=j),this.target.window.removeEventListener("resize",h,!1)},this.update=function(c,f,g){if(!H.loadingfailed&&G){G.update(1e4*(f*e+d));for(var h=0;h<p.length;h++)o=p[h],o.material[0].bitmap=F[h].get();B.clearRect(0,0,a,b),y.render(v,m),y.render(w,m)}}};StreetViewTrees.prototype=new Content,StreetViewTrees.prototype.constructor=StreetViewTrees;var BirdsAttackFigure=function(a,b){Content.call(this),this.canvas=document.createElement("canvas"),this.canvas.width=a,this.canvas.height=b,styleElement(this.canvas,"background: #FC0"),this.context=this.canvas.getContext("2d"),this.show=function(){this.container.appendChild(this.canvas)},this.hide=function(){this.container.removeChild(this.canvas)},this.update=function(a,b,c){}};BirdsAttackFigure.prototype=new Content,BirdsAttackFigure.prototype.constructor=BirdsAttackFigure;var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;if(this.versionSearchString=a[b].versionSearch||a[b].identity,c){if(-1!=c.indexOf(a[b].subString))return a[b].identity}else if(d)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(-1!=b)return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,versionSearch:"Version",identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};BrowserDetect.init();var bg,sequencer,lInterval,audio,audioOGG,audioMP3,stats,counter,link,inputTime,searchField,aSearch,searchBtn,searchHlp,searchLoaded=!1,defaultSearchString="Enter the address of the home where you grew up",warningCopy="",layoutTopContainer,canvasBirds,titleWriter,launched=!1,playing=!0,resuming=!1,isKioskMode=!1;aSearch=document.createElement("input"),aSearch.type="text",aSearch.id="aSearch",aSearch.autocomplete="off",aSearch.addEventListener("keypress",handleKeyPress,!1),aSearch.addEventListener("focus",checkAddressInputText,!1),aSearch.addEventListener("blur",restoreAddressInputText,!1),aSearch.value=defaultSearchString;var addressFeedback,storedAddress,warning,final_drawing,isDrawing=!1,codeHelper,subtitle=document.getElementById("sub-text"),buttonsArea=document.getElementById("buttons-area"),blocker=document.createElement("div");blocker.id="blocker";var blockerSettings={opacity:0},blockerTween=new TWEEN.Tween(blockerSettings);document.body.appendChild(blocker);try{var console=console||{log:function(a){}}}catch(error){}window.addEventListener("unload",exitSequencer,!1),bg=document.getElementById("bg"),audio=document.createElement("audio"),audio.preload="auto",audio.appendChild(audioOGG=document.createElement("source")),audio.appendChild(audioMP3=document.createElement("source")),audioOGG.src="files/wutw.ogg",audioOGG.type="audio/ogg; codecs=vorbis",audioMP3.src="files/wutw.mp3",audioMP3.type="audio/mpeg",document.body.appendChild(audio),"Firefox"==BrowserDetect.browser&&BrowserDetect.version<3.5?createWarning('This site will not work with your <a href="http://www.whatbrowser.org">browser</a>. It was designed with Google Chrome in mind, you may need to download <a href="http://www.google.com/chrome">Google Chrome</a> and try launching this site again.'):"Firefox"==BrowserDetect.browser&&BrowserDetect.version<4?(createWarning('This site was designed with Google Chrome in mind and is unable to render properly in your <a href="http://www.whatbrowser.org">browser</a>.<br />For the best viewing experience, we recommend downloading <a href="http://www.google.com/chrome">Google Chrome</a> and trying this site again.'),createTryAnywayButton()):"Safari"==BrowserDetect.browser&&BrowserDetect.version<=3?(createWarning('This site was designed for modern browsers like <a href="http://www.google.com/chrome">Google Chrome</a>, please download it or update to the <a href="http://www.apple.com/safari/download/">newest version</a> of your current browser.'),createTryAnywayButton()):"Opera"==BrowserDetect.browser?(createWarning('This site may not work with your <a href="http://www.whatbrowser.org">browser</a>. It was designed with Google Chrome in mind, you may need to download <a href="http://www.google.com/chrome">Google Chrome</a> and try launching this site again.'),createTryAnywayButton()):"Chrome"==BrowserDetect.browser&&BrowserDetect.version<=4?(createWarning('Please update your browser for the best viewing experience. For instructions on updating Chrome, please refer to the <a href="http://www.google.com/support/chrome/bin/answer.py?hl=en&answer=95414">Google Chrome Help Center</a>.'),createTryAnywayButton()):"Explorer"==BrowserDetect.browser&&BrowserDetect.version<=8?createWarning('This site may not work with your <a href="http://www.whatbrowser.org">browser</a>. It was designed with Google Chrome in mind, you may need to download <a href="http://www.google.com/chrome">Google Chrome</a> and try launching this site again.'):"Explorer"==BrowserDetect.browser&&BrowserDetect.version>8?(createWarning('This site may not work with your <a href="http://www.whatbrowser.org">browser</a>. It was designed with Google Chrome in mind, you may need to download <a href="http://www.google.com/chrome">Google Chrome</a> and try launching this site again.'),createTryAnywayButton()):(createSearchField(),createPreloader());var search=window.location.search;if(isKioskMode=search.indexOf("kiosk")>=0){for(var toHide=document.querySelectorAll(".kiosk-hide"),i=0;i<toHide.length;i++){var h=toHide[i];h.style.display="none"}var ceLink=document.getElementById("ce-link"),googleLink=document.getElementById("google-link");ceLink.style["pointer-events"]="none",googleLink.style["pointer-events"]="none"}layoutTopContainer=document.getElementById("top"),window.location.hash&&(aSearch.value=window.location.hash.replace("#","")),window.addEventListener("resize",resizeHandler,!1),resizeHandler(null),lInterval=setInterval(init,500);var autoSuggestions,suggestionResults,suggestionsGeocoder=new google.maps.Geocoder,suggestionsRequest=new XMLHttpRequest,suggestURL="http://maps.google.com/maps/suggest?output=json&oe=utf8&sensor=true&q=",suggestInterval,storedAddress=aSearch.value,searchFocus=!1;addSuggestionListeners(),suggestionsRequest.onreadystatechange=function(){4==suggestionsRequest.readyState&&console.log(200==suggestionsRequest.status?"Received:"+suggestionsRequest.responseText:"Error code "+suggestionsRequest.status)};